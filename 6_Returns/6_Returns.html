<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Returns</title>
    <meta charset="utf-8" />
    <meta name="author" content="PhD.(C). Orlando Joaqui-Barandica" />
    <meta name="date" content="2022-01-01" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies-fonts.css" rel="stylesheet" />
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <script src="libs/proj4js/proj4.js"></script>
    <link href="libs/highcharts/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts/highcharts.js"></script>
    <script src="libs/highcharts/highcharts-3d.js"></script>
    <script src="libs/highcharts/highcharts-more.js"></script>
    <script src="libs/highcharts/modules/stock.js"></script>
    <script src="libs/highcharts/modules/map.js"></script>
    <script src="libs/highcharts/modules/data.js"></script>
    <script src="libs/highcharts/modules/exporting.js"></script>
    <script src="libs/highcharts/modules/offline-exporting.js"></script>
    <script src="libs/highcharts/modules/drilldown.js"></script>
    <script src="libs/highcharts/modules/item-series.js"></script>
    <script src="libs/highcharts/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts/modules/annotations.js"></script>
    <script src="libs/highcharts/modules/export-data.js"></script>
    <script src="libs/highcharts/modules/funnel.js"></script>
    <script src="libs/highcharts/modules/heatmap.js"></script>
    <script src="libs/highcharts/modules/treemap.js"></script>
    <script src="libs/highcharts/modules/sankey.js"></script>
    <script src="libs/highcharts/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts/modules/organization.js"></script>
    <script src="libs/highcharts/modules/solid-gauge.js"></script>
    <script src="libs/highcharts/modules/streamgraph.js"></script>
    <script src="libs/highcharts/modules/sunburst.js"></script>
    <script src="libs/highcharts/modules/vector.js"></script>
    <script src="libs/highcharts/modules/wordcloud.js"></script>
    <script src="libs/highcharts/modules/xrange.js"></script>
    <script src="libs/highcharts/modules/tilemap.js"></script>
    <script src="libs/highcharts/modules/venn.js"></script>
    <script src="libs/highcharts/modules/gantt.js"></script>
    <script src="libs/highcharts/modules/timeline.js"></script>
    <script src="libs/highcharts/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts/modules/bullet.js"></script>
    <script src="libs/highcharts/modules/coloraxis.js"></script>
    <script src="libs/highcharts/modules/dumbbell.js"></script>
    <script src="libs/highcharts/modules/lollipop.js"></script>
    <script src="libs/highcharts/modules/series-label.js"></script>
    <script src="libs/highcharts/plugins/motion.js"></script>
    <script src="libs/highcharts/custom/reset.js"></script>
    <script src="libs/highcharts/modules/boost.js"></script>
    <script src="libs/highchart-binding/highchart.js"></script>
    <script src="libs/plotly-binding/plotly.js"></script>
    <script src="libs/typedarray/typedarray.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main/plotly-latest.min.js"></script>
    <link href="libs/font-awesome-animation/font-awesome-animation-emi.css" rel="stylesheet" />
    <script src="libs/fontawesome/js/fontawesome-all.min.js"></script>
    <link rel="stylesheet" href="sydney.css" type="text/css" />
    <link rel="stylesheet" href="fonts_mtheme.css" type="text/css" />
    <link rel="stylesheet" href="cols.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">






class: left, bottom
background-image: url("img/back1.jpg")
background-size: cover


# **Returns**
----

## **Universidad del Valle - Escuela Ingeniería Industrial**

### PhD.(C). Orlando Joaqui-Barandica
### 2022





---
name: hola
class: inverse, middle, center
background-color: #E31D1D

&lt;img style="border-radius: 50%;" src="img/uv3.jpg"
width="150px"
/&gt;

# Universidad del Valle

--

## Maestría en Análitica e Inteligencia de Negocios
---





&lt;br&gt;&lt;br&gt;

.center[
&lt;img style="border-radius: 50%;" src="img/avatar.png"
width="160px" href="https://www.joaquibarandica.com"
/&gt;

[PhD.(C) Orlando Joaqui-Barandica](https://www.joaquibarandica.com) &lt;br/&gt;
Universidad del Valle
]

&lt;br&gt;



.center[

*PhD.(C) Ingeniería con enfásis en Ingeniería Industrial* 
 
*MSc. Economía Aplicada*
 
*Estadístico*

&lt;br&gt;

<i class="fas  fa-link fa-spin "></i> [www.joaquibarandica.com](https://www.joaquibarandica.com)

]





---

class: center, middle

&lt;img src="img/gifinc.jpg" width="50%"/&gt;

### [https://gifinc.univalle.edu.co/](https://gifinc.univalle.edu.co/)


---

name: menu
background-image: url("img/back2.jpg")
background-size: cover
class: left, middle


# Contenido

----


.pull-left[
### <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> [Cálculo de retornos](#retornos)
* xts
* tidyverse
* tidyquant


### <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> [Visualización](#Vis)
* xts
* tidyverse


]


.pull-right[

### <i class="fa fa-cubes" role="presentation" aria-label="cubes icon"></i> [Construcción de portafolio](#portafolio)
* xts
* tidyverse
* tidyquant


###  <i class="fa fa-cubes" role="presentation" aria-label="cubes icon"></i> [Shiny App](#shiny)

]

---

name: retornos
class: inverse, center, middle
background-color: #00081d

# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i>
# Cálculo de retornos
----

.right[
.bottom[
####  [<i class="fa fa-bell" role="presentation" aria-label="bell icon"></i>](#menu)
]
]

---

# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Packages


Los siguientes son los paquetes que serán utilizados en los temas del curso.


----

.scroll-box-20[

```r
# tidyverse contains the packages tidyr, ggplot2, dplyr,
# readr, purrr and tibble
install.packages("tidyverse")
install.packages("lubridate")
install.packages("readxl")
install.packages("highcharter")
install.packages("tidyquant")
install.packages("timetk")
install.packages("tibbletime")
install.packages("quantmod")
install.packages("PerformanceAnalytics")
install.packages("scales")


library(tidyverse)
library(lubridate)
library(readxl)
library(highcharter)
library(tidyquant)
library(timetk)
library(tibbletime)
library(quantmod)
library(PerformanceAnalytics)
library(scales)
```
]

----


---

# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


En nuestro tema de rendimientos de activos `(asset returns)` tomaremos datos de precios sin procesar para 5 activos individuales y los transformaremos en rendimientos mensuales para una sola cartera `(portfolio)`. 



.pull-left[

Nuestro portafolio consiste en los siguientes ETFs (Exchange Traded Funds)

- SPY (S&amp;P500 ETF) `weighted 25%`
- EFA (a non-US equities ETF) `weighted 25%`
- IJS (a small-cap value ETF) `weighted 20%`
- EEM (an emerging-markets ETF) `weighted 20%`
- AGG (a bond ETF) `weighted 10%`


### Enfoques

Trabajaremos tres enfoques de codificación:

* xts
* tidyverse
* tidyquant


]


.pull-right[

&lt;br&gt;

![](https://media.giphy.com/media/l0HlDDyxBfSaPpU88/giphy.gif)


]


---



# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Cargar los precios diarios

.pull-left[

Lo hacemos con los `symbols &lt;- c("SPY", "EFA", "IJS", "EEM", "AGG")`. Esos son los tickers de los 5 activos de nuestra cartera. Si desea cambiar a diferentes activos para realizar pruebas, cambie esos tickers. Tenga en cuenta que si desea elegir diferentes tickers de acciones o crear una cartera diferente, cambie los tickers en el vector de símbolos.

----


```r
symbols &lt;- c("SPY","EFA", "IJS", "EEM","AGG")
```

----

Importaremos los 5 ETFs en un objeto `xts` llamado precios.


]


.pull-right[

La función `getSymbols()` del paquete `quantmod` nos permite realizar lectura de los datos diarios desde [Yahoo! Finance](https://finance.yahoo.com/).



&lt;br&gt;

Esto devolverá un objeto con el precio de apertura, precio de cierre, precio ajustado, máximo diario, mínimo diario y volumen diario para cada ticker.


]


---



# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Cargar los precios diarios

.pull-left[


&lt;br&gt;

----


```r
prices &lt;-
getSymbols(symbols,
           src = 'yahoo',
           from = "2012-12-31",
           to = "2017-12-31",
           auto.assign = TRUE,
           warnings = FALSE) %&gt;%
map(~Ad(get(.)))
```

----

Note que la fuente se especifica desde Yahoo! Finance con `src = 'yahoo'`.

]


.pull-right[


* Estamos imponiendo una fecha de inicio de "2012-12-31" y una fecha de finalización de "2017-12-31". Eso significa que trabajaremos con 5 años de datos (cuando convertimos a rendimientos mensuales, perderemos diciembre de 2012)


&lt;br&gt;


* Para aislar el precio ajustado, usamos la función `map()` del paquete `purrr` y aplicamos `Ad(get(.))` a los precios. Esto obtendrá el precio ajustado de cada una de nuestras series individuales. Si quisieramos el precio de cierre sería: `Cl(get(.))`.
Aquí, el `.` hace referencia a nuestro objeto inicial.

]


---





# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Cargar los precios diarios

.pull-left[


&lt;br&gt;

----


```r
prices &lt;-
getSymbols(symbols,
           src = 'yahoo',
           from = "2012-12-31",
           to = "2017-12-31",
           auto.assign = TRUE,
           warnings = FALSE) %&gt;%
map(~Ad(get(.))) %&gt;%
reduce(merge) %&gt;%
`colnames&lt;-`(symbols)
```

----

]


.pull-right[

&lt;br&gt;

* `map()` devuelve una lista de 5 objetos `xts`.


* `reduce(merge)` fusionará las 5 listas en un solo objeto `xts`.

* `merge()` busca el índice de fecha compartido por nuestros objetos y usa ese índice para alinear los datos.

* `colnames &lt;-` renombra las columnas de acuerdo  al objeto `symbols`

]


---




# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Cargar los precios diarios desde un external file

.pull-left[



----


```r
# Desde .csv
prices &lt;-
      read_csv("path to your data.csv",
          col_types =
          cols(date =
          col_date(format = "%Y-%m-%d"))) %&gt;%
tk_xts(date_var = date)


# Desde .xlsx
prices &lt;-
       read_excel("path to your excel spreadsheet",
                 col_types = c("text", "numeric",
                 "numeric", "numeric",
                 "numeric", "numeric")) %&gt;%
mutate(date = ymd(date)) %&gt;%
tk_xts(date_var = date)
```

----

]


.pull-right[



* Para cargar el archivo usamos la función `read_csv()`  del paquete `readr`. Si la extensión es *.csv*, si hay otras extensiones como *.xlsx* se puede utilizar la función `read_xlsx()` o `read_excel` del paquete `readxl`.


* `tk_xts(date_var = date)` convierte el data frame en `xts`.

* `ymd()` del paquete `lubridate` convierte a formato fecha el vector.

* `mutate()` crea una variable.

]


---





# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Al final tenemos...

.pull-left[



----


```r
symbols &lt;- c("SPY","EFA", "IJS", "EEM","AGG")


prices &lt;-
getSymbols(symbols,
           src = 'yahoo',
           from = "2012-12-31",
           to = "2017-12-31",
           auto.assign = TRUE,
           warnings = FALSE) %&gt;%
map(~Ad(get(.))) %&gt;%
reduce(merge) %&gt;%
`colnames&lt;-`(symbols)

head(prices,10)
```

----

]


.pull-right[





```
##                 SPY      EFA      IJS      EEM      AGG
## 2012-12-31 119.3079 42.67980 35.17166 36.31959 88.45295
## 2013-01-02 122.3658 43.34035 36.13670 37.03205 88.34942
## 2013-01-03 122.0893 42.92001 36.08886 36.77000 88.12641
## 2013-01-04 122.6255 43.13769 36.37143 36.84371 88.22200
## 2013-01-07 122.2904 42.95003 36.15844 36.56527 88.17421
## 2013-01-08 121.9386 42.70984 36.01933 36.23770 88.25386
## 2013-01-09 122.2485 42.92752 36.12365 36.39329 88.19016
## 2013-01-10 123.2203 43.47547 36.16712 36.71268 88.18218
## 2013-01-11 123.2120 43.56553 36.14105 36.41787 88.26976
## 2013-01-14 123.1282 43.61808 36.13235 36.57346 88.34942
```


]


---




# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `xts`


.pull-left[

La primera observación en nuestro objeto de precios es el 31 de diciembre de 2012 (último día de negociación de ese año) y tenemos precios diarios. Queremos convertir esos precios diarios en retornos de registros mensuales basados en la última lectura de cada mes.

&lt;br&gt;

----

* Usaremos `to.monthly(prices, indexAt = "lastog", OHLC = FALSE)` del paquete `quantmod`.

&lt;br&gt;

* El argumento `indexAt = "lastof"` le dice a la función si queremos indexar al primer día del mes o al último día. Si quisieramos usar el primer día, lo cambiariamos a `indexAt = "firstof"`.

----


]


.pull-right[


&lt;br&gt;&lt;br&gt;

----



```r
prices_monthly &lt;- to.monthly(prices,
                  indexAt = "lastof",
                  OHLC = FALSE)

head(prices_monthly, 7)
```

```
##                 SPY      EFA      IJS      EEM      AGG
## 2012-12-31 119.3079 42.67980 35.17166 36.31959 88.45295
## 2013-01-31 125.4154 44.27111 37.05391 36.21313 87.90344
## 2013-02-28 127.0154 43.70065 37.65815 35.38601 88.42289
## 2013-03-31 131.8383 44.27111 39.20513 35.02568 88.50999
## 2013-04-30 134.3713 46.49293 39.25308 35.45152 89.36726
## 2013-05-31 137.5437 45.08927 40.93586 33.73996 87.57892
## 2013-06-30 135.7083 43.88181 40.87846 31.94304 86.20791
```


----


* Hemos convertido un objeto `xts` diario a un objeto `xts` mensual

]


---







# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `xts`



.pull-left[


* Usaremos `Return.calculate(prices_monthly, method = "log")` para convertir a retornos y guardar un objeto llamado `asset_returns_xts`


* Note que estos están dados en logaritmo por `method = "log"`.

`$$r_t = ln \left( \frac{P_t}{P_{t-1}} \right)$$`

* Podríamos usar `method = "discrete"` para obtener los retornos simples.

`$$r_t = \frac{P_t - P_{t-1}}{P_{t-1}}$$`

* Podríamos usar `method = "difference"` para obtener diferencias.


`$$r_t = P_t - P_{t-1}$$`

]


.pull-right[


&lt;br&gt;&lt;br&gt;

----



```r
asset_returns_xts &lt;-
                     Return.calculate(prices_monthly,
                     method = "log") %&gt;%
na.omit()

head(round(asset_returns_xts,3), 7)
```

```
##               SPY    EFA    IJS    EEM    AGG
## 2013-01-31  0.050  0.037  0.052 -0.003 -0.006
## 2013-02-28  0.013 -0.013  0.016 -0.023  0.006
## 2013-03-31  0.037  0.013  0.040 -0.010  0.001
## 2013-04-30  0.019  0.049  0.001  0.012  0.010
## 2013-05-31  0.023 -0.031  0.042 -0.049 -0.020
## 2013-06-30 -0.013 -0.027 -0.001 -0.055 -0.016
## 2013-07-31  0.050  0.052  0.064  0.013  0.003
```


----




]


---

class: inverse, center, middle
background-color: #00081d


# xts



.pull-left[

En términos más generales, este es un buen momento para notar cómo nuestras decisiones en la transformación de datos pueden afectar los datos que finalmente sobreviven a nuestra etapa analítica. 

Acabamos de perder el primer mes de precios diarios. 

Quizás eso no nos importe, o quizás queremos cambiar la fecha de inicio original para asegurarnos de capturar diciembre de 2012. Depende de la tarea y los datos, y si subcontratamos la preparación de los datos, estas decisiones se tomarán antes.

]


.pull-right[


&lt;br&gt;&lt;br&gt;

----

**Desde una perspectiva sustantiva, ahora hemos importado precios diarios, recortados a precios ajustados, movidos a precios mensuales y transformados a retornos de registros mensuales, todo en el mundo xts.**

----

]


---







# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyverse`


.pull-left[

Hay varias diferencias entre un objeto `xts` y un `tibble`, pero uno muy importante es la fecha, un componente esencial de la mayoría de los análisis financieros. Los objetos `xts` tienen un índice de fecha. Por el contrario, los `dataframe` tienen una columna de fecha y esa columna no es necesaria para la existencia del marco de datos.


----



```r
asset_returns_dplyr_byhand &lt;- prices %&gt;%
    to.monthly(indexAt = "lastof", OHLC = FALSE) %&gt;%
    # convert the index to a date
    data.frame(date = index(.)) %&gt;%
    # now remove the index because it got converted to row names
    remove_rownames() %&gt;%
    gather(asset, prices, -date) %&gt;%
    group_by(asset) %&gt;%
    mutate(returns = (log(prices) - log(lag(prices)))) %&gt;%
    select(-prices) %&gt;%
    spread(asset, returns) %&gt;%
    select(date, symbols)
```

----


]


.pull-right[


----


Nuestra conversión de xts a tibble comienza con `data.frame(date = index (.))`

* Convierte nuestro objeto en un data.frame 

* Agrega una columna de fecha basada en el índice con `date = index (.)`. 

&lt;br&gt;

* El índice de fecha del objeto `xts` se conserva como nombres de fila y debe eliminarse explícitamente con `remove_rownames()`.

&lt;br&gt;

* gather() convierte de formato wide a formato long

----



]


---


# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyverse`


.pull-left[


----



```r
asset_returns_dplyr_byhand &lt;- prices %&gt;%
    to.monthly(indexAt = "lastof", OHLC = FALSE) %&gt;%
    # convert the index to a date
    data.frame(date = index(.)) %&gt;%
    # now remove the index because it got converted to row names
    remove_rownames() %&gt;%
    gather(asset, prices, -date) %&gt;%
    group_by(asset) %&gt;%
    mutate(returns = (log(prices) - log(lag(prices)))) %&gt;%
    select(-prices) %&gt;%
    spread(asset, returns) %&gt;%
    select(date, symbols)
```

----


]


.pull-right[


----


* `mutate()` nos permite crear nuestro propio cálculo de retornos: `mutate(returns = (log(prices) - log(lag(prices))))`

&lt;br&gt;

* Removemos la serie de precios ya que no la necesitamos `select(-prices)`

&lt;br&gt;

* `spread()` convierte de formato long a formato wide

&lt;br&gt;

* reordenamos las columnas según las importamos usando el objeto `symbols`, es decir,
`select(date, symbols)`


----



]


---




# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyverse`


.pull-left[


----



```r
asset_returns_dplyr_byhand &lt;- prices %&gt;%
    to.monthly(indexAt = "lastof", OHLC = FALSE) %&gt;%
    # convert the index to a date
    data.frame(date = index(.)) %&gt;%
    # now remove the index because it got converted to row names
    remove_rownames() %&gt;%
    gather(asset, prices, -date) %&gt;%
    group_by(asset) %&gt;%
    mutate(returns = (log(prices) - log(lag(prices)))) %&gt;%
    select(-prices) %&gt;%
    spread(asset, returns) %&gt;%
    select(date, symbols)



head(asset_returns_dplyr_byhand, 10)


asset_returns_dplyr_byhand &lt;-
asset_returns_dplyr_byhand %&gt;%
na.omit()
```

----


]


.pull-right[



```
## # A tibble: 10 × 6
##    date           SPY     EFA      IJS      EEM       AGG
##    &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 2012-12-31 NA      NA      NA       NA       NA       
##  2 2013-01-31  0.0499  0.0366  0.0521  -0.00294 -0.00623 
##  3 2013-02-28  0.0127 -0.0130  0.0162  -0.0231   0.00589 
##  4 2013-03-31  0.0373  0.0130  0.0403  -0.0102   0.000985
##  5 2013-04-30  0.0190  0.0490  0.00122  0.0121   0.00964 
##  6 2013-05-31  0.0233 -0.0307  0.0420  -0.0495  -0.0202  
##  7 2013-06-30 -0.0134 -0.0271 -0.00140 -0.0547  -0.0158  
##  8 2013-07-31  0.0504  0.0519  0.0635   0.0132   0.00269 
##  9 2013-08-31 -0.0305 -0.0197 -0.0347  -0.0257  -0.00830 
## 10 2013-09-30  0.0312  0.0753  0.0639   0.0696   0.0111
```


]


---


# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyquant`


.pull-left[


Exploremos el paradigma tidyquant para convertir a retornos logarítmicos.

----



```r
asset_returns_tq_builtin &lt;-
           prices %&gt;%
           tk_tbl(preserve_index = TRUE,
           rename_index = "date") %&gt;%
           gather(asset, prices, -date) %&gt;%
           group_by(asset) %&gt;%
           tq_transmute(mutate_fun = periodReturn,
           period = "monthly",
           type = "log") %&gt;%
           spread(asset, monthly.returns) %&gt;%
           select(date, symbols) %&gt;%
           slice(-1)

head(asset_returns_tq_builtin, 10)
```

----


]


.pull-right[


----


`tk_tbl(preserve_index = TRUE, rename_index = "date")` convierte los precios de `xts` a `tibble`

* Convierte el índice de fecha en una columna de fecha y lo renombra como "date".

* Dado que el índice se está convirtiendo, no es necesario eliminarlo como hicimos anteriormente.



&lt;br&gt;

* `tq_transmute(mutate_fun = periodReturn, period ="monthly", type = "log")` nos permite pasar de precios diarios a los retornos logarítmicos mensuales.




----



]


---



# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyquant`


.pull-left[


Exploremos el paradigma tidyquant para convertir a retornos logarítmicos.

----



```r
asset_returns_tq_builtin &lt;-
           prices %&gt;%
           tk_tbl(preserve_index = TRUE,
           rename_index = "date") %&gt;%
           gather(asset, prices, -date) %&gt;%
           group_by(asset) %&gt;%
           tq_transmute(mutate_fun = periodReturn,
           period = "monthly",
           type = "log") %&gt;%
           spread(asset, monthly.returns) %&gt;%
           select(date, symbols) %&gt;%
           slice(-1)

head(asset_returns_tq_builtin, 10)
```

----


]


.pull-right[


----



```
## # A tibble: 10 × 6
##    date           SPY     EFA      IJS      EEM       AGG
##    &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 2013-01-31  0.0499  0.0366  0.0521  -0.00294 -0.00623 
##  2 2013-02-28  0.0127 -0.0130  0.0162  -0.0231   0.00589 
##  3 2013-03-28  0.0373  0.0130  0.0403  -0.0102   0.000985
##  4 2013-04-30  0.0190  0.0490  0.00122  0.0121   0.00964 
##  5 2013-05-31  0.0233 -0.0307  0.0420  -0.0495  -0.0202  
##  6 2013-06-28 -0.0134 -0.0271 -0.00140 -0.0547  -0.0158  
##  7 2013-07-31  0.0504  0.0519  0.0635   0.0132   0.00269 
##  8 2013-08-30 -0.0305 -0.0197 -0.0347  -0.0257  -0.00830 
##  9 2013-09-30  0.0312  0.0753  0.0639   0.0696   0.0111  
## 10 2013-10-31  0.0453  0.0321  0.0342   0.0409   0.00829
```



----



]


---



# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> En resumen...





```r
head(asset_returns_xts, 3)
```

```
##                   SPY         EFA        IJS          EEM           AGG
## 2013-01-31 0.04992331  0.03660646 0.05213307 -0.002935533 -0.0062318102
## 2013-02-28 0.01267733 -0.01296939 0.01617555 -0.023105048  0.0058919107
## 2013-03-31 0.03726817  0.01296939 0.04025826 -0.010235008  0.0009845203
```

```r
head(asset_returns_dplyr_byhand, 3)
```

```
## # A tibble: 3 × 6
##   date           SPY     EFA     IJS      EEM      AGG
##   &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 2012-12-31 NA      NA      NA      NA       NA      
## 2 2013-01-31  0.0499  0.0366  0.0521 -0.00294 -0.00623
## 3 2013-02-28  0.0127 -0.0130  0.0162 -0.0231   0.00589
```

```r
head(asset_returns_tq_builtin, 3)
```

```
## # A tibble: 3 × 6
##   date          SPY     EFA    IJS      EEM       AGG
##   &lt;date&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 2013-01-31 0.0499  0.0366 0.0521 -0.00294 -0.00623 
## 2 2013-02-28 0.0127 -0.0130 0.0162 -0.0231   0.00589 
## 3 2013-03-28 0.0373  0.0130 0.0403 -0.0102   0.000985
```




---



name: Vis
class: inverse, center, middle
background-color: #00081d

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i>
# Visualización
----

.right[
.bottom[
####  [<i class="fa fa-bell" role="presentation" aria-label="bell icon"></i>](#menu)
]
]

---

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`



.pull-left[

&lt;br&gt;

.center[
![](https://media.giphy.com/media/rM0wxzvwsv5g4/giphy.gif)


]
]

.pull-right[


&gt; Es una buena práctica graficar los rendimientos individuales porque una vez que se construye una cartera, es poco probable que retrocedamos para visualizar de forma individual. 

&gt; Sin embargo, esos rendimientos individuales son los componentes básicos y la materia prima de nuestra cartera y visualizarlos es una excelente manera de comprenderlos en profundidad.


&lt;br&gt;

.center[
### También presenta una oportunidad para buscar valores atípicos, errores o cualquier cosa inusual para corregir antes de avanzar demasiado en nuestro análisis.
]

]

---





# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`



.pull-left[

.center[
`Highcharter` es un paquete de R, pero Highcharts es una biblioteca de JavaScript. El paquete R es un enlace a la biblioteca de JavaScript. 


Highcharts es fantástico para visualizar series de tiempo y viene con excelentes widgets incorporados para ver diferentes marcos de tiempo, además de que podemos usar el poder de JavaScript sin salir del mundo del código R.

]

.center[
### Las visualizaciones no solo son agradables, sino que highcharter “simplemente funciona” con objetos xts en el sentido de que lee el índice como fechas sin necesidad de que se le indique.
]


]

.pull-right[


<div id="htmlwidget-4108de5147caf9a3b16c" style="width:450px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-4108de5147caf9a3b16c">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":"Monthly Log Returns"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"series":[{"data":[[1359590400000,0.0499233140253175],[1362009600000,0.0126773254939661],[1364688000000,0.0372681653008753],[1367280000000,0.0190303799707205],[1369958400000,0.0233350017346776],[1372550400000,-0.0134342028822907],[1375228800000,0.0503863712617605],[1377907200000,-0.0304514256433759],[1380499200000,0.0311558443329352],[1383177600000,0.0452665712293543],[1385769600000,0.0292069832582582],[1388448000000,0.0255962029302337],[1391126400000,-0.0358846123981502],[1393545600000,0.044510341196629],[1396224000000,0.00826164344892888],[1398816000000,0.00692710478057013],[1401494400000,0.0229411097128205],[1404086400000,0.0204349233270467],[1406764800000,-0.013529014012124],[1409443200000,0.0387050053752347],[1412035200000,-0.0138925330841859],[1414713600000,0.0232780629526932],[1417305600000,0.0271013449305588],[1419984000000,-0.00253980886434846],[1422662400000,-0.0300771285524899],[1425081600000,0.0546820119703266],[1427760000000,-0.0158303613031832],[1430352000000,0.00978603015693391],[1433030400000,0.0127740711131121],[1435622400000,-0.020521117850306],[1438300800000,0.0223376422363346],[1440979200000,-0.0628865451318301],[1443571200000,-0.025847318991584],[1446249600000,0.0816351406020868],[1448841600000,0.00364837469208101],[1451520000000,-0.0174334698646188],[1454198400000,-0.0510688533714161],[1456704000000,-0.000826116455503012],[1459382400000,0.0651002877199369],[1461974400000,0.00393352755805321],[1464652800000,0.0168683488903048],[1467244800000,0.00346993395002926],[1469923200000,0.0358218906066812],[1472601600000,0.00119679050805654],[1475193600000,5.7958606074493e-05],[1477872000000,-0.0174890864630504],[1480464000000,0.0361762188970518],[1483142400000,0.0200689170205068],[1485820800000,0.0177365683674005],[1488240000000,0.038539124099473],[1490918400000,0.00124917205526565],[1493510400000,0.00987726516146825],[1496188800000,0.0140141322801393],[1498780800000,0.00635482241941521],[1501459200000,0.0203457261527165],[1504137600000,0.00291353610257161],[1506729600000,0.0199490901407655],[1509408000000,0.0232907609122979],[1512000000000,0.0301078872750589],[1514678400000,0.0120551420361048]],"name":"SPY"},{"data":[[1359590400000,0.0366064648310447],[1362009600000,-0.0129693903605572],[1364688000000,0.0129693903605572],[1367280000000,0.0489679629269748],[1369958400000,-0.0306558681897044],[1372550400000,-0.0271444861874879],[1375228800000,0.0518605360181819],[1377907200000,-0.0197462369330137],[1380499200000,0.0753385205041912],[1383177600000,0.0320816410695519],[1385769600000,0.00544965841240286],[1388448000000,0.0215278681630262],[1391126400000,-0.0534131070787658],[1393545600000,0.0595050569459907],[1396224000000,-0.00460263497895408],[1398816000000,0.0165293821665276],[1401494400000,0.0158283818645071],[1404086400000,0.0091655921574163],[1406764800000,-0.0263798038581218],[1409443200000,0.00180028025823065],[1412035200000,-0.0395983253395138],[1414713600000,-0.0026549644371725],[1417305600000,0.000625306409741011],[1419984000000,-0.0407468318575557],[1422662400000,0.00622665198789818],[1425081600000,0.0614505288601483],[1427760000000,-0.0143886912100673],[1430352000000,0.0358164418766296],[1433030400000,0.00195284411427865],[1435622400000,-0.0316789215534135],[1438300800000,0.0201145590456528],[1440979200000,-0.0771525108347628],[1443571200000,-0.0451949069743227],[1446249600000,0.0640259315863894],[1448841600000,-0.00755578242137034],[1451520000000,-0.0235951816421993],[1454198400000,-0.0567575920158938],[1456704000000,-0.0339140998940786],[1459382400000,0.0637457289451273],[1461974400000,0.0219749587839266],[1464652800000,-0.000855898336672212],[1467244800000,-0.0244915330384505],[1469923200000,0.0390001699734737],[1472601600000,0.00532686784987302],[1475193600000,0.0132790829742926],[1477872000000,-0.0224037699356878],[1480464000000,-0.017974189605698],[1483142400000,0.02670286631851],[1485820800000,0.0323817589708835],[1488240000000,0.0118364457464009],[1490918400000,0.0318056820971027],[1493510400000,0.0239521745589353],[1496188800000,0.0348101998869326],[1498780800000,0.00295592012514234],[1501459200000,0.0261881359263256],[1504137600000,-0.000448507080916372],[1506729600000,0.0233428597055694],[1509408000000,0.0166536414489951],[1512000000000,0.00687014295884403],[1514678400000,0.01339821820459]],"name":"EFA"},{"data":[[1359590400000,0.0521330654000582],[1362009600000,0.0161755460340851],[1364688000000,0.0402582583110211],[1367280000000,0.00122230684399494],[1369958400000,0.041976390371762],[1372550400000,-0.00140298200642608],[1375228800000,0.0635412981471242],[1377907200000,-0.0347433138963362],[1380499200000,0.0638734687192466],[1383177600000,0.0342341168255231],[1385769600000,0.0416611690165682],[1388448000000,0.0128922806365375],[1391126400000,-0.035775461079536],[1393545600000,0.0452572435698522],[1396224000000,0.0133154646350331],[1398816000000,-0.0231842283142059],[1401494400000,0.0062052420498957],[1404086400000,0.037718733392909],[1406764800000,-0.0520093942572948],[1409443200000,0.0436578657043696],[1412035200000,-0.0612604759254167],[1414713600000,0.0688749304341649],[1417305600000,0.00477344854438],[1419984000000,0.0252959832771396],[1422662400000,-0.0546280550349212],[1425081600000,0.0569146198209749],[1427760000000,0.0101563315796156],[1430352000000,-0.0184176488293772],[1433030400000,0.0075097481463966],[1435622400000,0.00417145424636445],[1438300800000,-0.0273752557449294],[1440979200000,-0.0472685060430083],[1443571200000,-0.0384643812124024],[1446249600000,0.0635894166753848],[1448841600000,0.0244155070047238],[1451520000000,-0.0521570120195034],[1454198400000,-0.0603070856822665],[1456704000000,0.0206050044542883],[1459382400000,0.0899104409151841],[1461974400000,0.021044352087328],[1464652800000,0.00439719605434608],[1467244800000,0.00829243766655319],[1469923200000,0.0493482302285826],[1472601600000,0.0112610931568335],[1475193600000,0.00861473961417847],[1477872000000,-0.038134982631397],[1480464000000,0.125246444435491],[1483142400000,0.0314917134063251],[1485820800000,-0.012143648314531],[1488240000000,0.0134284001874629],[1490918400000,-0.00653287136829483],[1493510400000,0.00510747772906583],[1496188800000,-0.0228623659084723],[1498780800000,0.0291518061521199],[1501459200000,0.00748132009248526],[1504137600000,-0.0275645134151752],[1506729600000,0.0823218717584711],[1509408000000,0.00591577012694877],[1512000000000,0.036913183534443],[1514678400000,-0.00373123026173339]],"name":"IJS"},{"data":[[1359590400000,-0.00293553264760549],[1362009600000,-0.023105048341141],[1364688000000,-0.0102350081273652],[1367280000000,0.0120844802030495],[1369958400000,-0.0494830910089132],[1372550400000,-0.0547285994999793],[1375228800000,0.0131596398363492],[1377907200000,-0.0257055464247324],[1380499200000,0.0695886634492009],[1383177600000,0.040861709701733],[1385769600000,-0.00259438067539364],[1388448000000,-0.00407436178769505],[1391126400000,-0.0903225775871839],[1393545600000,0.033220572744928],[1396224000000,0.0380218609094882],[1398816000000,0.00777265038077335],[1401494400000,0.0290912262648066],[1404086400000,0.023733826866696],[1406764800000,0.0135557339323231],[1409443200000,0.0279045095833457],[1412035200000,-0.0808568044268081],[1414713600000,0.0140964241464703],[1417305600000,-0.0155410590424774],[1419984000000,-0.0404425014636951],[1422662400000,-0.00689534294008576],[1425081600000,0.043136032081303],[1427760000000,-0.0150862485795087],[1430352000000,0.0662813930244264],[1433030400000,-0.0419110538951024],[1435622400000,-0.0297465801854657],[1438300800000,-0.0651782102484697],[1440979200000,-0.0925121365460577],[1443571200000,-0.0318250814791154],[1446249600000,0.0618083715183539],[1448841600000,-0.0255606191365048],[1451520000000,-0.0389471731629074],[1454198400000,-0.0516365719027805],[1456704000000,-0.0082115800317264],[1459382400000,0.121878936705657],[1461974400000,0.00407923455938164],[1464652800000,-0.0376285173234971],[1467244800000,0.0445824480582195],[1469923200000,0.0524422087860557],[1472601600000,0.00879846483302194],[1475193600000,0.0248730341512484],[1477872000000,-0.00831214340048403],[1480464000000,-0.0451620811269571],[1483142400000,-0.00252994262540662],[1485820800000,0.0644314585521242],[1488240000000,0.017257814730042],[1490918400000,0.03618893015918],[1493510400000,0.0168664930795264],[1496188800000,0.0280600492867449],[1498780800000,0.00922359385487947],[1501459200000,0.0565946332520935],[1504137600000,0.023243569681759],[1506729600000,-0.000446022953084491],[1509408000000,0.0322784411188266],[1512000000000,-0.00389693606966457],[1514678400000,0.036925349877476]],"name":"EEM"},{"data":[[1359590400000,-0.0062318101672787],[1362009600000,0.00589191071815787],[1364688000000,0.000984520327842908],[1367280000000,0.00963904751985734],[1369958400000,-0.0202141337464541],[1372550400000,-0.0157783816772659],[1375228800000,0.00268818996389086],[1377907200000,-0.00829780115659684],[1380499200000,0.0111433911788081],[1383177600000,0.0082923878128307],[1385769600000,-0.00250952687364503],[1388448000000,-0.00558371432071425],[1391126400000,0.0152916456411454],[1393545600000,0.00375721696970732],[1396224000000,-0.00148197954448648],[1398816000000,0.00818374948584832],[1401494400000,0.0117214291648207],[1404086400000,-0.000576097566110434],[1406764800000,-0.00251181361921837],[1409443200000,0.0114305525179192],[1412035200000,-0.00616741795221376],[1414713600000,0.0105847458603172],[1417305600000,0.00654896393451043],[1419984000000,0.00147493115446373],[1422662400000,0.0203151180397771],[1425081600000,-0.00898837765353466],[1427760000000,0.00374041383549528],[1430352000000,-0.00323287988509691],[1433030400000,-0.00438359256633891],[1435622400000,-0.0108257571718777],[1438300800000,0.0085845739913557],[1440979200000,-0.00336372154707298],[1443571200000,0.00808152363054937],[1446249600000,0.000685759046739065],[1448841600000,-0.00389871783821771],[1451520000000,-0.00191883996225961],[1454198400000,0.0123299657285854],[1456704000000,0.00883181129789445],[1459382400000,0.0087084700082487],[1461974400000,0.00254641603150674],[1464652800000,0.000135645898330594],[1467244800000,0.0191667843155789],[1469923200000,0.00542954571769627],[1472601600000,-0.00215636598105018],[1475193600000,0.000516117556800033],[1477872000000,-0.00820534116189364],[1480464000000,-0.0259898653934254],[1483142400000,0.0025383485370627],[1485820800000,0.00212613432105968],[1488240000000,0.00643780108238445],[1490918400000,-0.000553068661093725],[1493510400000,0.00902936879325811],[1496188800000,0.00684765768971918],[1498780800000,-0.000182988680813345],[1501459200000,0.00333447190419722],[1504137600000,0.00936925419242218],[1506729600000,-0.00573201782373367],[1509408000000,0.000977827593528602],[1512000000000,-0.00148412025624545],[1514678400000,0.00474020042863366]],"name":"AGG"}],"navigator":{"enabled":false},"scrollbar":{"enabled":false},"legend":{"enabled":true}},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"stock","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>


]

---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`



.pull-left[


* Configuramos `highchart(type = "stock")` para obtener un formato de línea agradable que fue creado específicamente para acciones.

* Luego agregamos cada una de nuestras series al flujo de código.


----
.scroll-box-14[

```r
highchart(type = "stock") %&gt;%
hc_title(text = "Monthly Log Returns") %&gt;%
hc_add_series(asset_returns_xts[, symbols[1]],
name = symbols[1]) %&gt;%
hc_add_series(asset_returns_xts[, symbols[2]],
name = symbols[2]) %&gt;%
hc_add_series(asset_returns_xts[, symbols[3]],
name = symbols[3]) %&gt;%
hc_add_series(asset_returns_xts[, symbols[4]],
name = symbols[4]) %&gt;%
hc_add_series(asset_returns_xts[, symbols[5]],
name = symbols[5]) %&gt;%
hc_add_theme(hc_theme_flat()) %&gt;%
hc_navigator(enabled = FALSE) %&gt;%
hc_scrollbar(enabled = FALSE) %&gt;%
hc_exporting(enabled = TRUE) %&gt;%
hc_legend(enabled = TRUE)
```
]
----

]

.pull-right[


<div id="htmlwidget-beacc5cd2ca8db7a6cf9" style="width:450px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-beacc5cd2ca8db7a6cf9">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":"Monthly Log Returns"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"series":[{"data":[[1359590400000,0.0499233140253175],[1362009600000,0.0126773254939661],[1364688000000,0.0372681653008753],[1367280000000,0.0190303799707205],[1369958400000,0.0233350017346776],[1372550400000,-0.0134342028822907],[1375228800000,0.0503863712617605],[1377907200000,-0.0304514256433759],[1380499200000,0.0311558443329352],[1383177600000,0.0452665712293543],[1385769600000,0.0292069832582582],[1388448000000,0.0255962029302337],[1391126400000,-0.0358846123981502],[1393545600000,0.044510341196629],[1396224000000,0.00826164344892888],[1398816000000,0.00692710478057013],[1401494400000,0.0229411097128205],[1404086400000,0.0204349233270467],[1406764800000,-0.013529014012124],[1409443200000,0.0387050053752347],[1412035200000,-0.0138925330841859],[1414713600000,0.0232780629526932],[1417305600000,0.0271013449305588],[1419984000000,-0.00253980886434846],[1422662400000,-0.0300771285524899],[1425081600000,0.0546820119703266],[1427760000000,-0.0158303613031832],[1430352000000,0.00978603015693391],[1433030400000,0.0127740711131121],[1435622400000,-0.020521117850306],[1438300800000,0.0223376422363346],[1440979200000,-0.0628865451318301],[1443571200000,-0.025847318991584],[1446249600000,0.0816351406020868],[1448841600000,0.00364837469208101],[1451520000000,-0.0174334698646188],[1454198400000,-0.0510688533714161],[1456704000000,-0.000826116455503012],[1459382400000,0.0651002877199369],[1461974400000,0.00393352755805321],[1464652800000,0.0168683488903048],[1467244800000,0.00346993395002926],[1469923200000,0.0358218906066812],[1472601600000,0.00119679050805654],[1475193600000,5.7958606074493e-05],[1477872000000,-0.0174890864630504],[1480464000000,0.0361762188970518],[1483142400000,0.0200689170205068],[1485820800000,0.0177365683674005],[1488240000000,0.038539124099473],[1490918400000,0.00124917205526565],[1493510400000,0.00987726516146825],[1496188800000,0.0140141322801393],[1498780800000,0.00635482241941521],[1501459200000,0.0203457261527165],[1504137600000,0.00291353610257161],[1506729600000,0.0199490901407655],[1509408000000,0.0232907609122979],[1512000000000,0.0301078872750589],[1514678400000,0.0120551420361048]],"name":"SPY"},{"data":[[1359590400000,0.0366064648310447],[1362009600000,-0.0129693903605572],[1364688000000,0.0129693903605572],[1367280000000,0.0489679629269748],[1369958400000,-0.0306558681897044],[1372550400000,-0.0271444861874879],[1375228800000,0.0518605360181819],[1377907200000,-0.0197462369330137],[1380499200000,0.0753385205041912],[1383177600000,0.0320816410695519],[1385769600000,0.00544965841240286],[1388448000000,0.0215278681630262],[1391126400000,-0.0534131070787658],[1393545600000,0.0595050569459907],[1396224000000,-0.00460263497895408],[1398816000000,0.0165293821665276],[1401494400000,0.0158283818645071],[1404086400000,0.0091655921574163],[1406764800000,-0.0263798038581218],[1409443200000,0.00180028025823065],[1412035200000,-0.0395983253395138],[1414713600000,-0.0026549644371725],[1417305600000,0.000625306409741011],[1419984000000,-0.0407468318575557],[1422662400000,0.00622665198789818],[1425081600000,0.0614505288601483],[1427760000000,-0.0143886912100673],[1430352000000,0.0358164418766296],[1433030400000,0.00195284411427865],[1435622400000,-0.0316789215534135],[1438300800000,0.0201145590456528],[1440979200000,-0.0771525108347628],[1443571200000,-0.0451949069743227],[1446249600000,0.0640259315863894],[1448841600000,-0.00755578242137034],[1451520000000,-0.0235951816421993],[1454198400000,-0.0567575920158938],[1456704000000,-0.0339140998940786],[1459382400000,0.0637457289451273],[1461974400000,0.0219749587839266],[1464652800000,-0.000855898336672212],[1467244800000,-0.0244915330384505],[1469923200000,0.0390001699734737],[1472601600000,0.00532686784987302],[1475193600000,0.0132790829742926],[1477872000000,-0.0224037699356878],[1480464000000,-0.017974189605698],[1483142400000,0.02670286631851],[1485820800000,0.0323817589708835],[1488240000000,0.0118364457464009],[1490918400000,0.0318056820971027],[1493510400000,0.0239521745589353],[1496188800000,0.0348101998869326],[1498780800000,0.00295592012514234],[1501459200000,0.0261881359263256],[1504137600000,-0.000448507080916372],[1506729600000,0.0233428597055694],[1509408000000,0.0166536414489951],[1512000000000,0.00687014295884403],[1514678400000,0.01339821820459]],"name":"EFA"},{"data":[[1359590400000,0.0521330654000582],[1362009600000,0.0161755460340851],[1364688000000,0.0402582583110211],[1367280000000,0.00122230684399494],[1369958400000,0.041976390371762],[1372550400000,-0.00140298200642608],[1375228800000,0.0635412981471242],[1377907200000,-0.0347433138963362],[1380499200000,0.0638734687192466],[1383177600000,0.0342341168255231],[1385769600000,0.0416611690165682],[1388448000000,0.0128922806365375],[1391126400000,-0.035775461079536],[1393545600000,0.0452572435698522],[1396224000000,0.0133154646350331],[1398816000000,-0.0231842283142059],[1401494400000,0.0062052420498957],[1404086400000,0.037718733392909],[1406764800000,-0.0520093942572948],[1409443200000,0.0436578657043696],[1412035200000,-0.0612604759254167],[1414713600000,0.0688749304341649],[1417305600000,0.00477344854438],[1419984000000,0.0252959832771396],[1422662400000,-0.0546280550349212],[1425081600000,0.0569146198209749],[1427760000000,0.0101563315796156],[1430352000000,-0.0184176488293772],[1433030400000,0.0075097481463966],[1435622400000,0.00417145424636445],[1438300800000,-0.0273752557449294],[1440979200000,-0.0472685060430083],[1443571200000,-0.0384643812124024],[1446249600000,0.0635894166753848],[1448841600000,0.0244155070047238],[1451520000000,-0.0521570120195034],[1454198400000,-0.0603070856822665],[1456704000000,0.0206050044542883],[1459382400000,0.0899104409151841],[1461974400000,0.021044352087328],[1464652800000,0.00439719605434608],[1467244800000,0.00829243766655319],[1469923200000,0.0493482302285826],[1472601600000,0.0112610931568335],[1475193600000,0.00861473961417847],[1477872000000,-0.038134982631397],[1480464000000,0.125246444435491],[1483142400000,0.0314917134063251],[1485820800000,-0.012143648314531],[1488240000000,0.0134284001874629],[1490918400000,-0.00653287136829483],[1493510400000,0.00510747772906583],[1496188800000,-0.0228623659084723],[1498780800000,0.0291518061521199],[1501459200000,0.00748132009248526],[1504137600000,-0.0275645134151752],[1506729600000,0.0823218717584711],[1509408000000,0.00591577012694877],[1512000000000,0.036913183534443],[1514678400000,-0.00373123026173339]],"name":"IJS"},{"data":[[1359590400000,-0.00293553264760549],[1362009600000,-0.023105048341141],[1364688000000,-0.0102350081273652],[1367280000000,0.0120844802030495],[1369958400000,-0.0494830910089132],[1372550400000,-0.0547285994999793],[1375228800000,0.0131596398363492],[1377907200000,-0.0257055464247324],[1380499200000,0.0695886634492009],[1383177600000,0.040861709701733],[1385769600000,-0.00259438067539364],[1388448000000,-0.00407436178769505],[1391126400000,-0.0903225775871839],[1393545600000,0.033220572744928],[1396224000000,0.0380218609094882],[1398816000000,0.00777265038077335],[1401494400000,0.0290912262648066],[1404086400000,0.023733826866696],[1406764800000,0.0135557339323231],[1409443200000,0.0279045095833457],[1412035200000,-0.0808568044268081],[1414713600000,0.0140964241464703],[1417305600000,-0.0155410590424774],[1419984000000,-0.0404425014636951],[1422662400000,-0.00689534294008576],[1425081600000,0.043136032081303],[1427760000000,-0.0150862485795087],[1430352000000,0.0662813930244264],[1433030400000,-0.0419110538951024],[1435622400000,-0.0297465801854657],[1438300800000,-0.0651782102484697],[1440979200000,-0.0925121365460577],[1443571200000,-0.0318250814791154],[1446249600000,0.0618083715183539],[1448841600000,-0.0255606191365048],[1451520000000,-0.0389471731629074],[1454198400000,-0.0516365719027805],[1456704000000,-0.0082115800317264],[1459382400000,0.121878936705657],[1461974400000,0.00407923455938164],[1464652800000,-0.0376285173234971],[1467244800000,0.0445824480582195],[1469923200000,0.0524422087860557],[1472601600000,0.00879846483302194],[1475193600000,0.0248730341512484],[1477872000000,-0.00831214340048403],[1480464000000,-0.0451620811269571],[1483142400000,-0.00252994262540662],[1485820800000,0.0644314585521242],[1488240000000,0.017257814730042],[1490918400000,0.03618893015918],[1493510400000,0.0168664930795264],[1496188800000,0.0280600492867449],[1498780800000,0.00922359385487947],[1501459200000,0.0565946332520935],[1504137600000,0.023243569681759],[1506729600000,-0.000446022953084491],[1509408000000,0.0322784411188266],[1512000000000,-0.00389693606966457],[1514678400000,0.036925349877476]],"name":"EEM"},{"data":[[1359590400000,-0.0062318101672787],[1362009600000,0.00589191071815787],[1364688000000,0.000984520327842908],[1367280000000,0.00963904751985734],[1369958400000,-0.0202141337464541],[1372550400000,-0.0157783816772659],[1375228800000,0.00268818996389086],[1377907200000,-0.00829780115659684],[1380499200000,0.0111433911788081],[1383177600000,0.0082923878128307],[1385769600000,-0.00250952687364503],[1388448000000,-0.00558371432071425],[1391126400000,0.0152916456411454],[1393545600000,0.00375721696970732],[1396224000000,-0.00148197954448648],[1398816000000,0.00818374948584832],[1401494400000,0.0117214291648207],[1404086400000,-0.000576097566110434],[1406764800000,-0.00251181361921837],[1409443200000,0.0114305525179192],[1412035200000,-0.00616741795221376],[1414713600000,0.0105847458603172],[1417305600000,0.00654896393451043],[1419984000000,0.00147493115446373],[1422662400000,0.0203151180397771],[1425081600000,-0.00898837765353466],[1427760000000,0.00374041383549528],[1430352000000,-0.00323287988509691],[1433030400000,-0.00438359256633891],[1435622400000,-0.0108257571718777],[1438300800000,0.0085845739913557],[1440979200000,-0.00336372154707298],[1443571200000,0.00808152363054937],[1446249600000,0.000685759046739065],[1448841600000,-0.00389871783821771],[1451520000000,-0.00191883996225961],[1454198400000,0.0123299657285854],[1456704000000,0.00883181129789445],[1459382400000,0.0087084700082487],[1461974400000,0.00254641603150674],[1464652800000,0.000135645898330594],[1467244800000,0.0191667843155789],[1469923200000,0.00542954571769627],[1472601600000,-0.00215636598105018],[1475193600000,0.000516117556800033],[1477872000000,-0.00820534116189364],[1480464000000,-0.0259898653934254],[1483142400000,0.0025383485370627],[1485820800000,0.00212613432105968],[1488240000000,0.00643780108238445],[1490918400000,-0.000553068661093725],[1493510400000,0.00902936879325811],[1496188800000,0.00684765768971918],[1498780800000,-0.000182988680813345],[1501459200000,0.00333447190419722],[1504137600000,0.00936925419242218],[1506729600000,-0.00573201782373367],[1509408000000,0.000977827593528602],[1512000000000,-0.00148412025624545],[1514678400000,0.00474020042863366]],"name":"AGG"}],"navigator":{"enabled":false},"scrollbar":{"enabled":false},"legend":{"enabled":true}},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"stock","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>


]

---




# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`



.pull-left[

&lt;br&gt;

### `Highcharter` también tiene la capacidad de hacer histogramas. Un método es llamar primero a la función base `hist` en los datos junto con los argumentos para los breaks y `plot = FALSE`.





]

.pull-right[

----


```r
library(highcharter)

hc_hist &lt;- hist(asset_returns_xts[, symbols[1]],breaks = 50,plot = FALSE)


hchart(hc_hist, color = "cornflowerblue") %&gt;%
hc_title(text = paste(symbols[1], "Log Returns Distribution",
         sep = " ")) %&gt;%
         hc_add_theme(hc_theme_flat()) %&gt;%
         hc_exporting(enabled = TRUE) %&gt;%
         hc_legend(enabled = FALSE)  
```

----

]

---

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`


<div id="htmlwidget-0cdfe55bbaaa61f85025" style="width:900px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-0cdfe55bbaaa61f85025">{"x":{"hc_opts":{"chart":{"reflow":true,"zoomType":"x"},"title":{"text":"SPY Log Returns Distribution"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"tooltip":{"formatter":"function() { return  this.point.name + '<br/>' + this.y; }"},"series":[{"data":[{"x":-0.0625,"y":1,"name":"(-0.065, -0.06]"},{"x":-0.0575,"y":0,"name":"(-0.06, -0.055]"},{"x":-0.0525,"y":1,"name":"(-0.055, -0.05]"},{"x":-0.0475,"y":0,"name":"(-0.05, -0.045]"},{"x":-0.0425,"y":0,"name":"(-0.045, -0.04]"},{"x":-0.0375,"y":1,"name":"(-0.04, -0.035]"},{"x":-0.0325,"y":2,"name":"(-0.035, -0.03]"},{"x":-0.0275,"y":1,"name":"(-0.03, -0.025]"},{"x":-0.0225,"y":1,"name":"(-0.025, -0.02]"},{"x":-0.0175,"y":3,"name":"(-0.02, -0.015]"},{"x":-0.0125,"y":3,"name":"(-0.015, -0.01]"},{"x":-0.00750000000000001,"y":0,"name":"(-0.01, -0.005]"},{"x":-0.0025,"y":2,"name":"(-0.005, 0]"},{"x":0.0025,"y":7,"name":"(-6.93889390390723e-18, 0.005]"},{"x":0.00749999999999999,"y":5,"name":"(0.00499999999999999, 0.01]"},{"x":0.0125,"y":4,"name":"(0.01, 0.015]"},{"x":0.0175,"y":4,"name":"(0.015, 0.02]"},{"x":0.0225,"y":8,"name":"(0.02, 0.025]"},{"x":0.0275,"y":3,"name":"(0.025, 0.03]"},{"x":0.0325,"y":2,"name":"(0.03, 0.035]"},{"x":0.0375,"y":5,"name":"(0.035, 0.04]"},{"x":0.0425,"y":1,"name":"(0.04, 0.045]"},{"x":0.0475,"y":2,"name":"(0.045, 0.05]"},{"x":0.0525,"y":2,"name":"(0.05, 0.055]"},{"x":0.0575,"y":0,"name":"(0.055, 0.06]"},{"x":0.0625,"y":0,"name":"(0.06, 0.065]"},{"x":0.0675,"y":1,"name":"(0.065, 0.07]"},{"x":0.0725,"y":0,"name":"(0.07, 0.075]"},{"x":0.0775,"y":0,"name":"(0.075, 0.08]"},{"x":0.0825,"y":1,"name":"(0.08, 0.085]"}],"type":"column","pointRange":0.005,"groupPadding":0,"pointPadding":0,"borderWidth":0,"color":"cornflowerblue"}],"legend":{"enabled":false}},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>

---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`


```r
autoplot(asset_returns_xts,facets = TRUE)
```

![](6_Returns_files/figure-html/unnamed-chunk-23-1.png)&lt;!-- --&gt;



---

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[


&gt; `tidyverse` pide que estos datos estén en formato long o ordenado donde cada variable tiene su propia columna. Para que los retornos de activos estén ordenadas, necesitamos una columna llamada "date", una columna llamada "stock" y una columna llamada "returns".

&lt;br&gt;

* Este formato es más difícil de leer para un humano: solo podemos ver las primeras lecturas de un activo. Desde una perspectiva tidyverse, esto se considera "ordenado" y es el formato preferido.

&lt;br&gt;

* `ggplot2` es un paquete de visualización flexible y muy utilizado, y es parte del tidyverse.

]

.pull-right[

----


```r
asset_returns_long &lt;-
       asset_returns_dplyr_byhand %&gt;%
       gather(asset, returns, -date) %&gt;%
       group_by(asset)


head(asset_returns_long, 10)
```

```
## # A tibble: 10 × 3
## # Groups:   asset [1]
##    date       asset returns
##    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;
##  1 2012-12-31 SPY   NA     
##  2 2013-01-31 SPY    0.0499
##  3 2013-02-28 SPY    0.0127
##  4 2013-03-31 SPY    0.0373
##  5 2013-04-30 SPY    0.0190
##  6 2013-05-31 SPY    0.0233
##  7 2013-06-30 SPY   -0.0134
##  8 2013-07-31 SPY    0.0504
##  9 2013-08-31 SPY   -0.0305
## 10 2013-09-30 SPY    0.0312
```

----

]



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
ggplot(aes(x = returns, fill = asset)) +
geom_histogram(alpha = 0.45, binwidth = .005) +
ggtitle("Monthly Returns Since 2013")
```
----

Recuerde que puede tener dinámica el gráfico con `ggplotly` del paquete `plotly`


----

```r
library(plotly)

g1&lt;-asset_returns_long %&gt;%
ggplot(aes(x = returns, fill = asset)) +
geom_histogram(alpha = 0.45, binwidth = .005) +
ggtitle("Monthly Returns Since 2013")


ggplotly(g1)
```
----

]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-27-1.png)&lt;!-- --&gt;



]



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`

<div id="htmlwidget-b05edc9cd17ada1fa82c" style="width:100%;height:70%;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-b05edc9cd17ada1fa82c">{"x":{"data":[{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[1,1,0,1,1,0,2,2,4,5,3,8,4,7,11,5,10,5,11,12,19,15,19,12,15,12,11,9,6,7,3,3,8,2,1,2,0,1,0,0,0,0,0,1,1],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,4,10,14,12,14,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:  0<br />returns: -0.095<br />asset: AGG","count:  0<br />returns: -0.090<br />asset: AGG","count:  0<br />returns: -0.085<br />asset: AGG","count:  0<br />returns: -0.080<br />asset: AGG","count:  0<br />returns: -0.075<br />asset: AGG","count:  0<br />returns: -0.070<br />asset: AGG","count:  0<br />returns: -0.065<br />asset: AGG","count:  0<br />returns: -0.060<br />asset: AGG","count:  0<br />returns: -0.055<br />asset: AGG","count:  0<br />returns: -0.050<br />asset: AGG","count:  0<br />returns: -0.045<br />asset: AGG","count:  0<br />returns: -0.040<br />asset: AGG","count:  0<br />returns: -0.035<br />asset: AGG","count:  0<br />returns: -0.030<br />asset: AGG","count:  1<br />returns: -0.025<br />asset: AGG","count:  1<br />returns: -0.020<br />asset: AGG","count:  1<br />returns: -0.015<br />asset: AGG","count:  4<br />returns: -0.010<br />asset: AGG","count: 10<br />returns: -0.005<br />asset: AGG","count: 14<br />returns:  0.000<br />asset: AGG","count: 12<br />returns:  0.005<br />asset: AGG","count: 14<br />returns:  0.010<br />asset: AGG","count:  1<br />returns:  0.015<br />asset: AGG","count:  2<br />returns:  0.020<br />asset: AGG","count:  0<br />returns:  0.025<br />asset: AGG","count:  0<br />returns:  0.030<br />asset: AGG","count:  0<br />returns:  0.035<br />asset: AGG","count:  0<br />returns:  0.040<br />asset: AGG","count:  0<br />returns:  0.045<br />asset: AGG","count:  0<br />returns:  0.050<br />asset: AGG","count:  0<br />returns:  0.055<br />asset: AGG","count:  0<br />returns:  0.060<br />asset: AGG","count:  0<br />returns:  0.065<br />asset: AGG","count:  0<br />returns:  0.070<br />asset: AGG","count:  0<br />returns:  0.075<br />asset: AGG","count:  0<br />returns:  0.080<br />asset: AGG","count:  0<br />returns:  0.085<br />asset: AGG","count:  0<br />returns:  0.090<br />asset: AGG","count:  0<br />returns:  0.095<br />asset: AGG","count:  0<br />returns:  0.100<br />asset: AGG","count:  0<br />returns:  0.105<br />asset: AGG","count:  0<br />returns:  0.110<br />asset: AGG","count:  0<br />returns:  0.115<br />asset: AGG","count:  0<br />returns:  0.120<br />asset: AGG","count:  0<br />returns:  0.125<br />asset: AGG"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"AGG","legendgroup":"AGG","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[0,0,0,0,1,0,1,2,3,3,2,4,4,5,8,5,8,2,5,11,18,11,14,12,12,8,8,7,4,6,2,2,6,1,1,2,0,1,0,0,0,0,0,0,1],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[1,1,0,1,0,0,1,0,1,2,1,4,0,2,3,0,2,3,6,1,1,4,5,0,3,4,3,2,2,1,1,1,2,1,0,0,0,0,0,0,0,0,0,1,0],"text":["count:  1<br />returns: -0.095<br />asset: EEM","count:  1<br />returns: -0.090<br />asset: EEM","count:  0<br />returns: -0.085<br />asset: EEM","count:  1<br />returns: -0.080<br />asset: EEM","count:  0<br />returns: -0.075<br />asset: EEM","count:  0<br />returns: -0.070<br />asset: EEM","count:  1<br />returns: -0.065<br />asset: EEM","count:  0<br />returns: -0.060<br />asset: EEM","count:  1<br />returns: -0.055<br />asset: EEM","count:  2<br />returns: -0.050<br />asset: EEM","count:  1<br />returns: -0.045<br />asset: EEM","count:  4<br />returns: -0.040<br />asset: EEM","count:  0<br />returns: -0.035<br />asset: EEM","count:  2<br />returns: -0.030<br />asset: EEM","count:  3<br />returns: -0.025<br />asset: EEM","count:  0<br />returns: -0.020<br />asset: EEM","count:  2<br />returns: -0.015<br />asset: EEM","count:  3<br />returns: -0.010<br />asset: EEM","count:  6<br />returns: -0.005<br />asset: EEM","count:  1<br />returns:  0.000<br />asset: EEM","count:  1<br />returns:  0.005<br />asset: EEM","count:  4<br />returns:  0.010<br />asset: EEM","count:  5<br />returns:  0.015<br />asset: EEM","count:  0<br />returns:  0.020<br />asset: EEM","count:  3<br />returns:  0.025<br />asset: EEM","count:  4<br />returns:  0.030<br />asset: EEM","count:  3<br />returns:  0.035<br />asset: EEM","count:  2<br />returns:  0.040<br />asset: EEM","count:  2<br />returns:  0.045<br />asset: EEM","count:  1<br />returns:  0.050<br />asset: EEM","count:  1<br />returns:  0.055<br />asset: EEM","count:  1<br />returns:  0.060<br />asset: EEM","count:  2<br />returns:  0.065<br />asset: EEM","count:  1<br />returns:  0.070<br />asset: EEM","count:  0<br />returns:  0.075<br />asset: EEM","count:  0<br />returns:  0.080<br />asset: EEM","count:  0<br />returns:  0.085<br />asset: EEM","count:  0<br />returns:  0.090<br />asset: EEM","count:  0<br />returns:  0.095<br />asset: EEM","count:  0<br />returns:  0.100<br />asset: EEM","count:  0<br />returns:  0.105<br />asset: EEM","count:  0<br />returns:  0.110<br />asset: EEM","count:  0<br />returns:  0.115<br />asset: EEM","count:  1<br />returns:  0.120<br />asset: EEM","count:  0<br />returns:  0.125<br />asset: EEM"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(163,165,0,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"EEM","legendgroup":"EEM","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[0,0,0,0,0,0,1,2,1,3,1,2,3,3,4,2,6,1,3,6,13,9,8,9,8,5,5,6,4,4,2,0,4,1,0,2,0,1,0,0,0,0,0,0,1],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[0,0,0,0,1,0,0,0,2,0,1,2,1,2,4,3,2,1,2,5,5,2,6,3,4,3,3,1,0,2,0,2,2,0,1,0,0,0,0,0,0,0,0,0,0],"text":["count:  0<br />returns: -0.095<br />asset: EFA","count:  0<br />returns: -0.090<br />asset: EFA","count:  0<br />returns: -0.085<br />asset: EFA","count:  0<br />returns: -0.080<br />asset: EFA","count:  1<br />returns: -0.075<br />asset: EFA","count:  0<br />returns: -0.070<br />asset: EFA","count:  0<br />returns: -0.065<br />asset: EFA","count:  0<br />returns: -0.060<br />asset: EFA","count:  2<br />returns: -0.055<br />asset: EFA","count:  0<br />returns: -0.050<br />asset: EFA","count:  1<br />returns: -0.045<br />asset: EFA","count:  2<br />returns: -0.040<br />asset: EFA","count:  1<br />returns: -0.035<br />asset: EFA","count:  2<br />returns: -0.030<br />asset: EFA","count:  4<br />returns: -0.025<br />asset: EFA","count:  3<br />returns: -0.020<br />asset: EFA","count:  2<br />returns: -0.015<br />asset: EFA","count:  1<br />returns: -0.010<br />asset: EFA","count:  2<br />returns: -0.005<br />asset: EFA","count:  5<br />returns:  0.000<br />asset: EFA","count:  5<br />returns:  0.005<br />asset: EFA","count:  2<br />returns:  0.010<br />asset: EFA","count:  6<br />returns:  0.015<br />asset: EFA","count:  3<br />returns:  0.020<br />asset: EFA","count:  4<br />returns:  0.025<br />asset: EFA","count:  3<br />returns:  0.030<br />asset: EFA","count:  3<br />returns:  0.035<br />asset: EFA","count:  1<br />returns:  0.040<br />asset: EFA","count:  0<br />returns:  0.045<br />asset: EFA","count:  2<br />returns:  0.050<br />asset: EFA","count:  0<br />returns:  0.055<br />asset: EFA","count:  2<br />returns:  0.060<br />asset: EFA","count:  2<br />returns:  0.065<br />asset: EFA","count:  0<br />returns:  0.070<br />asset: EFA","count:  1<br />returns:  0.075<br />asset: EFA","count:  0<br />returns:  0.080<br />asset: EFA","count:  0<br />returns:  0.085<br />asset: EFA","count:  0<br />returns:  0.090<br />asset: EFA","count:  0<br />returns:  0.095<br />asset: EFA","count:  0<br />returns:  0.100<br />asset: EFA","count:  0<br />returns:  0.105<br />asset: EFA","count:  0<br />returns:  0.110<br />asset: EFA","count:  0<br />returns:  0.115<br />asset: EFA","count:  0<br />returns:  0.120<br />asset: EFA","count:  0<br />returns:  0.125<br />asset: EFA"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,125,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"EFA","legendgroup":"EFA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[0,0,0,0,0,0,1,0,0,1,0,0,1,2,1,1,6,0,1,4,6,4,4,7,6,3,3,2,2,2,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[0,0,0,0,0,0,0,2,1,2,1,2,2,1,3,1,0,1,2,2,7,5,4,2,2,2,2,4,2,2,1,0,3,1,0,1,0,1,0,0,0,0,0,0,1],"text":["count:  0<br />returns: -0.095<br />asset: IJS","count:  0<br />returns: -0.090<br />asset: IJS","count:  0<br />returns: -0.085<br />asset: IJS","count:  0<br />returns: -0.080<br />asset: IJS","count:  0<br />returns: -0.075<br />asset: IJS","count:  0<br />returns: -0.070<br />asset: IJS","count:  0<br />returns: -0.065<br />asset: IJS","count:  2<br />returns: -0.060<br />asset: IJS","count:  1<br />returns: -0.055<br />asset: IJS","count:  2<br />returns: -0.050<br />asset: IJS","count:  1<br />returns: -0.045<br />asset: IJS","count:  2<br />returns: -0.040<br />asset: IJS","count:  2<br />returns: -0.035<br />asset: IJS","count:  1<br />returns: -0.030<br />asset: IJS","count:  3<br />returns: -0.025<br />asset: IJS","count:  1<br />returns: -0.020<br />asset: IJS","count:  0<br />returns: -0.015<br />asset: IJS","count:  1<br />returns: -0.010<br />asset: IJS","count:  2<br />returns: -0.005<br />asset: IJS","count:  2<br />returns:  0.000<br />asset: IJS","count:  7<br />returns:  0.005<br />asset: IJS","count:  5<br />returns:  0.010<br />asset: IJS","count:  4<br />returns:  0.015<br />asset: IJS","count:  2<br />returns:  0.020<br />asset: IJS","count:  2<br />returns:  0.025<br />asset: IJS","count:  2<br />returns:  0.030<br />asset: IJS","count:  2<br />returns:  0.035<br />asset: IJS","count:  4<br />returns:  0.040<br />asset: IJS","count:  2<br />returns:  0.045<br />asset: IJS","count:  2<br />returns:  0.050<br />asset: IJS","count:  1<br />returns:  0.055<br />asset: IJS","count:  0<br />returns:  0.060<br />asset: IJS","count:  3<br />returns:  0.065<br />asset: IJS","count:  1<br />returns:  0.070<br />asset: IJS","count:  0<br />returns:  0.075<br />asset: IJS","count:  1<br />returns:  0.080<br />asset: IJS","count:  0<br />returns:  0.085<br />asset: IJS","count:  1<br />returns:  0.090<br />asset: IJS","count:  0<br />returns:  0.095<br />asset: IJS","count:  0<br />returns:  0.100<br />asset: IJS","count:  0<br />returns:  0.105<br />asset: IJS","count:  0<br />returns:  0.110<br />asset: IJS","count:  0<br />returns:  0.115<br />asset: IJS","count:  0<br />returns:  0.120<br />asset: IJS","count:  1<br />returns:  0.125<br />asset: IJS"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,176,246,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"IJS","legendgroup":"IJS","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[0,0,0,0,0,0,1,0,0,1,0,0,1,2,1,1,6,0,1,4,6,4,4,7,6,3,3,2,2,2,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0],"text":["count:  0<br />returns: -0.095<br />asset: SPY","count:  0<br />returns: -0.090<br />asset: SPY","count:  0<br />returns: -0.085<br />asset: SPY","count:  0<br />returns: -0.080<br />asset: SPY","count:  0<br />returns: -0.075<br />asset: SPY","count:  0<br />returns: -0.070<br />asset: SPY","count:  1<br />returns: -0.065<br />asset: SPY","count:  0<br />returns: -0.060<br />asset: SPY","count:  0<br />returns: -0.055<br />asset: SPY","count:  1<br />returns: -0.050<br />asset: SPY","count:  0<br />returns: -0.045<br />asset: SPY","count:  0<br />returns: -0.040<br />asset: SPY","count:  1<br />returns: -0.035<br />asset: SPY","count:  2<br />returns: -0.030<br />asset: SPY","count:  1<br />returns: -0.025<br />asset: SPY","count:  1<br />returns: -0.020<br />asset: SPY","count:  6<br />returns: -0.015<br />asset: SPY","count:  0<br />returns: -0.010<br />asset: SPY","count:  1<br />returns: -0.005<br />asset: SPY","count:  4<br />returns:  0.000<br />asset: SPY","count:  6<br />returns:  0.005<br />asset: SPY","count:  4<br />returns:  0.010<br />asset: SPY","count:  4<br />returns:  0.015<br />asset: SPY","count:  7<br />returns:  0.020<br />asset: SPY","count:  6<br />returns:  0.025<br />asset: SPY","count:  3<br />returns:  0.030<br />asset: SPY","count:  3<br />returns:  0.035<br />asset: SPY","count:  2<br />returns:  0.040<br />asset: SPY","count:  2<br />returns:  0.045<br />asset: SPY","count:  2<br />returns:  0.050<br />asset: SPY","count:  1<br />returns:  0.055<br />asset: SPY","count:  0<br />returns:  0.060<br />asset: SPY","count:  1<br />returns:  0.065<br />asset: SPY","count:  0<br />returns:  0.070<br />asset: SPY","count:  0<br />returns:  0.075<br />asset: SPY","count:  1<br />returns:  0.080<br />asset: SPY","count:  0<br />returns:  0.085<br />asset: SPY","count:  0<br />returns:  0.090<br />asset: SPY","count:  0<br />returns:  0.095<br />asset: SPY","count:  0<br />returns:  0.100<br />asset: SPY","count:  0<br />returns:  0.105<br />asset: SPY","count:  0<br />returns:  0.110<br />asset: SPY","count:  0<br />returns:  0.115<br />asset: SPY","count:  0<br />returns:  0.120<br />asset: SPY","count:  0<br />returns:  0.125<br />asset: SPY"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(231,107,243,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"SPY","legendgroup":"SPY","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":40.8401826484018,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Monthly Returns Since 2013","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.10875,0.13875],"tickmode":"array","ticktext":["-0.10","-0.05","0.00","0.05","0.10"],"tickvals":[-0.1,-0.05,0,0.05,0.1],"categoryorder":"array","categoryarray":["-0.10","-0.05","0.00","0.05","0.10"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"returns","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.55,32.55],"tickmode":"array","ticktext":["0","10","20","30"],"tickvals":[0,10,20,30],"categoryorder":"array","categoryarray":["0","10","20","30"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"asset","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"1e10700f1c61":{"x":{},"fill":{},"type":"bar"}},"cur_data":"1e10700f1c61","visdat":{"1e10700f1c61":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>


---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
ggplot(aes(x = returns, fill = asset)) +
geom_histogram(alpha = 0.45, binwidth = .01) +
facet_wrap(~asset) +
ggtitle("Monthly Returns Since 2013") +
theme_update(plot.title = element_text(hjust = 0.5))
```
----


]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-30-1.png)&lt;!-- --&gt;



]


---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
ggplot(aes(x = returns, colour = asset)) +
geom_density(alpha = 1) +
ggtitle("Monthly Returns Density Since 2013") +
xlab("monthly returns") +
ylab("distribution") +
theme_update(plot.title = element_text(hjust = 0.5))
```
----


]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-32-1.png)&lt;!-- --&gt;



]


---




# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
ggplot(aes(x = returns)) +
geom_density(aes(color = asset), alpha = 1) +
geom_histogram(aes(fill = asset), alpha = 0.45, binwidth = .01) +
guides(fill = FALSE) +
facet_wrap(~asset) +
ggtitle("Monthly Returns Since 2013") +
xlab("monthly returns") +
ylab("distribution") +
theme_update(plot.title = element_text(hjust = 0.5))
```
----


]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-34-1.png)&lt;!-- --&gt;



]


---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
  ggplot(aes(x = date, y = returns, color=asset)) +
  geom_line()+
  ggtitle("Monthly Returns Since 2013") +
  xlab("Date") +
  ylab("Returns") +
  theme_update(plot.title = element_text(hjust = 0.5))
```
----


]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-36-1.png)&lt;!-- --&gt;



]


---


name: portafolio
class: inverse, center, middle
background-color: #00081d

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i>
# Construcción de portafolio
----

.right[
.bottom[
####  [<i class="fa fa-bell" role="presentation" aria-label="bell icon"></i>](#menu)
]
]


---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio



.pull-left[

Recopilamos rendimientos individuales en una cartera, que es un conjunto ponderado de rendimientos de activos. 

En consecuencia, lo primero que debemos hacer es asignar un peso a cada activo. Recuerde que nuestra cartera tendrá la siguiente combinación de activos:

&lt;br&gt;

* SPY (S&amp;P500 ETF) `weighted 25%`
* EFA (a non-US equities ETF) `weighted 25%`
* IJS (a small-cap value ETF) `weighted 20%`
* EEM (an emerging-markets ETF) `weighted 20%`
* AGG (a bond ETF) `weighted 10%`


&gt; Siempre es mejor asegurarse que la suma de las proporciones de los activos sea del 100%.


]

.pull-right[




```r
w &lt;- c(0.25, 0.25, 0.20, 0.20, 0.10)

tibble(w, symbols)
```

```
## # A tibble: 5 × 2
##       w symbols
##   &lt;dbl&gt; &lt;chr&gt;  
## 1  0.25 SPY    
## 2  0.25 EFA    
## 3  0.2  IJS    
## 4  0.2  EEM    
## 5  0.1  AGG
```

```r
# Corroborar la suma de las proporciones
tibble(w, symbols) %&gt;%
summarise(total_weight = sum(w))
```

```
## # A tibble: 1 × 1
##   total_weight
##          &lt;dbl&gt;
## 1            1
```


]



---




# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio



.pull-left[

* Ahora usamos esos pesos para convertir los rendimientos de 5 activos en los rendimientos de una cartera.

&lt;br&gt;

* El rendimiento de una cartera de activos múltiples es igual a la suma de los rendimientos ponderados de cada activo.

&lt;br&gt;

* Podemos implementar eso asignando pesos a las variables de acuerdo con nuestro vector de pesos w.




]

.pull-right[




```r
w_1 &lt;- w[1]
w_2 &lt;- w[2]
w_3 &lt;- w[3]
w_4 &lt;- w[4]
w_5 &lt;- w[5]



asset1 &lt;- asset_returns_xts[,1]
asset2 &lt;- asset_returns_xts[,2]
asset3 &lt;- asset_returns_xts[,3]
asset4 &lt;- asset_returns_xts[,4]
asset5 &lt;- asset_returns_xts[,5]


portfolio_returns_byhand &lt;-
                  (w_1 * asset1) +
                  (w_2 * asset2) +
                  (w_3 * asset3) +
                  (w_4 * asset4) +
                  (w_5 * asset5)

names(portfolio_returns_byhand) &lt;- "returns"
```


]



---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `xts`



.pull-left[

&gt; Usaremos `Return.portfolio()` de `PerformanceAnalytics`, para calcular los retornos de la cartera. La función requiere dos argumentos para una cartera, un objeto de rendimiento `xts` y un vector de pesos. No es necesario, pero también vamos a establecer `rebalance_on = "months"` para que podamos confirmar que coincide con nuestros cálculos manuales anteriores.

&lt;br&gt;

.center[
Recuerde, en el cálculo manual, establecemos los pesos de la cartera como fijos, lo que significa que nunca cambiaron mes a mes. Eso equivale a reequilibrar cada mes. En la práctica, no hay una temporalidad estable para rebalancear el portafolio. Esto depende de las condiciones del mercado.
]



]

.pull-right[




```r
portfolio_returns_xts_rebalanced_monthly &lt;-
                       Return.portfolio(asset_returns_xts,
                       weights = w,
                       rebalance_on = "months") %&gt;%
                       `colnames&lt;-`("returns")

head(portfolio_returns_xts_rebalanced_monthly, 10)
```

```
##                  returns
## 2013-01-31  0.0308487702
## 2013-02-28 -0.0008697256
## 2013-03-31  0.0186624910
## 2013-04-30  0.0206248479
## 2013-05-31 -0.0053529701
## 2013-06-30 -0.0229488267
## 2013-07-31  0.0411707334
## 2013-08-31 -0.0254689678
## 2013-09-30  0.0544303568
## 2013-10-31  0.0351854572
```


]



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `xts`

### Visualizando...

.pull-left[


```r
highchart(type = "stock") %&gt;%
hc_title(text = "Portfolio Monthly Returns") %&gt;%
hc_add_series(portfolio_returns_xts_rebalanced_monthly$returns,
name = "Rebalanced Monthly",
color = "cornflowerblue") %&gt;%
hc_add_theme(hc_theme_flat()) %&gt;%
hc_navigator(enabled = FALSE) %&gt;%
hc_scrollbar(enabled = FALSE) %&gt;%
hc_legend(enabled = TRUE) %&gt;%
hc_exporting(enabled = TRUE)
```



]

.pull-right[



<div id="htmlwidget-83b353dabe10cf5b1e8a" style="width:450px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-83b353dabe10cf5b1e8a">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":"Portfolio Monthly Returns"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"series":[{"data":[[1359590400000,0.0308487702478533],[1362009600000,-0.00086972560624321],[1364688000000,0.0186624909848736],[1367280000000,0.0206248478858184],[1369958400000,-0.00535297011583236],[1372550400000,-0.0229488267364523],[1375228800000,0.0411707334130693],[1377907200000,-0.0254689678239708],[1380499200000,0.054430356760852],[1383177600000,0.0351854571614609],[1385769600000,0.0162265653985358],[1388448000000,0.012986230111012],[1391126400000,-0.0460148730384584],[1393545600000,0.0420751344955816],[1396224000000,0.0110340192719494],[1398816000000,0.00360018109867299],[1401494400000,0.0179238094737546],[1404086400000,0.0196330311664259],[1406764800000,-0.0179191178944775],[1409443200000,0.0255818517177013],[1412035200000,-0.0424129124715913],[1414713600000,0.0228085201310391],[1417305600000,0.00543303712890664],[1419984000000,-0.0137034707023408],[1422662400000,-0.0162357869321716],[1425081600000,0.048144427822721],[1427760000000,-0.0081667051447416],[1430352000000,0.020650078858891],[1433030400000,-0.00363689159952718],[1435622400000,-0.0192476107559378],[1438300800000,-0.00703918547904747],[1440979200000,-0.0633022646641687],[1443571200000,-0.0310102966667253],[1446249600000,0.0615634015905406],[1448841600000,-0.00159574614250035],[1451520000000,-0.0286698839094126],[1454198400000,-0.0481123462909783],[1456704000000,-0.0053231880730934],[1459382400000,0.0754402266912593],[1461974400000,0.0117564805179877],[1464652800000,-0.00262958702558902],[1467244800000,0.00723625580440723],[1469923200000,0.039606557519736],[1472601600000,0.00542718958934851],[1475193600000,0.0100834269038572],[1477872000000,-0.0200831734222501],[1480464000000,0.0179683934452026],[1483142400000,0.0177391348446443],[1485820800000,0.0231997573141955],[1488240000000,0.0193749155532079],[1490918400000,0.0141396184301597],[1493510400000,0.0137550909711452],[1496188800000,0.0139303854863946],[1498780800000,0.00998446676945774],[1501459200000,0.024782103379096],[1504137600000,0.000688993927972836],[1506729600000,0.0266249554402875],[1509408000000,0.0177227255988313],[1512000000000,0.0156993450258069],[1514678400000,0.0134761840261857]],"name":"Rebalanced Monthly","color":"cornflowerblue"}],"navigator":{"enabled":false},"scrollbar":{"enabled":false},"legend":{"enabled":true}},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"stock","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>


]



---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `xts`

### Visualizando...



```r
hc_portfolio &lt;-
hist(portfolio_returns_xts_rebalanced_monthly$returns,
breaks = 50,
plot = FALSE)
hchart(hc_portfolio,
color = "cornflowerblue",
name = "Portfolio") %&gt;%
hc_title(text = "Portfolio Returns Distribution") %&gt;%
hc_add_theme(hc_theme_flat()) %&gt;%
hc_exporting(enabled = TRUE)
```



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `xts`



<div id="htmlwidget-ce08968191dc9bfc0d26" style="width:900px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-ce08968191dc9bfc0d26">{"x":{"hc_opts":{"chart":{"reflow":true,"zoomType":"x"},"title":{"text":"Portfolio Returns Distribution"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"tooltip":{"formatter":"function() { return  this.point.name + '<br/>' + this.y; }"},"series":[{"data":[{"x":-0.063,"y":1,"name":"(-0.064, -0.062]"},{"x":-0.061,"y":0,"name":"(-0.062, -0.06]"},{"x":-0.059,"y":0,"name":"(-0.06, -0.058]"},{"x":-0.057,"y":0,"name":"(-0.058, -0.056]"},{"x":-0.055,"y":0,"name":"(-0.056, -0.054]"},{"x":-0.053,"y":0,"name":"(-0.054, -0.052]"},{"x":-0.051,"y":0,"name":"(-0.052, -0.05]"},{"x":-0.049,"y":1,"name":"(-0.05, -0.048]"},{"x":-0.047,"y":1,"name":"(-0.048, -0.046]"},{"x":-0.045,"y":0,"name":"(-0.046, -0.044]"},{"x":-0.043,"y":1,"name":"(-0.044, -0.042]"},{"x":-0.041,"y":0,"name":"(-0.042, -0.04]"},{"x":-0.039,"y":0,"name":"(-0.04, -0.038]"},{"x":-0.037,"y":0,"name":"(-0.038, -0.036]"},{"x":-0.035,"y":0,"name":"(-0.036, -0.034]"},{"x":-0.033,"y":0,"name":"(-0.034, -0.032]"},{"x":-0.031,"y":1,"name":"(-0.032, -0.03]"},{"x":-0.029,"y":1,"name":"(-0.03, -0.028]"},{"x":-0.027,"y":0,"name":"(-0.028, -0.026]"},{"x":-0.025,"y":1,"name":"(-0.026, -0.024]"},{"x":-0.023,"y":1,"name":"(-0.024, -0.022]"},{"x":-0.021,"y":1,"name":"(-0.022, -0.02]"},{"x":-0.019,"y":1,"name":"(-0.02, -0.018]"},{"x":-0.017,"y":2,"name":"(-0.018, -0.016]"},{"x":-0.015,"y":0,"name":"(-0.016, -0.014]"},{"x":-0.013,"y":1,"name":"(-0.014, -0.012]"},{"x":-0.011,"y":0,"name":"(-0.012, -0.01]"},{"x":-0.00900000000000001,"y":1,"name":"(-0.01, -0.00800000000000001]"},{"x":-0.00700000000000001,"y":1,"name":"(-0.00800000000000001, -0.00600000000000001]"},{"x":-0.00500000000000001,"y":2,"name":"(-0.00600000000000002, -0.00400000000000001]"},{"x":-0.00300000000000002,"y":2,"name":"(-0.00400000000000002, -0.00200000000000002]"},{"x":-0.00100000000000001,"y":2,"name":"(-0.00200000000000001, -6.93889390390723e-18]"},{"x":0.000999999999999994,"y":1,"name":"(-6.93889390390723e-18, 0.00199999999999999]"},{"x":0.00299999999999999,"y":1,"name":"(0.00199999999999999, 0.00399999999999999]"},{"x":0.00499999999999999,"y":2,"name":"(0.00399999999999999, 0.00599999999999999]"},{"x":0.00699999999999999,"y":1,"name":"(0.00599999999999999, 0.00799999999999999]"},{"x":0.00899999999999999,"y":1,"name":"(0.00799999999999999, 0.00999999999999999]"},{"x":0.011,"y":3,"name":"(0.00999999999999998, 0.012]"},{"x":0.013,"y":4,"name":"(0.012, 0.014]"},{"x":0.015,"y":2,"name":"(0.014, 0.016]"},{"x":0.017,"y":5,"name":"(0.016, 0.018]"},{"x":0.019,"y":3,"name":"(0.018, 0.02]"},{"x":0.021,"y":2,"name":"(0.02, 0.022]"},{"x":0.023,"y":2,"name":"(0.022, 0.024]"},{"x":0.025,"y":2,"name":"(0.024, 0.026]"},{"x":0.027,"y":1,"name":"(0.026, 0.028]"},{"x":0.029,"y":0,"name":"(0.028, 0.03]"},{"x":0.031,"y":1,"name":"(0.03, 0.032]"},{"x":0.033,"y":0,"name":"(0.032, 0.034]"},{"x":0.035,"y":1,"name":"(0.034, 0.036]"},{"x":0.037,"y":0,"name":"(0.036, 0.038]"},{"x":0.039,"y":1,"name":"(0.038, 0.04]"},{"x":0.041,"y":1,"name":"(0.04, 0.042]"},{"x":0.043,"y":1,"name":"(0.042, 0.044]"},{"x":0.045,"y":0,"name":"(0.044, 0.046]"},{"x":0.047,"y":0,"name":"(0.046, 0.048]"},{"x":0.049,"y":1,"name":"(0.048, 0.05]"},{"x":0.051,"y":0,"name":"(0.05, 0.052]"},{"x":0.053,"y":0,"name":"(0.052, 0.054]"},{"x":0.055,"y":1,"name":"(0.054, 0.056]"},{"x":0.057,"y":0,"name":"(0.056, 0.058]"},{"x":0.059,"y":0,"name":"(0.058, 0.06]"},{"x":0.061,"y":1,"name":"(0.06, 0.062]"},{"x":0.063,"y":0,"name":"(0.062, 0.064]"},{"x":0.065,"y":0,"name":"(0.064, 0.066]"},{"x":0.067,"y":0,"name":"(0.066, 0.068]"},{"x":0.069,"y":0,"name":"(0.068, 0.07]"},{"x":0.071,"y":0,"name":"(0.07, 0.072]"},{"x":0.073,"y":0,"name":"(0.072, 0.074]"},{"x":0.075,"y":1,"name":"(0.074, 0.076]"}],"type":"column","pointRange":0.002,"groupPadding":0,"pointPadding":0,"borderWidth":0,"color":"cornflowerblue","name":"Portfolio"}]},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>






---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyverse`



.pull-left[

&gt; Usamos `case_when()` para asignar pesos por activo, de modo que en el caso de que la columna de activos sea igual al activo 1 (SPY), asignamos un peso de 0,25, o w[1], y así sucesivamente.

&lt;br&gt;

----

```r
asset_returns_long %&gt;%
      group_by(asset) %&gt;%
      mutate(weights = case_when(asset == symbols[1] ~ w[1],
      asset == symbols[2] ~ w[2],
      asset == symbols[3] ~ w[3],
      asset == symbols[4] ~ w[4],
      asset == symbols[5] ~ w[5])) %&gt;%

  
head(20)
```
----

]

.pull-right[




```
## # A tibble: 20 × 4
## # Groups:   asset [1]
##    date       asset  returns weights
##    &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 2012-12-31 SPY   NA          0.25
##  2 2013-01-31 SPY    0.0499     0.25
##  3 2013-02-28 SPY    0.0127     0.25
##  4 2013-03-31 SPY    0.0373     0.25
##  5 2013-04-30 SPY    0.0190     0.25
##  6 2013-05-31 SPY    0.0233     0.25
##  7 2013-06-30 SPY   -0.0134     0.25
##  8 2013-07-31 SPY    0.0504     0.25
##  9 2013-08-31 SPY   -0.0305     0.25
## 10 2013-09-30 SPY    0.0312     0.25
## 11 2013-10-31 SPY    0.0453     0.25
## 12 2013-11-30 SPY    0.0292     0.25
## 13 2013-12-31 SPY    0.0256     0.25
## 14 2014-01-31 SPY   -0.0359     0.25
## 15 2014-02-28 SPY    0.0445     0.25
## 16 2014-03-31 SPY    0.00826    0.25
## 17 2014-04-30 SPY    0.00693    0.25
## 18 2014-05-31 SPY    0.0229     0.25
## 19 2014-06-30 SPY    0.0204     0.25
## 20 2014-07-31 SPY   -0.0135     0.25
```


]



---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyverse`



.pull-left[

&gt; A continuación, necesitamos implementar la ecuación para los rendimientos de la cartera. Esta tarea es un poco complicada pero sirve como una buena manera de usar la función `group_by()` con fechas. 

* Primero añadimos un nuevo objeto llamado `weighted_returns` que es el producto del rendimiento mensual de cada activo y su peso. 

* Luego, `group_by()` agrupa la columna de fecha porque cada uno de nuestros rendimientos ponderados debe sumarse para cada fecha. 

* Una vez que agrupamos por fecha, podemos usar `summarise(total = sum(weighted_returns))` para sumar los rendimientos ponderados mensuales.



]

.pull-right[




```r
portfolio_returns_dplyr_byhand &lt;-
      asset_returns_long %&gt;%
      group_by(asset) %&gt;%
      mutate(weights = case_when(asset == symbols[1] ~ w[1],
                                 asset == symbols[2] ~ w[2],
                                 asset == symbols[3] ~ w[3],
                                 asset == symbols[4] ~ w[4],
                                 asset == symbols[5] ~ w[5]),
                                 weighted_returns = returns * weights) %&gt;%
      group_by(date) %&gt;%
      summarise(returns = sum(weighted_returns))


head(portfolio_returns_dplyr_byhand, 10)
```


]



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyquant`



.pull-left[

&gt; En tidyquant, comenzamos de nuevo con nuestro objeto `asset_returns_long` largo y con formato ordenado, pero lo convertimos en rendimientos de cartera usando `tq_portafolio()`. 

* La función `tq_portfolio` toma un `tibble` y luego solicita una columna de activos para agrupar, una columna de retornos para encontrar datos de retorno y un vector de ponderaciones.

* Es similar a `Return.portfolio()` y, por lo tanto, también acepta el argumento `rebalance_on = "months"`. Dado que estamos reequilibrando por meses, deberíamos obtener nuevamente un objeto de rendimiento de cartera que coincida con nuestros objetos existentes.





]

.pull-right[




```r
portfolio_returns_tq_rebalanced_monthly &lt;-
          asset_returns_long %&gt;%
          tq_portfolio(assets_col = asset,
                       returns_col = returns,
                       weights = w,
                       col_rename = "returns",
                       rebalance_on = "months")

head(portfolio_returns_tq_rebalanced_monthly, 10)
```


]



---






# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyquant`

### Visualizando...

.pull-left[


```r
portfolio_returns_tq_rebalanced_monthly %&gt;%
   ggplot(aes(x = date, y = returns)) +
   geom_point(colour = "cornflowerblue")+
   xlab("date") +
   ylab("monthly return") +
   theme_update(plot.title = element_text(hjust = 0.5)) +
   ggtitle("Portfolio Returns Scatter") +
   scale_x_date(breaks = pretty_breaks(n=6))
```




]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-49-1.png)&lt;!-- --&gt;


]


---





# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyquant`

### Visualizando...

.pull-left[


```r
portfolio_returns_tq_rebalanced_monthly %&gt;%
     ggplot(aes(x = returns)) +
     geom_histogram(binwidth = .005,
     fill = "cornflowerblue",
     color = "cornflowerblue") +
     ggtitle("Portfolio Returns Distribution") +
     theme_update(plot.title = element_text(hjust = 0.5))
```




]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-51-1.png)&lt;!-- --&gt;


]



---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyverse`

### Visualizando...

.pull-left[


```r
asset_returns_long %&gt;%
         ggplot(aes(x = returns,
         fill = asset)) +
         geom_histogram(alpha = 0.15,
         binwidth = .01) +
         geom_histogram(data = portfolio_returns_tq_rebalanced_monthly,
         fill = "cornflowerblue",
         binwidth = .01) +
         ggtitle("Portfolio and Asset Monthly Returns") +
         theme_update(plot.title = element_text(hjust = 0.5))
```




]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-53-1.png)&lt;!-- --&gt;


]



---






# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyverse`

### Visualizando...

.pull-left[


```r
portfolio_returns_tq_rebalanced_monthly %&gt;%
             ggplot(aes(x = returns)) +
             geom_histogram(binwidth = .01,
             colour = "cornflowerblue",
             fill = "cornflowerblue") +
             geom_density(alpha = 1, color = "red") +
             xlab("monthly returns") +
             ylab("distribution") +
             theme_update(plot.title = element_text(hjust = 0.5)) +
             ggtitle("Portfolio Histogram and Density")
```




]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-55-1.png)&lt;!-- --&gt;


]



---


name: shiny
class: inverse, center, middle
background-color: #00081d

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i>
# Shiny App
----

.right[
.bottom[
####  [<i class="fa fa-bell" role="presentation" aria-label="bell icon"></i>](#menu)
]
]


---

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Shiny App

.center[
&lt;img src="img/Dashboard.JPG" width="100%" /&gt;
]


---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Shiny App


.scroll-box-18[
````
---
title: "Returns Distribution"
runtime: shiny
output:
  flexdashboard::flex_dashboard:
    orientation: rows
---


```{r setup, message = FALSE}
library(tidyverse)
library(highcharter)
library(tidyquant)
library(timetk)
```

Sidebar {.sidebar}
=====================================
  
```{r}

fluidRow(
  column(6,
  textInput("stock1", "Stock 1", "SPY")),
  column(5,
  numericInput("w1", "Weight %", 25, min = 1, max = 100))
)  

fluidRow(
  column(6,
  textInput("stock2", "Stock 2", "EFA")),
  column(5,
  numericInput("w2", "Weight %", 25, min = 1, max = 100))
)

fluidRow(
  column(6,
  textInput("stock3", "Stock 3", "IJS")),
  column(5,
  numericInput("w3", "Weight %", 20, min = 1, max = 100))
)

fluidRow(
  column(6,
  textInput("stock4", "Stock 4", "EEM")),
  column(5,
  numericInput("w4", "Weight %", 20, min = 1, max = 100))
)

fluidRow(
  column(6,
  textInput("stock5", "Stock 5", "AGG")),
  column(5,
  numericInput("w5", "Weight %", 10, min = 1, max = 100))
)

fluidRow(
  column(7,
  dateInput("date", "Starting Date", "2013-01-01", format = "yyyy-mm-dd"))
)

fluidRow(
  column(7,
  selectInput("rebalance", "Rebalance",
              c("Yearly" = "years",
                "Monthly" = "months",
                "Weekly" = "weeks"))
  )
)

actionButton("go", "Submit")

portfolio_returns_byhand &lt;- eventReactive(input$go, {
  
  symbols &lt;- c(input$stock1, input$stock2, input$stock3, input$stock4, input$stock5)
  
  prices &lt;- getSymbols(symbols, src = 'yahoo', from = input$date, 
             auto.assign = TRUE, warnings = FALSE) %&gt;% 
  map(~Ad(get(.))) %&gt;% 
  reduce(merge) %&gt;%
    `colnames&lt;-`(symbols)

  w &lt;- c(input$w1/100, input$w2/100, 
         input$w3/100, input$w4/100, input$w5/100)
  
  asset_returns_long &lt;- 
      prices %&gt;% 
      to.monthly(indexAt = "last", OHLC = FALSE) %&gt;% 
      tk_tbl(preserve_index = TRUE, rename_index = "date") %&gt;%
      gather(asset, returns, -date) %&gt;% 
      group_by(asset) %&gt;%  
      mutate(returns = (log(returns) - log(lag(returns))))

  portfolio_returns_byhand &lt;- 
    asset_returns_long %&gt;% 
    tq_portfolio(assets_col = asset, 
               returns_col = returns, 
               weights = w,
               col_rename = "returns")
  
})

```

Returns
=====================================  


Row {.tabset .tabset-fade}
-------------------------------------


### Histogram

```{r}
renderPlot({
  portfolio_returns_byhand() %&gt;% 
    ggplot(aes(x = returns)) +
    geom_histogram(alpha = 0.25, binwidth = .01, fill = "cornflowerblue")
})
```

### Density

```{r}
renderPlot({
  portfolio_returns_byhand() %&gt;% 
    ggplot(aes(x = returns)) +
  geom_density(size = 1, color = "red") 
})
```


### Histogram + Density

```{r}
renderPlot({
  portfolio_returns_byhand() %&gt;% 
    ggplot(aes(x = returns)) +
    geom_histogram(alpha = 0.25, binwidth = .01, fill = "cornflowerblue") +
    geom_density(geom = "line", size = 1, color = "red") 
})
```
````
]


---



class: inverse, center, middle
background-color: #00081d




.pull-left[

.center[
&lt;br&gt;&lt;br&gt;

# Gracias!!!

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;



### Preguntas?
]


]


.pull-right[


.center[

&lt;br&gt;&lt;br&gt;&lt;br&gt;


.center[
&lt;img style="border-radius: 50%;" src="img/avatar.png"
width="100px" href="https://www.joaquibarandica.com"
/&gt;

<span>&lt;i class="fas  fa-envelope faa-passing animated "&gt;&lt;/i&gt;</span> orlando.joaqui@correounivalle.edu.co 
]


&lt;img src="img/qr-code.png" width="50%" style="display: block; margin: auto;" /&gt;


.center[
www.joaquibarandica.com
]



]


]


&lt;br&gt;&lt;br&gt;&lt;br&gt;
----

*The images used to set the presentation are from [pixabay](https://pixabay.com/).*




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="cols_macro.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
