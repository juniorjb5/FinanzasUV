<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Returns</title>
    <meta charset="utf-8" />
    <meta name="author" content="PhD.(C). Orlando Joaqui-Barandica" />
    <meta name="date" content="2023-01-01" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies.css" rel="stylesheet" />
    <link href="libs/remark-css/rladies-fonts.css" rel="stylesheet" />
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <link href="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <script src="libs/proj4js/proj4.js"></script>
    <link href="libs/highcharts/css/motion.css" rel="stylesheet" />
    <script src="libs/highcharts/highcharts.js"></script>
    <script src="libs/highcharts/highcharts-3d.js"></script>
    <script src="libs/highcharts/highcharts-more.js"></script>
    <script src="libs/highcharts/modules/stock.js"></script>
    <script src="libs/highcharts/modules/map.js"></script>
    <script src="libs/highcharts/modules/data.js"></script>
    <script src="libs/highcharts/modules/exporting.js"></script>
    <script src="libs/highcharts/modules/offline-exporting.js"></script>
    <script src="libs/highcharts/modules/drilldown.js"></script>
    <script src="libs/highcharts/modules/item-series.js"></script>
    <script src="libs/highcharts/modules/overlapping-datalabels.js"></script>
    <script src="libs/highcharts/modules/annotations.js"></script>
    <script src="libs/highcharts/modules/export-data.js"></script>
    <script src="libs/highcharts/modules/funnel.js"></script>
    <script src="libs/highcharts/modules/heatmap.js"></script>
    <script src="libs/highcharts/modules/treemap.js"></script>
    <script src="libs/highcharts/modules/sankey.js"></script>
    <script src="libs/highcharts/modules/dependency-wheel.js"></script>
    <script src="libs/highcharts/modules/organization.js"></script>
    <script src="libs/highcharts/modules/solid-gauge.js"></script>
    <script src="libs/highcharts/modules/streamgraph.js"></script>
    <script src="libs/highcharts/modules/sunburst.js"></script>
    <script src="libs/highcharts/modules/vector.js"></script>
    <script src="libs/highcharts/modules/wordcloud.js"></script>
    <script src="libs/highcharts/modules/xrange.js"></script>
    <script src="libs/highcharts/modules/tilemap.js"></script>
    <script src="libs/highcharts/modules/venn.js"></script>
    <script src="libs/highcharts/modules/gantt.js"></script>
    <script src="libs/highcharts/modules/timeline.js"></script>
    <script src="libs/highcharts/modules/parallel-coordinates.js"></script>
    <script src="libs/highcharts/modules/bullet.js"></script>
    <script src="libs/highcharts/modules/coloraxis.js"></script>
    <script src="libs/highcharts/modules/dumbbell.js"></script>
    <script src="libs/highcharts/modules/lollipop.js"></script>
    <script src="libs/highcharts/modules/series-label.js"></script>
    <script src="libs/highcharts/plugins/motion.js"></script>
    <script src="libs/highcharts/custom/reset.js"></script>
    <script src="libs/highcharts/modules/boost.js"></script>
    <script src="libs/highchart-binding/highchart.js"></script>
    <script src="libs/plotly-binding/plotly.js"></script>
    <script src="libs/typedarray/typedarray.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link href="libs/plotly-htmlwidgets-css/plotly-htmlwidgets.css" rel="stylesheet" />
    <script src="libs/plotly-main/plotly-latest.min.js"></script>
    <link href="libs/font-awesome-animation/font-awesome-animation-emi.css" rel="stylesheet" />
    <script src="libs/fontawesome/js/fontawesome-all.min.js"></script>
    <link rel="stylesheet" href="sydney.css" type="text/css" />
    <link rel="stylesheet" href="fonts_mtheme.css" type="text/css" />
    <link rel="stylesheet" href="cols.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">






class: inverse, left, bottom
background-image: url("img/fondo.jpg")
background-size: cover


# **Returns**
----

## **Universidad del Valle - Escuela Ingeniería Industrial**

### PhD.(C). Orlando Joaqui-Barandica
### 2023






---

background-image: url("img/Logo.jpg")
background-size: cover


---
name: hola
class: inverse, middle, center
background-color: #E31D1D

&lt;img style="border-radius: 50%;" src="img/uv3.jpg"
width="150px"
/&gt;

# Universidad del Valle


---





&lt;br&gt;&lt;br&gt;

.center[
&lt;img style="border-radius: 50%;" src="img/avatar.png"
width="160px" href="https://www.joaquibarandica.com"
/&gt;

[PhD.(C) Orlando Joaqui-Barandica](https://www.joaquibarandica.com) &lt;br/&gt;
Universidad del Valle
]

&lt;br&gt;



.center[

*PhD.(C) Ingeniería con enfásis en Ingeniería Industrial* 
 
*MSc. Economía Aplicada*
 
*Estadístico*

&lt;br&gt;

<i class="fas  fa-link fa-spin "></i> [www.joaquibarandica.com](https://www.joaquibarandica.com)

]





---

class: center, middle

&lt;img src="img/gifinc.jpg" width="50%"/&gt;

### [https://gifinc.univalle.edu.co/](https://gifinc.univalle.edu.co/)


---

name: menu
background-image: url("img/back2.jpg")
background-size: cover
class: left, middle


# Contenido

----


.pull-left[
### <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> [Cálculo de retornos](#retornos)
* xts
* tidyverse
* tidyquant


### <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> [Visualización](#Vis)
* xts
* tidyverse


]


.pull-right[

### <i class="fa fa-cubes" role="presentation" aria-label="cubes icon"></i> [Construcción de portafolio](#portafolio)
* xts
* tidyverse
* tidyquant


###  <i class="fa fa-cubes" role="presentation" aria-label="cubes icon"></i> [Shiny App](#shiny)

]

---

name: retornos
class: inverse, center, middle
background-color: #00081d

# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i>
# Cálculo de retornos
----

.right[
.bottom[
####  [<i class="fa fa-bell" role="presentation" aria-label="bell icon"></i>](#menu)
]
]

---




## Qué es una cartera de inversión?


Una cartera de inversión es el conjunto de activos financieros que pertenecen a una persona o por una institución, ya sea una sociedad o un fondo.



.pull-left[

&lt;img src="img/img1.png" width="300px" style="display: block; margin: auto;" /&gt;



 ]

.pull-right[

&gt; Qué puede contener una cartera?

- Acciones
- Obligaciones
- Materias primas
- Fondos
- Pólizas
- Etc.

]

---




## Asignación de activos y riesgo


#### La cartera refleja la propensión al riesgo del inversor, así como el horizonte temporal y los objetivos de su inversión.


.center[

## Rentabilidad vs Riesgo




&lt;img src="https://media.giphy.com/media/xT8qBit7YomT80d0M8/giphy.gif" width="20%"/&gt;

]


.center[
`Diversificar correctamente la inversión permitirá que la cartera esté expuesta a menos riesgos que si se invierte en una única clase de activos o en un único título.`
]


---


background-image: url("https://media.giphy.com/media/m65GQLUX8faUw/giphy.gif")
background-size: cover
class: inverse, center, middle

# Rentabilidad vs Riesgo

---



## ¿Por qué crear una cartera de inversión?


.pull-left[

.center[

## La creación de una cartera de inversión obedece a la necesidad del inversor de diversificar sus inversiones

## con el fin de..

## reducir sus riesgos de pérdida.

]

]



.pull-right[

&lt;br&gt;
&lt;br&gt;

.center[
&lt;img src="https://media.giphy.com/media/MRxJqmk3MNta8/giphy.gif" width="90%"/&gt;
]
]


---


## ¿Quién gestiona la cartera de inversión?



.center[
&lt;img src="https://media.giphy.com/media/3o6wroTygkjop77QiY/giphy.gif" width="40%"/&gt;
]


.center[
### La cartera pertenece al inversor  pero puede ser gestionada por un profesional financiero, por un banco, por un fondo o por otras instituciones financieras.
]

---

## Diversificar y cubrir riesgos


.pull-left[

&lt;br&gt;

La principal premisa de cualquier portafolio de inversión, especialmente a largo plazo, es alcanzar el equilibrio.

----
&gt;Independientemente del **perfil inversor de cada persona**, una buena cartera debe de ser capaz de cubrir los riesgos de los activos `más agresivos` con otros más `conservadores.`

----

&lt;br&gt;

.center[
### Diversificar la inversión es la mejor fórmula para lograrlo.
]

]


.pull-right[



.center[

&lt;img src="img/img2.png" width="600px" style="display: block; margin: auto;" /&gt;


&lt;br&gt;


Del mismo modo que en bolsa no es recomendable tener acciones sólo de una empresa o de un sector en concreto, tampoco hay que fiar todo el patrimonio a un tipo de inversión o familia de productos
]




]


---

background-image: url("https://media.giphy.com/media/5UEO7c7Ubk5pKQYwje/giphy.gif")
background-size: cover
class: inverse, center, middle

# ¿Cuánto invertir en cada activo?


---

class: left, bottom
background-image: url("img/back1.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back2.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back3.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back4.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back5.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back6.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back7.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back8.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back9.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back10.png")
background-size: cover


---

class: left, bottom
background-image: url("img/back11.png")
background-size: cover


---


background-image: url("https://media.giphy.com/media/3o7abIileRivlGr8Nq/giphy.gif")
background-size: cover
class: inverse, center, middle

# Hoy ganamos!!... mañana?



---



# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Packages


Los siguientes son los paquetes que serán utilizados en los temas del curso.


----

.scroll-box-20[

```r
# tidyverse contains the packages tidyr, ggplot2, dplyr,
# readr, purrr and tibble
install.packages("tidyverse")
install.packages("lubridate")
install.packages("readxl")
install.packages("highcharter")
install.packages("tidyquant")
install.packages("timetk")
install.packages("tibbletime")
install.packages("quantmod")
install.packages("PerformanceAnalytics")
install.packages("scales")


library(tidyverse)
library(lubridate)
library(readxl)
library(highcharter)
library(tidyquant)
library(timetk)
library(tibbletime)
library(quantmod)
library(PerformanceAnalytics)
library(scales)
```
]

----


---

# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


En nuestro tema de rendimientos de activos `(asset returns)` tomaremos datos de precios sin procesar para 5 activos individuales y los transformaremos en rendimientos mensuales para una sola cartera `(portfolio)`. 



.pull-left[

Nuestro portafolio consiste en los siguientes ETFs (Exchange Traded Funds)

- SPY (S&amp;P500 ETF) `weighted 25%`
- EFA (a non-US equities ETF) `weighted 25%`
- IJS (a small-cap value ETF) `weighted 20%`
- EEM (an emerging-markets ETF) `weighted 20%`
- AGG (a bond ETF) `weighted 10%`


### Enfoques

Trabajaremos tres enfoques de codificación:

* xts
* tidyverse
* tidyquant


]


.pull-right[

&lt;br&gt;

![](https://media.giphy.com/media/l0HlDDyxBfSaPpU88/giphy.gif)


]


---



# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Cargar los precios diarios

.pull-left[

Lo hacemos con los `symbols &lt;- c("SPY", "EFA", "IJS", "EEM", "AGG")`. Esos son los tickers de los 5 activos de nuestra cartera. Si desea cambiar a diferentes activos para realizar pruebas, cambie esos tickers. Tenga en cuenta que si desea elegir diferentes tickers de acciones o crear una cartera diferente, cambie los tickers en el vector de símbolos.

----


```r
symbols &lt;- c("SPY","EFA", "IJS", "EEM","AGG")
```

----

Importaremos los 5 ETFs en un objeto `xts` llamado precios.


]


.pull-right[

La función `getSymbols()` del paquete `quantmod` nos permite realizar lectura de los datos diarios desde [Yahoo! Finance](https://finance.yahoo.com/).



&lt;br&gt;

Esto devolverá un objeto con el precio de apertura, precio de cierre, precio ajustado, máximo diario, mínimo diario y volumen diario para cada ticker.


]


---



# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Cargar los precios diarios

.pull-left[


&lt;br&gt;

----


```r
prices &lt;-
getSymbols(symbols,
           src = 'yahoo',
           from = "2012-12-31",
           to = "2017-12-31",
           auto.assign = TRUE,
           warnings = FALSE) %&gt;%
map(~Ad(get(.)))
```

----

Note que la fuente se especifica desde Yahoo! Finance con `src = 'yahoo'`.

]


.pull-right[


* Estamos imponiendo una fecha de inicio de "2012-12-31" y una fecha de finalización de "2017-12-31". Eso significa que trabajaremos con 5 años de datos (cuando convertimos a rendimientos mensuales, perderemos diciembre de 2012)


&lt;br&gt;


* Para aislar el precio ajustado, usamos la función `map()` del paquete `purrr` y aplicamos `Ad(get(.))` a los precios. Esto obtendrá el precio ajustado de cada una de nuestras series individuales. Si quisieramos el precio de cierre sería: `Cl(get(.))`.
Aquí, el `.` hace referencia a nuestro objeto inicial.

]


---





# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Cargar los precios diarios

.pull-left[


&lt;br&gt;

----


```r
prices &lt;-
getSymbols(symbols,
           src = 'yahoo',
           from = "2012-12-31",
           to = "2017-12-31",
           auto.assign = TRUE,
           warnings = FALSE) %&gt;%
map(~Ad(get(.))) %&gt;%
reduce(merge) %&gt;%
`colnames&lt;-`(symbols)
```

----

]


.pull-right[

&lt;br&gt;

* `map()` devuelve una lista de 5 objetos `xts`.


* `reduce(merge)` fusionará las 5 listas en un solo objeto `xts`.

* `merge()` busca el índice de fecha compartido por nuestros objetos y usa ese índice para alinear los datos.

* `colnames &lt;-` renombra las columnas de acuerdo  al objeto `symbols`

]


---




# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Cargar los precios diarios desde un external file

.pull-left[



----


```r
# Desde .csv
prices &lt;-
      read_csv("path to your data.csv",
          col_types =
          cols(date =
          col_date(format = "%Y-%m-%d"))) %&gt;%
tk_xts(date_var = date)


# Desde .xlsx
prices &lt;-
       read_excel("path to your excel spreadsheet",
                 col_types = c("text", "numeric",
                 "numeric", "numeric",
                 "numeric", "numeric")) %&gt;%
mutate(date = ymd(date)) %&gt;%
tk_xts(date_var = date)
```

----

]


.pull-right[



* Para cargar el archivo usamos la función `read_csv()`  del paquete `readr`. Si la extensión es *.csv*, si hay otras extensiones como *.xlsx* se puede utilizar la función `read_xlsx()` o `read_excel` del paquete `readxl`.


* `tk_xts(date_var = date)` convierte el data frame en `xts`.

* `ymd()` del paquete `lubridate` convierte a formato fecha el vector.

* `mutate()` crea una variable.

]


---





# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> Asset Prices to Returns


### Al final tenemos...

.pull-left[



----


```r
symbols &lt;- c("SPY","EFA", "IJS", "EEM","AGG")


prices &lt;-
getSymbols(symbols,
           src = 'yahoo',
           from = "2012-12-31",
           to = "2017-12-31",
           auto.assign = TRUE,
           warnings = FALSE) %&gt;%
map(~Ad(get(.))) %&gt;%
reduce(merge) %&gt;%
`colnames&lt;-`(symbols)

head(prices,10)
```

----

]


.pull-right[





```
##                 SPY      EFA      IJS      EEM      AGG
## 2012-12-31 117.8270 42.50938 34.73629 35.77433 87.01148
## 2013-01-02 120.8469 43.16727 35.68938 36.47609 86.90965
## 2013-01-03 120.5739 42.74861 35.64216 36.21797 86.69034
## 2013-01-04 121.1034 42.96541 35.92122 36.29057 86.78437
## 2013-01-07 120.7725 42.77851 35.71085 36.01631 86.73734
## 2013-01-08 120.4250 42.53928 35.57348 35.69367 86.81567
## 2013-01-09 120.7310 42.75608 35.67650 35.84692 86.75298
## 2013-01-10 121.6909 43.30184 35.71943 36.16152 86.74514
## 2013-01-11 121.6826 43.39156 35.69368 35.87113 86.83136
## 2013-01-14 121.5998 43.44389 35.68509 36.02438 86.90965
```


]


---




# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `xts`


.pull-left[

La primera observación en nuestro objeto de precios es el 31 de diciembre de 2012 (último día de negociación de ese año) y tenemos precios diarios. Queremos convertir esos precios diarios en retornos de registros mensuales basados en la última lectura de cada mes.

&lt;br&gt;

----

* Usaremos `to.monthly(prices, indexAt = "lastog", OHLC = FALSE)` del paquete `quantmod`.

&lt;br&gt;

* El argumento `indexAt = "lastof"` le dice a la función si queremos indexar al primer día del mes o al último día. Si quisieramos usar el primer día, lo cambiariamos a `indexAt = "firstof"`.

----


]


.pull-right[


&lt;br&gt;&lt;br&gt;

----



```r
prices_monthly &lt;- to.monthly(prices,
                  indexAt = "lastof",
                  OHLC = FALSE)

head(prices_monthly, 7)
```

```
##                 SPY      EFA      IJS      EEM      AGG
## 2012-12-31 117.8270 42.50938 34.73629 35.77433 87.01148
## 2013-01-31 123.8586 44.09432 36.59525 35.66946 86.47098
## 2013-02-28 125.4389 43.52613 37.19201 34.85477 86.98191
## 2013-03-31 130.2020 44.09432 38.71983 34.49984 87.06765
## 2013-04-30 132.7035 46.30725 38.76718 34.91929 87.91093
## 2013-05-31 135.8365 44.90921 40.42913 33.23342 86.15178
## 2013-06-30 134.0238 43.70658 40.37246 31.46349 84.80314
```


----


* Hemos convertido un objeto `xts` diario a un objeto `xts` mensual

]


---







# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `xts`



.pull-left[


* Usaremos `Return.calculate(prices_monthly, method = "log")` para convertir a retornos y guardar un objeto llamado `asset_returns_xts`


* Note que estos están dados en logaritmo por `method = "log"`.

`$$r_t = ln \left( \frac{P_t}{P_{t-1}} \right)$$`

* Podríamos usar `method = "discrete"` para obtener los retornos simples.

`$$r_t = \frac{P_t - P_{t-1}}{P_{t-1}}$$`

* Podríamos usar `method = "difference"` para obtener diferencias.


`$$r_t = P_t - P_{t-1}$$`

]


.pull-right[


&lt;br&gt;&lt;br&gt;

----



```r
asset_returns_xts &lt;-
                     Return.calculate(prices_monthly,
                     method = "log") %&gt;%
na.omit()

head(round(asset_returns_xts,3), 7)
```

```
##               SPY    EFA    IJS    EEM    AGG
## 2013-01-31  0.050  0.037  0.052 -0.003 -0.006
## 2013-02-28  0.013 -0.013  0.016 -0.023  0.006
## 2013-03-31  0.037  0.013  0.040 -0.010  0.001
## 2013-04-30  0.019  0.049  0.001  0.012  0.010
## 2013-05-31  0.023 -0.031  0.042 -0.049 -0.020
## 2013-06-30 -0.013 -0.027 -0.001 -0.055 -0.016
## 2013-07-31  0.050  0.052  0.064  0.013  0.003
```


----




]


---

class: inverse, center, middle
background-color: #00081d


# xts



.pull-left[

En términos más generales, este es un buen momento para notar cómo nuestras decisiones en la transformación de datos pueden afectar los datos que finalmente sobreviven a nuestra etapa analítica. 

Acabamos de perder el primer mes de precios diarios. 

Quizás eso no nos importe, o quizás queremos cambiar la fecha de inicio original para asegurarnos de capturar diciembre de 2012. Depende de la tarea y los datos, y si subcontratamos la preparación de los datos, estas decisiones se tomarán antes.

]


.pull-right[


&lt;br&gt;&lt;br&gt;

----

**Desde una perspectiva sustantiva, ahora hemos importado precios diarios, recortados a precios ajustados, movidos a precios mensuales y transformados a retornos de registros mensuales, todo en el mundo xts.**

----

]


---







# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyverse`


.pull-left[

Hay varias diferencias entre un objeto `xts` y un `tibble`, pero uno muy importante es la fecha, un componente esencial de la mayoría de los análisis financieros. Los objetos `xts` tienen un índice de fecha. Por el contrario, los `dataframe` tienen una columna de fecha y esa columna no es necesaria para la existencia del marco de datos.


----



```r
asset_returns_dplyr_byhand &lt;- prices %&gt;%
    to.monthly(indexAt = "lastof", OHLC = FALSE) %&gt;%
    # convert the index to a date
    data.frame(date = index(.)) %&gt;%
    # now remove the index because it got converted to row names
    remove_rownames() %&gt;%
    gather(asset, prices, -date) %&gt;%
    group_by(asset) %&gt;%
    mutate(returns = (log(prices) - log(lag(prices)))) %&gt;%
    select(-prices) %&gt;%
    spread(asset, returns) %&gt;%
    select(date, symbols)
```

----


]


.pull-right[


----


Nuestra conversión de xts a tibble comienza con `data.frame(date = index (.))`

* Convierte nuestro objeto en un data.frame 

* Agrega una columna de fecha basada en el índice con `date = index (.)`. 

&lt;br&gt;

* El índice de fecha del objeto `xts` se conserva como nombres de fila y debe eliminarse explícitamente con `remove_rownames()`.

&lt;br&gt;

* gather() convierte de formato wide a formato long

----



]


---


# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyverse`


.pull-left[


----



```r
asset_returns_dplyr_byhand &lt;- prices %&gt;%
    to.monthly(indexAt = "lastof", OHLC = FALSE) %&gt;%
    # convert the index to a date
    data.frame(date = index(.)) %&gt;%
    # now remove the index because it got converted to row names
    remove_rownames() %&gt;%
    gather(asset, prices, -date) %&gt;%
    group_by(asset) %&gt;%
    mutate(returns = (log(prices) - log(lag(prices)))) %&gt;%
    select(-prices) %&gt;%
    spread(asset, returns) %&gt;%
    select(date, symbols)
```

----


]


.pull-right[


----


* `mutate()` nos permite crear nuestro propio cálculo de retornos: `mutate(returns = (log(prices) - log(lag(prices))))`

&lt;br&gt;

* Removemos la serie de precios ya que no la necesitamos `select(-prices)`

&lt;br&gt;

* `spread()` convierte de formato long a formato wide

&lt;br&gt;

* reordenamos las columnas según las importamos usando el objeto `symbols`, es decir,
`select(date, symbols)`


----



]


---




# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyverse`


.pull-left[


----



```r
asset_returns_dplyr_byhand &lt;- prices %&gt;%
    to.monthly(indexAt = "lastof", OHLC = FALSE) %&gt;%
    # convert the index to a date
    data.frame(date = index(.)) %&gt;%
    # now remove the index because it got converted to row names
    remove_rownames() %&gt;%
    gather(asset, prices, -date) %&gt;%
    group_by(asset) %&gt;%
    mutate(returns = (log(prices) - log(lag(prices)))) %&gt;%
    select(-prices) %&gt;%
    spread(asset, returns) %&gt;%
    select(date, symbols)



head(asset_returns_dplyr_byhand, 10)


asset_returns_dplyr_byhand &lt;-
asset_returns_dplyr_byhand %&gt;%
na.omit()
```

----


]


.pull-right[



```
## # A tibble: 10 × 6
##    date           SPY     EFA      IJS      EEM       AGG
##    &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 2012-12-31 NA      NA      NA       NA       NA       
##  2 2013-01-31  0.0499  0.0366  0.0521  -0.00294 -0.00623 
##  3 2013-02-28  0.0127 -0.0130  0.0162  -0.0231   0.00589 
##  4 2013-03-31  0.0373  0.0130  0.0403  -0.0102   0.000985
##  5 2013-04-30  0.0190  0.0490  0.00122  0.0121   0.00964 
##  6 2013-05-31  0.0233 -0.0307  0.0420  -0.0495  -0.0202  
##  7 2013-06-30 -0.0134 -0.0271 -0.00140 -0.0547  -0.0158  
##  8 2013-07-31  0.0504  0.0519  0.0635   0.0132   0.00269 
##  9 2013-08-31 -0.0305 -0.0197 -0.0347  -0.0257  -0.00830 
## 10 2013-09-30  0.0312  0.0753  0.0639   0.0696   0.0111
```


]


---


# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyquant`


.pull-left[


Exploremos el paradigma tidyquant para convertir a retornos logarítmicos.

----

.scroll-box-14[

```r
asset_returns_tq_1 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "SPY") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "SPY")

asset_returns_tq_2 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "EFA") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "EFA")  

asset_returns_tq_3 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "IJS") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "IJS")  


asset_returns_tq_4 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "EEM") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "EEM")  


asset_returns_tq_5 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "AGG") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "AGG")  

asset_returns_tq_builtin &lt;-
  left_join(asset_returns_tq_1,asset_returns_tq_2, by = "date") %&gt;% 
   left_join(. , asset_returns_tq_3, by = "date") %&gt;% 
   left_join(. , asset_returns_tq_4, by = "date") %&gt;%   
   left_join(. , asset_returns_tq_5, by = "date") %&gt;% 
   slice(-1)

head(asset_returns_tq_builtin, 10)
```
]

----


]


.pull-right[


----


`tk_tbl(preserve_index = TRUE, rename_index = "date")` convierte los precios de `xts` a `tibble`

* Convierte el índice de fecha en una columna de fecha y lo renombra como "date".

* Dado que el índice se está convirtiendo, no es necesario eliminarlo como hicimos anteriormente.



&lt;br&gt;

* `tq_transmute(mutate_fun = periodReturn, period ="monthly", type = "log")` nos permite pasar de precios diarios a los retornos logarítmicos mensuales.




----



]


---



# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> `tidyquant`


.pull-left[


Exploremos el paradigma tidyquant para convertir a retornos logarítmicos.

----

.scroll-box-14[

```r
asset_returns_tq_1 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "SPY") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "SPY")

asset_returns_tq_2 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "EFA") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "EFA")  

asset_returns_tq_3 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "IJS") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "IJS")  


asset_returns_tq_4 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "EEM") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "EEM")  


asset_returns_tq_5 &lt;-
  prices %&gt;%
  tk_tbl(preserve_index = TRUE,
         rename_index = "date") %&gt;%
  gather(asset, prices, -date) %&gt;%
  filter(asset == "AGG") %&gt;% 
  tq_transmute(select = prices, mutate_fun = periodReturn,
               period = "monthly",
               type = "log",
               col_rename = "AGG")  

asset_returns_tq_builtin &lt;-
  left_join(asset_returns_tq_1,asset_returns_tq_2, by = "date") %&gt;% 
   left_join(. , asset_returns_tq_3, by = "date") %&gt;% 
   left_join(. , asset_returns_tq_4, by = "date") %&gt;%   
   left_join(. , asset_returns_tq_5, by = "date") %&gt;% 
   slice(-1)

head(asset_returns_tq_builtin, 10)
```
]

----


]


.pull-right[


----



```
## # A tibble: 10 × 6
##    date           SPY     EFA      IJS      EEM       AGG
##    &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 2013-01-31  0.0499  0.0366  0.0521  -0.00294 -0.00623 
##  2 2013-02-28  0.0127 -0.0130  0.0162  -0.0231   0.00589 
##  3 2013-03-28  0.0373  0.0130  0.0403  -0.0102   0.000985
##  4 2013-04-30  0.0190  0.0490  0.00122  0.0121   0.00964 
##  5 2013-05-31  0.0233 -0.0307  0.0420  -0.0495  -0.0202  
##  6 2013-06-28 -0.0134 -0.0271 -0.00140 -0.0547  -0.0158  
##  7 2013-07-31  0.0504  0.0519  0.0635   0.0132   0.00269 
##  8 2013-08-30 -0.0305 -0.0197 -0.0347  -0.0257  -0.00830 
##  9 2013-09-30  0.0312  0.0753  0.0639   0.0696   0.0111  
## 10 2013-10-31  0.0453  0.0321  0.0342   0.0409   0.00829
```



----



]


---



# <i class="fa fa-upload" role="presentation" aria-label="upload icon"></i> En resumen...





```r
head(asset_returns_xts, 3)
```

```
##                   SPY         EFA        IJS          EEM           AGG
## 2013-01-31 0.04992271  0.03660633 0.05213346 -0.002935737 -0.0062312438
## 2013-02-28 0.01267825 -0.01296948 0.01617550 -0.023104746  0.0058913343
## 2013-03-31 0.03726807  0.01296948 0.04025795 -0.010235429  0.0009852252
```

```r
head(asset_returns_dplyr_byhand, 3)
```

```
## # A tibble: 3 × 6
##   date           SPY     EFA     IJS      EEM      AGG
##   &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
## 1 2012-12-31 NA      NA      NA      NA       NA      
## 2 2013-01-31  0.0499  0.0366  0.0521 -0.00294 -0.00623
## 3 2013-02-28  0.0127 -0.0130  0.0162 -0.0231   0.00589
```

```r
head(asset_returns_tq_builtin, 3)
```

```
## # A tibble: 3 × 6
##   date          SPY     EFA    IJS      EEM       AGG
##   &lt;date&gt;      &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1 2013-01-31 0.0499  0.0366 0.0521 -0.00294 -0.00623 
## 2 2013-02-28 0.0127 -0.0130 0.0162 -0.0231   0.00589 
## 3 2013-03-28 0.0373  0.0130 0.0403 -0.0102   0.000985
```




---



name: Vis
class: inverse, center, middle
background-color: #00081d

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i>
# Visualización
----

.right[
.bottom[
####  [<i class="fa fa-bell" role="presentation" aria-label="bell icon"></i>](#menu)
]
]

---

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`



.pull-left[

&lt;br&gt;

.center[
![](https://media.giphy.com/media/rM0wxzvwsv5g4/giphy.gif)


]
]

.pull-right[


&gt; Es una buena práctica graficar los rendimientos individuales porque una vez que se construye una cartera, es poco probable que retrocedamos para visualizar de forma individual. 

&gt; Sin embargo, esos rendimientos individuales son los componentes básicos y la materia prima de nuestra cartera y visualizarlos es una excelente manera de comprenderlos en profundidad.


&lt;br&gt;

.center[
### También presenta una oportunidad para buscar valores atípicos, errores o cualquier cosa inusual para corregir antes de avanzar demasiado en nuestro análisis.
]

]

---





# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`



.pull-left[

.center[
`Highcharter` es un paquete de R, pero Highcharts es una biblioteca de JavaScript. El paquete R es un enlace a la biblioteca de JavaScript. 


Highcharts es fantástico para visualizar series de tiempo y viene con excelentes widgets incorporados para ver diferentes marcos de tiempo, además de que podemos usar el poder de JavaScript sin salir del mundo del código R.

]

.center[
### Las visualizaciones no solo son agradables, sino que highcharter “simplemente funciona” con objetos xts en el sentido de que lee el índice como fechas sin necesidad de que se le indique.
]


]

.pull-right[


<div id="htmlwidget-7f89c8e2f616f866f4b4" style="width:450px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-7f89c8e2f616f866f4b4">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":"Monthly Log Returns"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"series":[{"data":[[1359590400000,0.049922714790557],[1362009600000,0.0126782535177261],[1364688000000,0.0372680706580217],[1367280000000,0.0190304287977643],[1369958400000,0.0233349463563455],[1372550400000,-0.013434431968621],[1375228800000,0.0503862481360358],[1377907200000,-0.0304516635543788],[1380499200000,0.0311561697203002],[1383177600000,0.0452664561107197],[1385769600000,0.0292072674282364],[1388448000000,0.0255959062405404],[1391126400000,-0.0358845359479458],[1393545600000,0.0445103096529289],[1396224000000,0.00826121072386243],[1398816000000,0.00692775141570667],[1401494400000,0.0229411738060614],[1404086400000,0.0204343568324408],[1406764800000,-0.013528413514484],[1409443200000,0.0387042707056704],[1412035200000,-0.0138919108056745],[1414713600000,0.0232776246514828],[1417305600000,0.0271013894160763],[1419984000000,-0.00253968263927984],[1422662400000,-0.0300771177573473],[1425081600000,0.0546819486103356],[1427760000000,-0.0158302183300245],[1430352000000,0.00978598232047201],[1433030400000,0.0127739971066276],[1435622400000,-0.020521082137364],[1438300800000,0.0223375561852048],[1440979200000,-0.0628862525457876],[1443571200000,-0.0258471991632234],[1446249600000,0.0816348659197441],[1448841600000,0.00364867230838595],[1451520000000,-0.0174338771334188],[1454198400000,-0.0510685320122857],[1456704000000,-0.00082627489333742],[1459382400000,0.0651001761506853],[1461974400000,0.00393344634193582],[1464652800000,0.0168684744697201],[1467244800000,0.00346980291513344],[1469923200000,0.0358218796974175],[1472601600000,0.00119695701126687],[1475193600000,5.79769258992613e-05],[1477872000000,-0.0174892548547518],[1480464000000,0.036176268574085],[1483142400000,0.0200689292539007],[1485820800000,0.0177367272995914],[1488240000000,0.0385391792573202],[1490918400000,0.00124920040558418],[1493510400000,0.00987710874059466],[1496188800000,0.0140141941490102],[1498780800000,0.00635485023467108],[1501459200000,0.0203457877750672],[1504137600000,0.00291332767743135],[1506729600000,0.0199491887072973],[1509408000000,0.0232907153249764],[1512000000000,0.0301081708675666],[1514678400000,0.0120548971278227]],"name":"SPY"},{"data":[[1359590400000,0.0366063344408736],[1362009600000,-0.0129694820221635],[1364688000000,0.0129694820221635],[1367280000000,0.0489676229521239],[1369958400000,-0.0306556590046156],[1372550400000,-0.0271442080281536],[1375228800000,0.0518601878138019],[1377907200000,-0.0197464752682133],[1380499200000,0.0753385957358055],[1383177600000,0.03208170991818],[1385769600000,0.00544969831944808],[1388448000000,0.0215279933393573],[1391126400000,-0.0534132018776639],[1393545600000,0.0595050322018533],[1396224000000,-0.0046026799259522],[1398816000000,0.0165294211712506],[1401494400000,0.0158286524792048],[1404086400000,0.00916520995511538],[1406764800000,-0.0263799374223117],[1409443200000,0.00180074154499321],[1412035200000,-0.0395986699993767],[1414713600000,-0.00265481267015932],[1417305600000,0.000625176064929178],[1419984000000,-0.0407465313219078],[1422662400000,0.00622650310081463],[1425081600000,0.0614504484886336],[1427760000000,-0.0143886932621249],[1430352000000,0.0358165769378007],[1433030400000,0.00195269174427759],[1435622400000,-0.0316788825938512],[1438300800000,0.0201146461876265],[1440979200000,-0.0771525110103362],[1443571200000,-0.0451949310838295],[1446249600000,0.0640258678843049],[1448841600000,-0.00755557589122491],[1451520000000,-0.0235951131063894],[1454198400000,-0.0567580480846814],[1456704000000,-0.0339138259380802],[1459382400000,0.0637457628988143],[1461974400000,0.0219750361106885],[1464652800000,-0.000855974898123613],[1467244800000,-0.0244916418923435],[1469923200000,0.0390001994781453],[1472601600000,0.00532708888730893],[1475193600000,0.0132788590886883],[1477872000000,-0.0224034781883535],[1480464000000,-0.0179745296458318],[1483142400000,0.0267028054983394],[1485820800000,0.0323819981339826],[1488240000000,0.0118363213178942],[1490918400000,0.0318055987119754],[1493510400000,0.0239522377541883],[1496188800000,0.0348102740145801],[1498780800000,0.00295599422574],[1501459200000,0.0261877760979914],[1504137600000,-0.000448174382512434],[1506729600000,0.0233428571014898],[1509408000000,0.01665363775518],[1512000000000,0.00686986927224442],[1514678400000,0.0133984999805099]],"name":"EFA"},{"data":[[1359590400000,0.0521334614499405],[1362009600000,0.0161755031375113],[1364688000000,0.0402579455270917],[1367280000000,0.00122226945754633],[1369958400000,0.0419764481211216],[1372550400000,-0.00140274490372683],[1375228800000,0.0635411515942135],[1377907200000,-0.0347434856490243],[1380499200000,0.0638738029691566],[1383177600000,0.0342339795329236],[1385769600000,0.0416612102083529],[1388448000000,0.0128920609894623],[1391126400000,-0.0357751442542558],[1393545600000,0.0452572526888062],[1396224000000,0.0133155401526568],[1398816000000,-0.0231844382948361],[1401494400000,0.00620521920199391],[1404086400000,0.0377187267041896],[1406764800000,-0.0520093992372699],[1409443200000,0.0436578266277103],[1412035200000,-0.0612603216081116],[1414713600000,0.0688747825380984],[1417305600000,0.00477370214287065],[1419984000000,0.0252956097622659],[1422662400000,-0.0546278465436196],[1425081600000,0.0569144462271516],[1427760000000,0.0101566272380973],[1430352000000,-0.0184178294900752],[1433030400000,0.0075100861557944],[1435622400000,0.00417126099922172],[1438300800000,-0.0273754725118929],[1440979200000,-0.0472681509810604],[1443571200000,-0.0384648411848922],[1446249600000,0.0635898900286955],[1448841600000,0.0244150502878275],[1451520000000,-0.0521569714087722],[1454198400000,-0.0603069182171674],[1456704000000,0.0206051103300506],[1459382400000,0.0899104611959616],[1461974400000,0.0210444233410301],[1464652800000,0.00439665629835018],[1467244800000,0.00829261130210224],[1469923200000,0.0493481715815096],[1472601600000,0.0112612122579794],[1475193600000,0.00861448122060793],[1477872000000,-0.0381346400031228],[1480464000000,0.125246606894796],[1483142400000,0.0314916121663034],[1485820800000,-0.0121436686252432],[1488240000000,0.0134282768594343],[1490918400000,-0.00653277197694813],[1493510400000,0.00510811775848374],[1496188800000,-0.0228629216189438],[1498780800000,0.029151467222527],[1501459200000,0.00748179281314343],[1504137600000,-0.0275646769468763],[1506729600000,0.0823216757481635],[1509408000000,0.00591608898514728],[1512000000000,0.0369133048751902],[1514678400000,-0.00373133131066972]],"name":"IJS"},{"data":[[1359590400000,-0.00293573662088553],[1362009600000,-0.0231047455719535],[1364688000000,-0.0102354285667761],[1367280000000,0.0120846835939741],[1369958400000,-0.0494832233686715],[1372550400000,-0.0547282252247205],[1375228800000,0.0131596527387638],[1377907200000,-0.0257057461981627],[1380499200000,0.0695889133957559],[1383177600000,0.0408611646603747],[1385769600000,-0.00259395792804851],[1388448000000,-0.00407441638394035],[1391126400000,-0.0903225876314422],[1393545600000,0.0332204937350475],[1396224000000,0.0380217430842213],[1398816000000,0.00777247318384777],[1401494400000,0.0290915106970235],[1404086400000,0.0237338416230761],[1406764800000,0.0135557663194454],[1409443200000,0.0279043826559398],[1412035200000,-0.0808565821848783],[1414713600000,0.014096453029508],[1417305600000,-0.0155413204224364],[1419984000000,-0.0404420931553133],[1422662400000,-0.00689574757274469],[1425081600000,0.0431360177040956],[1427760000000,-0.0150862103341329],[1430352000000,0.0662814572372232],[1433030400000,-0.0419110104570746],[1435622400000,-0.0297468955930436],[1438300800000,-0.0651780280821455],[1440979200000,-0.0925120166430915],[1443571200000,-0.0318251401766814],[1446249600000,0.0618080653017246],[1448841600000,-0.0255599145826642],[1451520000000,-0.0389474993880361],[1454198400000,-0.0516364958361244],[1456704000000,-0.00821188118106964],[1459382400000,0.121879297375424],[1461974400000,0.00407922211891343],[1464652800000,-0.0376288420898563],[1467244800000,0.0445825088559975],[1469923200000,0.0524420284213996],[1472601600000,0.00879872748534005],[1475193600000,0.02487315472096],[1477872000000,-0.00831244527540775],[1480464000000,-0.045162012131239],[1483142400000,-0.00252989743000454],[1485820800000,0.0644316661960374],[1488240000000,0.0172577695203961],[1490918400000,0.0361891102509206],[1493510400000,0.0168661676896238],[1496188800000,0.028060184134199],[1498780800000,0.0092233919320881],[1501459200000,0.0565946029611069],[1504137600000,0.0232438094115546],[1506729600000,-0.000446279724218623],[1509408000000,0.0322785875557967],[1512000000000,-0.00389702465109254],[1514678400000,0.0369255792538485]],"name":"EEM"},{"data":[[1359590400000,-0.00623124376847795],[1362009600000,0.00589133430668909],[1364688000000,0.000985225201864282],[1367280000000,0.00963878561102582],[1369958400000,-0.0202135755192314],[1372550400000,-0.0157780541675514],[1375228800000,0.00268690066138522],[1377907200000,-0.00829804338877516],[1380499200000,0.011144456412417],[1383177600000,0.00829128959282333],[1385769600000,-0.00250880683947052],[1388448000000,-0.00558334383182757],[1391126400000,0.0152918696859778],[1393545600000,0.0037562321514697],[1396224000000,-0.00148175668275652],[1398816000000,0.00818363859856852],[1401494400000,0.0117217307198842],[1404086400000,-0.000575812972991585],[1406764800000,-0.00251225188898196],[1409443200000,0.0114305911285797],[1412035200000,-0.00616698472071864],[1414713600000,0.0105840049879324],[1417305600000,0.00654893064472706],[1419984000000,0.00147545540514216],[1422662400000,0.0203150141122661],[1425081600000,-0.00898850219779046],[1427760000000,0.00374024375414983],[1430352000000,-0.00323281932498443],[1433030400000,-0.00438325121477057],[1435622400000,-0.0108259626918965],[1438300800000,0.00858489110481209],[1440979200000,-0.00336411350724841],[1443571200000,0.00808184251820343],[1446249600000,0.000685426750788309],[1448841600000,-0.00389804642922353],[1451520000000,-0.00191907445203476],[1454198400000,0.0123297986609767],[1456704000000,0.00883160851821607],[1459382400000,0.00870839511212562],[1461974400000,0.00254667505479134],[1464652800000,0.000135783027583436],[1467244800000,0.0191660841264545],[1469923200000,0.00543009832188801],[1472601600000,-0.00215644099833057],[1475193600000,0.000516334303410027],[1477872000000,-0.00820541728478563],[1480464000000,-0.0259898165099246],[1483142400000,0.00253795192520734],[1485820800000,0.00212670632091871],[1488240000000,0.00643725674942175],[1490918400000,-0.000552636737874757],[1493510400000,0.00902961516238143],[1496188800000,0.0068467605084308],[1498780800000,-0.000182493446336807],[1501459200000,0.00333461966410198],[1504137600000,0.0093689036744129],[1506729600000,-0.00573220143747832],[1509408000000,0.000978127133666185],[1512000000000,-0.00148381925129115],[1514678400000,0.00473998357142591]],"name":"AGG"}],"navigator":{"enabled":false},"scrollbar":{"enabled":false},"legend":{"enabled":true}},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"stock","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>


]

---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`



.pull-left[


* Configuramos `highchart(type = "stock")` para obtener un formato de línea agradable que fue creado específicamente para acciones.

* Luego agregamos cada una de nuestras series al flujo de código.


----
.scroll-box-14[

```r
highchart(type = "stock") %&gt;%
hc_title(text = "Monthly Log Returns") %&gt;%
hc_add_series(asset_returns_xts[, symbols[1]],
name = symbols[1]) %&gt;%
hc_add_series(asset_returns_xts[, symbols[2]],
name = symbols[2]) %&gt;%
hc_add_series(asset_returns_xts[, symbols[3]],
name = symbols[3]) %&gt;%
hc_add_series(asset_returns_xts[, symbols[4]],
name = symbols[4]) %&gt;%
hc_add_series(asset_returns_xts[, symbols[5]],
name = symbols[5]) %&gt;%
hc_add_theme(hc_theme_flat()) %&gt;%
hc_navigator(enabled = FALSE) %&gt;%
hc_scrollbar(enabled = FALSE) %&gt;%
hc_exporting(enabled = TRUE) %&gt;%
hc_legend(enabled = TRUE)
```
]
----

]

.pull-right[


<div id="htmlwidget-7d30a378e7bd1fbfd15f" style="width:450px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-7d30a378e7bd1fbfd15f">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":"Monthly Log Returns"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"series":[{"data":[[1359590400000,0.049922714790557],[1362009600000,0.0126782535177261],[1364688000000,0.0372680706580217],[1367280000000,0.0190304287977643],[1369958400000,0.0233349463563455],[1372550400000,-0.013434431968621],[1375228800000,0.0503862481360358],[1377907200000,-0.0304516635543788],[1380499200000,0.0311561697203002],[1383177600000,0.0452664561107197],[1385769600000,0.0292072674282364],[1388448000000,0.0255959062405404],[1391126400000,-0.0358845359479458],[1393545600000,0.0445103096529289],[1396224000000,0.00826121072386243],[1398816000000,0.00692775141570667],[1401494400000,0.0229411738060614],[1404086400000,0.0204343568324408],[1406764800000,-0.013528413514484],[1409443200000,0.0387042707056704],[1412035200000,-0.0138919108056745],[1414713600000,0.0232776246514828],[1417305600000,0.0271013894160763],[1419984000000,-0.00253968263927984],[1422662400000,-0.0300771177573473],[1425081600000,0.0546819486103356],[1427760000000,-0.0158302183300245],[1430352000000,0.00978598232047201],[1433030400000,0.0127739971066276],[1435622400000,-0.020521082137364],[1438300800000,0.0223375561852048],[1440979200000,-0.0628862525457876],[1443571200000,-0.0258471991632234],[1446249600000,0.0816348659197441],[1448841600000,0.00364867230838595],[1451520000000,-0.0174338771334188],[1454198400000,-0.0510685320122857],[1456704000000,-0.00082627489333742],[1459382400000,0.0651001761506853],[1461974400000,0.00393344634193582],[1464652800000,0.0168684744697201],[1467244800000,0.00346980291513344],[1469923200000,0.0358218796974175],[1472601600000,0.00119695701126687],[1475193600000,5.79769258992613e-05],[1477872000000,-0.0174892548547518],[1480464000000,0.036176268574085],[1483142400000,0.0200689292539007],[1485820800000,0.0177367272995914],[1488240000000,0.0385391792573202],[1490918400000,0.00124920040558418],[1493510400000,0.00987710874059466],[1496188800000,0.0140141941490102],[1498780800000,0.00635485023467108],[1501459200000,0.0203457877750672],[1504137600000,0.00291332767743135],[1506729600000,0.0199491887072973],[1509408000000,0.0232907153249764],[1512000000000,0.0301081708675666],[1514678400000,0.0120548971278227]],"name":"SPY"},{"data":[[1359590400000,0.0366063344408736],[1362009600000,-0.0129694820221635],[1364688000000,0.0129694820221635],[1367280000000,0.0489676229521239],[1369958400000,-0.0306556590046156],[1372550400000,-0.0271442080281536],[1375228800000,0.0518601878138019],[1377907200000,-0.0197464752682133],[1380499200000,0.0753385957358055],[1383177600000,0.03208170991818],[1385769600000,0.00544969831944808],[1388448000000,0.0215279933393573],[1391126400000,-0.0534132018776639],[1393545600000,0.0595050322018533],[1396224000000,-0.0046026799259522],[1398816000000,0.0165294211712506],[1401494400000,0.0158286524792048],[1404086400000,0.00916520995511538],[1406764800000,-0.0263799374223117],[1409443200000,0.00180074154499321],[1412035200000,-0.0395986699993767],[1414713600000,-0.00265481267015932],[1417305600000,0.000625176064929178],[1419984000000,-0.0407465313219078],[1422662400000,0.00622650310081463],[1425081600000,0.0614504484886336],[1427760000000,-0.0143886932621249],[1430352000000,0.0358165769378007],[1433030400000,0.00195269174427759],[1435622400000,-0.0316788825938512],[1438300800000,0.0201146461876265],[1440979200000,-0.0771525110103362],[1443571200000,-0.0451949310838295],[1446249600000,0.0640258678843049],[1448841600000,-0.00755557589122491],[1451520000000,-0.0235951131063894],[1454198400000,-0.0567580480846814],[1456704000000,-0.0339138259380802],[1459382400000,0.0637457628988143],[1461974400000,0.0219750361106885],[1464652800000,-0.000855974898123613],[1467244800000,-0.0244916418923435],[1469923200000,0.0390001994781453],[1472601600000,0.00532708888730893],[1475193600000,0.0132788590886883],[1477872000000,-0.0224034781883535],[1480464000000,-0.0179745296458318],[1483142400000,0.0267028054983394],[1485820800000,0.0323819981339826],[1488240000000,0.0118363213178942],[1490918400000,0.0318055987119754],[1493510400000,0.0239522377541883],[1496188800000,0.0348102740145801],[1498780800000,0.00295599422574],[1501459200000,0.0261877760979914],[1504137600000,-0.000448174382512434],[1506729600000,0.0233428571014898],[1509408000000,0.01665363775518],[1512000000000,0.00686986927224442],[1514678400000,0.0133984999805099]],"name":"EFA"},{"data":[[1359590400000,0.0521334614499405],[1362009600000,0.0161755031375113],[1364688000000,0.0402579455270917],[1367280000000,0.00122226945754633],[1369958400000,0.0419764481211216],[1372550400000,-0.00140274490372683],[1375228800000,0.0635411515942135],[1377907200000,-0.0347434856490243],[1380499200000,0.0638738029691566],[1383177600000,0.0342339795329236],[1385769600000,0.0416612102083529],[1388448000000,0.0128920609894623],[1391126400000,-0.0357751442542558],[1393545600000,0.0452572526888062],[1396224000000,0.0133155401526568],[1398816000000,-0.0231844382948361],[1401494400000,0.00620521920199391],[1404086400000,0.0377187267041896],[1406764800000,-0.0520093992372699],[1409443200000,0.0436578266277103],[1412035200000,-0.0612603216081116],[1414713600000,0.0688747825380984],[1417305600000,0.00477370214287065],[1419984000000,0.0252956097622659],[1422662400000,-0.0546278465436196],[1425081600000,0.0569144462271516],[1427760000000,0.0101566272380973],[1430352000000,-0.0184178294900752],[1433030400000,0.0075100861557944],[1435622400000,0.00417126099922172],[1438300800000,-0.0273754725118929],[1440979200000,-0.0472681509810604],[1443571200000,-0.0384648411848922],[1446249600000,0.0635898900286955],[1448841600000,0.0244150502878275],[1451520000000,-0.0521569714087722],[1454198400000,-0.0603069182171674],[1456704000000,0.0206051103300506],[1459382400000,0.0899104611959616],[1461974400000,0.0210444233410301],[1464652800000,0.00439665629835018],[1467244800000,0.00829261130210224],[1469923200000,0.0493481715815096],[1472601600000,0.0112612122579794],[1475193600000,0.00861448122060793],[1477872000000,-0.0381346400031228],[1480464000000,0.125246606894796],[1483142400000,0.0314916121663034],[1485820800000,-0.0121436686252432],[1488240000000,0.0134282768594343],[1490918400000,-0.00653277197694813],[1493510400000,0.00510811775848374],[1496188800000,-0.0228629216189438],[1498780800000,0.029151467222527],[1501459200000,0.00748179281314343],[1504137600000,-0.0275646769468763],[1506729600000,0.0823216757481635],[1509408000000,0.00591608898514728],[1512000000000,0.0369133048751902],[1514678400000,-0.00373133131066972]],"name":"IJS"},{"data":[[1359590400000,-0.00293573662088553],[1362009600000,-0.0231047455719535],[1364688000000,-0.0102354285667761],[1367280000000,0.0120846835939741],[1369958400000,-0.0494832233686715],[1372550400000,-0.0547282252247205],[1375228800000,0.0131596527387638],[1377907200000,-0.0257057461981627],[1380499200000,0.0695889133957559],[1383177600000,0.0408611646603747],[1385769600000,-0.00259395792804851],[1388448000000,-0.00407441638394035],[1391126400000,-0.0903225876314422],[1393545600000,0.0332204937350475],[1396224000000,0.0380217430842213],[1398816000000,0.00777247318384777],[1401494400000,0.0290915106970235],[1404086400000,0.0237338416230761],[1406764800000,0.0135557663194454],[1409443200000,0.0279043826559398],[1412035200000,-0.0808565821848783],[1414713600000,0.014096453029508],[1417305600000,-0.0155413204224364],[1419984000000,-0.0404420931553133],[1422662400000,-0.00689574757274469],[1425081600000,0.0431360177040956],[1427760000000,-0.0150862103341329],[1430352000000,0.0662814572372232],[1433030400000,-0.0419110104570746],[1435622400000,-0.0297468955930436],[1438300800000,-0.0651780280821455],[1440979200000,-0.0925120166430915],[1443571200000,-0.0318251401766814],[1446249600000,0.0618080653017246],[1448841600000,-0.0255599145826642],[1451520000000,-0.0389474993880361],[1454198400000,-0.0516364958361244],[1456704000000,-0.00821188118106964],[1459382400000,0.121879297375424],[1461974400000,0.00407922211891343],[1464652800000,-0.0376288420898563],[1467244800000,0.0445825088559975],[1469923200000,0.0524420284213996],[1472601600000,0.00879872748534005],[1475193600000,0.02487315472096],[1477872000000,-0.00831244527540775],[1480464000000,-0.045162012131239],[1483142400000,-0.00252989743000454],[1485820800000,0.0644316661960374],[1488240000000,0.0172577695203961],[1490918400000,0.0361891102509206],[1493510400000,0.0168661676896238],[1496188800000,0.028060184134199],[1498780800000,0.0092233919320881],[1501459200000,0.0565946029611069],[1504137600000,0.0232438094115546],[1506729600000,-0.000446279724218623],[1509408000000,0.0322785875557967],[1512000000000,-0.00389702465109254],[1514678400000,0.0369255792538485]],"name":"EEM"},{"data":[[1359590400000,-0.00623124376847795],[1362009600000,0.00589133430668909],[1364688000000,0.000985225201864282],[1367280000000,0.00963878561102582],[1369958400000,-0.0202135755192314],[1372550400000,-0.0157780541675514],[1375228800000,0.00268690066138522],[1377907200000,-0.00829804338877516],[1380499200000,0.011144456412417],[1383177600000,0.00829128959282333],[1385769600000,-0.00250880683947052],[1388448000000,-0.00558334383182757],[1391126400000,0.0152918696859778],[1393545600000,0.0037562321514697],[1396224000000,-0.00148175668275652],[1398816000000,0.00818363859856852],[1401494400000,0.0117217307198842],[1404086400000,-0.000575812972991585],[1406764800000,-0.00251225188898196],[1409443200000,0.0114305911285797],[1412035200000,-0.00616698472071864],[1414713600000,0.0105840049879324],[1417305600000,0.00654893064472706],[1419984000000,0.00147545540514216],[1422662400000,0.0203150141122661],[1425081600000,-0.00898850219779046],[1427760000000,0.00374024375414983],[1430352000000,-0.00323281932498443],[1433030400000,-0.00438325121477057],[1435622400000,-0.0108259626918965],[1438300800000,0.00858489110481209],[1440979200000,-0.00336411350724841],[1443571200000,0.00808184251820343],[1446249600000,0.000685426750788309],[1448841600000,-0.00389804642922353],[1451520000000,-0.00191907445203476],[1454198400000,0.0123297986609767],[1456704000000,0.00883160851821607],[1459382400000,0.00870839511212562],[1461974400000,0.00254667505479134],[1464652800000,0.000135783027583436],[1467244800000,0.0191660841264545],[1469923200000,0.00543009832188801],[1472601600000,-0.00215644099833057],[1475193600000,0.000516334303410027],[1477872000000,-0.00820541728478563],[1480464000000,-0.0259898165099246],[1483142400000,0.00253795192520734],[1485820800000,0.00212670632091871],[1488240000000,0.00643725674942175],[1490918400000,-0.000552636737874757],[1493510400000,0.00902961516238143],[1496188800000,0.0068467605084308],[1498780800000,-0.000182493446336807],[1501459200000,0.00333461966410198],[1504137600000,0.0093689036744129],[1506729600000,-0.00573220143747832],[1509408000000,0.000978127133666185],[1512000000000,-0.00148381925129115],[1514678400000,0.00473998357142591]],"name":"AGG"}],"navigator":{"enabled":false},"scrollbar":{"enabled":false},"legend":{"enabled":true}},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"stock","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>


]

---




# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`



.pull-left[

&lt;br&gt;

### `Highcharter` también tiene la capacidad de hacer histogramas. Un método es llamar primero a la función base `hist` en los datos junto con los argumentos para los breaks y `plot = FALSE`.





]

.pull-right[

----


```r
library(highcharter)

hc_hist &lt;- hist(asset_returns_xts[, symbols[1]],breaks = 50,plot = FALSE)


hchart(hc_hist, color = "cornflowerblue") %&gt;%
hc_title(text = paste(symbols[1], "Log Returns Distribution",
         sep = " ")) %&gt;%
         hc_add_theme(hc_theme_flat()) %&gt;%
         hc_exporting(enabled = TRUE) %&gt;%
         hc_legend(enabled = FALSE)  
```

----

]

---

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`


<div id="htmlwidget-70bda480fe9c4b4e9545" style="width:900px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-70bda480fe9c4b4e9545">{"x":{"hc_opts":{"chart":{"reflow":true,"zoomType":"x"},"title":{"text":"SPY Log Returns Distribution"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"tooltip":{"formatter":"function() { return  this.point.name + '<br/>' + this.y; }"},"series":[{"data":[{"x":-0.0625,"y":1,"name":"(-0.065, -0.06]"},{"x":-0.0575,"y":0,"name":"(-0.06, -0.055]"},{"x":-0.0525,"y":1,"name":"(-0.055, -0.05]"},{"x":-0.0475,"y":0,"name":"(-0.05, -0.045]"},{"x":-0.0425,"y":0,"name":"(-0.045, -0.04]"},{"x":-0.0375,"y":1,"name":"(-0.04, -0.035]"},{"x":-0.0325,"y":2,"name":"(-0.035, -0.03]"},{"x":-0.0275,"y":1,"name":"(-0.03, -0.025]"},{"x":-0.0225,"y":1,"name":"(-0.025, -0.02]"},{"x":-0.0175,"y":3,"name":"(-0.02, -0.015]"},{"x":-0.0125,"y":3,"name":"(-0.015, -0.01]"},{"x":-0.00750000000000001,"y":0,"name":"(-0.01, -0.005]"},{"x":-0.0025,"y":2,"name":"(-0.005, 0]"},{"x":0.0025,"y":7,"name":"(-6.93889390390723e-18, 0.005]"},{"x":0.00749999999999999,"y":5,"name":"(0.00499999999999999, 0.01]"},{"x":0.0125,"y":4,"name":"(0.01, 0.015]"},{"x":0.0175,"y":4,"name":"(0.015, 0.02]"},{"x":0.0225,"y":8,"name":"(0.02, 0.025]"},{"x":0.0275,"y":3,"name":"(0.025, 0.03]"},{"x":0.0325,"y":2,"name":"(0.03, 0.035]"},{"x":0.0375,"y":5,"name":"(0.035, 0.04]"},{"x":0.0425,"y":1,"name":"(0.04, 0.045]"},{"x":0.0475,"y":2,"name":"(0.045, 0.05]"},{"x":0.0525,"y":2,"name":"(0.05, 0.055]"},{"x":0.0575,"y":0,"name":"(0.055, 0.06]"},{"x":0.0625,"y":0,"name":"(0.06, 0.065]"},{"x":0.0675,"y":1,"name":"(0.065, 0.07]"},{"x":0.0725,"y":0,"name":"(0.07, 0.075]"},{"x":0.0775,"y":0,"name":"(0.075, 0.08]"},{"x":0.0825,"y":1,"name":"(0.08, 0.085]"}],"type":"column","pointRange":0.005,"groupPadding":0,"pointPadding":0,"borderWidth":0,"color":"cornflowerblue"}],"legend":{"enabled":false}},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>

---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `xts`


```r
autoplot(asset_returns_xts,facets = TRUE)
```

![](6_Returns_files/figure-html/unnamed-chunk-25-1.png)&lt;!-- --&gt;



---

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[


&gt; `tidyverse` pide que estos datos estén en formato long o ordenado donde cada variable tiene su propia columna. Para que los retornos de activos estén ordenadas, necesitamos una columna llamada "date", una columna llamada "stock" y una columna llamada "returns".

&lt;br&gt;

* Este formato es más difícil de leer para un humano: solo podemos ver las primeras lecturas de un activo. Desde una perspectiva tidyverse, esto se considera "ordenado" y es el formato preferido.

&lt;br&gt;

* `ggplot2` es un paquete de visualización flexible y muy utilizado, y es parte del tidyverse.

]

.pull-right[

----


```r
asset_returns_long &lt;-
       asset_returns_dplyr_byhand %&gt;%
       gather(asset, returns, -date) %&gt;%
       group_by(asset)


head(asset_returns_long, 10)
```

```
## # A tibble: 10 × 3
## # Groups:   asset [1]
##    date       asset returns
##    &lt;date&gt;     &lt;chr&gt;   &lt;dbl&gt;
##  1 2012-12-31 SPY   NA     
##  2 2013-01-31 SPY    0.0499
##  3 2013-02-28 SPY    0.0127
##  4 2013-03-31 SPY    0.0373
##  5 2013-04-30 SPY    0.0190
##  6 2013-05-31 SPY    0.0233
##  7 2013-06-30 SPY   -0.0134
##  8 2013-07-31 SPY    0.0504
##  9 2013-08-31 SPY   -0.0305
## 10 2013-09-30 SPY    0.0312
```

----

]



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
ggplot(aes(x = returns, fill = asset)) +
geom_histogram(alpha = 0.45, binwidth = .005) +
ggtitle("Monthly Returns Since 2013")
```
----

Recuerde que puede tener dinámica el gráfico con `ggplotly` del paquete `plotly`


----

```r
library(plotly)

g1&lt;-asset_returns_long %&gt;%
ggplot(aes(x = returns, fill = asset)) +
geom_histogram(alpha = 0.45, binwidth = .005) +
ggtitle("Monthly Returns Since 2013")


ggplotly(g1)
```
----

]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-29-1.png)&lt;!-- --&gt;



]



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`

<div id="htmlwidget-b85619f5b67bc0cfe858" style="width:100%;height:70%;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-b85619f5b67bc0cfe858">{"x":{"data":[{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[1,1,0,1,1,0,2,2,4,5,3,8,4,7,11,5,10,5,11,12,19,15,19,12,15,12,11,9,6,7,3,3,8,2,1,2,0,1,0,0,0,0,0,1,1],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,4,10,14,12,14,1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"text":["count:  0<br />returns: -0.095<br />asset: AGG","count:  0<br />returns: -0.090<br />asset: AGG","count:  0<br />returns: -0.085<br />asset: AGG","count:  0<br />returns: -0.080<br />asset: AGG","count:  0<br />returns: -0.075<br />asset: AGG","count:  0<br />returns: -0.070<br />asset: AGG","count:  0<br />returns: -0.065<br />asset: AGG","count:  0<br />returns: -0.060<br />asset: AGG","count:  0<br />returns: -0.055<br />asset: AGG","count:  0<br />returns: -0.050<br />asset: AGG","count:  0<br />returns: -0.045<br />asset: AGG","count:  0<br />returns: -0.040<br />asset: AGG","count:  0<br />returns: -0.035<br />asset: AGG","count:  0<br />returns: -0.030<br />asset: AGG","count:  1<br />returns: -0.025<br />asset: AGG","count:  1<br />returns: -0.020<br />asset: AGG","count:  1<br />returns: -0.015<br />asset: AGG","count:  4<br />returns: -0.010<br />asset: AGG","count: 10<br />returns: -0.005<br />asset: AGG","count: 14<br />returns:  0.000<br />asset: AGG","count: 12<br />returns:  0.005<br />asset: AGG","count: 14<br />returns:  0.010<br />asset: AGG","count:  1<br />returns:  0.015<br />asset: AGG","count:  2<br />returns:  0.020<br />asset: AGG","count:  0<br />returns:  0.025<br />asset: AGG","count:  0<br />returns:  0.030<br />asset: AGG","count:  0<br />returns:  0.035<br />asset: AGG","count:  0<br />returns:  0.040<br />asset: AGG","count:  0<br />returns:  0.045<br />asset: AGG","count:  0<br />returns:  0.050<br />asset: AGG","count:  0<br />returns:  0.055<br />asset: AGG","count:  0<br />returns:  0.060<br />asset: AGG","count:  0<br />returns:  0.065<br />asset: AGG","count:  0<br />returns:  0.070<br />asset: AGG","count:  0<br />returns:  0.075<br />asset: AGG","count:  0<br />returns:  0.080<br />asset: AGG","count:  0<br />returns:  0.085<br />asset: AGG","count:  0<br />returns:  0.090<br />asset: AGG","count:  0<br />returns:  0.095<br />asset: AGG","count:  0<br />returns:  0.100<br />asset: AGG","count:  0<br />returns:  0.105<br />asset: AGG","count:  0<br />returns:  0.110<br />asset: AGG","count:  0<br />returns:  0.115<br />asset: AGG","count:  0<br />returns:  0.120<br />asset: AGG","count:  0<br />returns:  0.125<br />asset: AGG"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(248,118,109,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"AGG","legendgroup":"AGG","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[0,0,0,0,1,0,1,2,3,3,2,4,4,5,8,5,8,2,5,11,18,11,14,12,12,8,8,7,4,6,2,2,6,1,1,2,0,1,0,0,0,0,0,0,1],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[1,1,0,1,0,0,1,0,1,2,1,4,0,2,3,0,2,3,6,1,1,4,5,0,3,4,3,2,2,1,1,1,2,1,0,0,0,0,0,0,0,0,0,1,0],"text":["count:  1<br />returns: -0.095<br />asset: EEM","count:  1<br />returns: -0.090<br />asset: EEM","count:  0<br />returns: -0.085<br />asset: EEM","count:  1<br />returns: -0.080<br />asset: EEM","count:  0<br />returns: -0.075<br />asset: EEM","count:  0<br />returns: -0.070<br />asset: EEM","count:  1<br />returns: -0.065<br />asset: EEM","count:  0<br />returns: -0.060<br />asset: EEM","count:  1<br />returns: -0.055<br />asset: EEM","count:  2<br />returns: -0.050<br />asset: EEM","count:  1<br />returns: -0.045<br />asset: EEM","count:  4<br />returns: -0.040<br />asset: EEM","count:  0<br />returns: -0.035<br />asset: EEM","count:  2<br />returns: -0.030<br />asset: EEM","count:  3<br />returns: -0.025<br />asset: EEM","count:  0<br />returns: -0.020<br />asset: EEM","count:  2<br />returns: -0.015<br />asset: EEM","count:  3<br />returns: -0.010<br />asset: EEM","count:  6<br />returns: -0.005<br />asset: EEM","count:  1<br />returns:  0.000<br />asset: EEM","count:  1<br />returns:  0.005<br />asset: EEM","count:  4<br />returns:  0.010<br />asset: EEM","count:  5<br />returns:  0.015<br />asset: EEM","count:  0<br />returns:  0.020<br />asset: EEM","count:  3<br />returns:  0.025<br />asset: EEM","count:  4<br />returns:  0.030<br />asset: EEM","count:  3<br />returns:  0.035<br />asset: EEM","count:  2<br />returns:  0.040<br />asset: EEM","count:  2<br />returns:  0.045<br />asset: EEM","count:  1<br />returns:  0.050<br />asset: EEM","count:  1<br />returns:  0.055<br />asset: EEM","count:  1<br />returns:  0.060<br />asset: EEM","count:  2<br />returns:  0.065<br />asset: EEM","count:  1<br />returns:  0.070<br />asset: EEM","count:  0<br />returns:  0.075<br />asset: EEM","count:  0<br />returns:  0.080<br />asset: EEM","count:  0<br />returns:  0.085<br />asset: EEM","count:  0<br />returns:  0.090<br />asset: EEM","count:  0<br />returns:  0.095<br />asset: EEM","count:  0<br />returns:  0.100<br />asset: EEM","count:  0<br />returns:  0.105<br />asset: EEM","count:  0<br />returns:  0.110<br />asset: EEM","count:  0<br />returns:  0.115<br />asset: EEM","count:  1<br />returns:  0.120<br />asset: EEM","count:  0<br />returns:  0.125<br />asset: EEM"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(163,165,0,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"EEM","legendgroup":"EEM","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[0,0,0,0,0,0,1,2,1,3,1,2,3,3,4,2,6,1,3,6,13,9,8,9,8,5,5,6,4,4,2,0,4,1,0,2,0,1,0,0,0,0,0,0,1],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[0,0,0,0,1,0,0,0,2,0,1,2,1,2,4,3,2,1,2,5,5,2,6,3,4,3,3,1,0,2,0,2,2,0,1,0,0,0,0,0,0,0,0,0,0],"text":["count:  0<br />returns: -0.095<br />asset: EFA","count:  0<br />returns: -0.090<br />asset: EFA","count:  0<br />returns: -0.085<br />asset: EFA","count:  0<br />returns: -0.080<br />asset: EFA","count:  1<br />returns: -0.075<br />asset: EFA","count:  0<br />returns: -0.070<br />asset: EFA","count:  0<br />returns: -0.065<br />asset: EFA","count:  0<br />returns: -0.060<br />asset: EFA","count:  2<br />returns: -0.055<br />asset: EFA","count:  0<br />returns: -0.050<br />asset: EFA","count:  1<br />returns: -0.045<br />asset: EFA","count:  2<br />returns: -0.040<br />asset: EFA","count:  1<br />returns: -0.035<br />asset: EFA","count:  2<br />returns: -0.030<br />asset: EFA","count:  4<br />returns: -0.025<br />asset: EFA","count:  3<br />returns: -0.020<br />asset: EFA","count:  2<br />returns: -0.015<br />asset: EFA","count:  1<br />returns: -0.010<br />asset: EFA","count:  2<br />returns: -0.005<br />asset: EFA","count:  5<br />returns:  0.000<br />asset: EFA","count:  5<br />returns:  0.005<br />asset: EFA","count:  2<br />returns:  0.010<br />asset: EFA","count:  6<br />returns:  0.015<br />asset: EFA","count:  3<br />returns:  0.020<br />asset: EFA","count:  4<br />returns:  0.025<br />asset: EFA","count:  3<br />returns:  0.030<br />asset: EFA","count:  3<br />returns:  0.035<br />asset: EFA","count:  1<br />returns:  0.040<br />asset: EFA","count:  0<br />returns:  0.045<br />asset: EFA","count:  2<br />returns:  0.050<br />asset: EFA","count:  0<br />returns:  0.055<br />asset: EFA","count:  2<br />returns:  0.060<br />asset: EFA","count:  2<br />returns:  0.065<br />asset: EFA","count:  0<br />returns:  0.070<br />asset: EFA","count:  1<br />returns:  0.075<br />asset: EFA","count:  0<br />returns:  0.080<br />asset: EFA","count:  0<br />returns:  0.085<br />asset: EFA","count:  0<br />returns:  0.090<br />asset: EFA","count:  0<br />returns:  0.095<br />asset: EFA","count:  0<br />returns:  0.100<br />asset: EFA","count:  0<br />returns:  0.105<br />asset: EFA","count:  0<br />returns:  0.110<br />asset: EFA","count:  0<br />returns:  0.115<br />asset: EFA","count:  0<br />returns:  0.120<br />asset: EFA","count:  0<br />returns:  0.125<br />asset: EFA"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,191,125,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"EFA","legendgroup":"EFA","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[0,0,0,0,0,0,1,0,0,1,0,0,1,2,1,1,6,0,1,4,6,4,4,7,6,3,3,2,2,2,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[0,0,0,0,0,0,0,2,1,2,1,2,2,1,3,1,0,1,2,2,7,5,4,2,2,2,2,4,2,2,1,0,3,1,0,1,0,1,0,0,0,0,0,0,1],"text":["count:  0<br />returns: -0.095<br />asset: IJS","count:  0<br />returns: -0.090<br />asset: IJS","count:  0<br />returns: -0.085<br />asset: IJS","count:  0<br />returns: -0.080<br />asset: IJS","count:  0<br />returns: -0.075<br />asset: IJS","count:  0<br />returns: -0.070<br />asset: IJS","count:  0<br />returns: -0.065<br />asset: IJS","count:  2<br />returns: -0.060<br />asset: IJS","count:  1<br />returns: -0.055<br />asset: IJS","count:  2<br />returns: -0.050<br />asset: IJS","count:  1<br />returns: -0.045<br />asset: IJS","count:  2<br />returns: -0.040<br />asset: IJS","count:  2<br />returns: -0.035<br />asset: IJS","count:  1<br />returns: -0.030<br />asset: IJS","count:  3<br />returns: -0.025<br />asset: IJS","count:  1<br />returns: -0.020<br />asset: IJS","count:  0<br />returns: -0.015<br />asset: IJS","count:  1<br />returns: -0.010<br />asset: IJS","count:  2<br />returns: -0.005<br />asset: IJS","count:  2<br />returns:  0.000<br />asset: IJS","count:  7<br />returns:  0.005<br />asset: IJS","count:  5<br />returns:  0.010<br />asset: IJS","count:  4<br />returns:  0.015<br />asset: IJS","count:  2<br />returns:  0.020<br />asset: IJS","count:  2<br />returns:  0.025<br />asset: IJS","count:  2<br />returns:  0.030<br />asset: IJS","count:  2<br />returns:  0.035<br />asset: IJS","count:  4<br />returns:  0.040<br />asset: IJS","count:  2<br />returns:  0.045<br />asset: IJS","count:  2<br />returns:  0.050<br />asset: IJS","count:  1<br />returns:  0.055<br />asset: IJS","count:  0<br />returns:  0.060<br />asset: IJS","count:  3<br />returns:  0.065<br />asset: IJS","count:  1<br />returns:  0.070<br />asset: IJS","count:  0<br />returns:  0.075<br />asset: IJS","count:  1<br />returns:  0.080<br />asset: IJS","count:  0<br />returns:  0.085<br />asset: IJS","count:  1<br />returns:  0.090<br />asset: IJS","count:  0<br />returns:  0.095<br />asset: IJS","count:  0<br />returns:  0.100<br />asset: IJS","count:  0<br />returns:  0.105<br />asset: IJS","count:  0<br />returns:  0.110<br />asset: IJS","count:  0<br />returns:  0.115<br />asset: IJS","count:  0<br />returns:  0.120<br />asset: IJS","count:  1<br />returns:  0.125<br />asset: IJS"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(0,176,246,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"IJS","legendgroup":"IJS","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"orientation":"v","width":[0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.00499999999999999,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005,0.005,0.005,0.00499999999999998,0.005,0.005,0.005],"base":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"x":[-0.095,-0.09,-0.085,-0.08,-0.075,-0.07,-0.065,-0.06,-0.055,-0.05,-0.045,-0.04,-0.035,-0.03,-0.025,-0.02,-0.015,-0.01,-0.005,0,0.005,0.01,0.015,0.02,0.025,0.03,0.035,0.04,0.045,0.05,0.055,0.06,0.065,0.07,0.075,0.08,0.085,0.09,0.095,0.1,0.105,0.11,0.115,0.12,0.125],"y":[0,0,0,0,0,0,1,0,0,1,0,0,1,2,1,1,6,0,1,4,6,4,4,7,6,3,3,2,2,2,1,0,1,0,0,1,0,0,0,0,0,0,0,0,0],"text":["count:  0<br />returns: -0.095<br />asset: SPY","count:  0<br />returns: -0.090<br />asset: SPY","count:  0<br />returns: -0.085<br />asset: SPY","count:  0<br />returns: -0.080<br />asset: SPY","count:  0<br />returns: -0.075<br />asset: SPY","count:  0<br />returns: -0.070<br />asset: SPY","count:  1<br />returns: -0.065<br />asset: SPY","count:  0<br />returns: -0.060<br />asset: SPY","count:  0<br />returns: -0.055<br />asset: SPY","count:  1<br />returns: -0.050<br />asset: SPY","count:  0<br />returns: -0.045<br />asset: SPY","count:  0<br />returns: -0.040<br />asset: SPY","count:  1<br />returns: -0.035<br />asset: SPY","count:  2<br />returns: -0.030<br />asset: SPY","count:  1<br />returns: -0.025<br />asset: SPY","count:  1<br />returns: -0.020<br />asset: SPY","count:  6<br />returns: -0.015<br />asset: SPY","count:  0<br />returns: -0.010<br />asset: SPY","count:  1<br />returns: -0.005<br />asset: SPY","count:  4<br />returns:  0.000<br />asset: SPY","count:  6<br />returns:  0.005<br />asset: SPY","count:  4<br />returns:  0.010<br />asset: SPY","count:  4<br />returns:  0.015<br />asset: SPY","count:  7<br />returns:  0.020<br />asset: SPY","count:  6<br />returns:  0.025<br />asset: SPY","count:  3<br />returns:  0.030<br />asset: SPY","count:  3<br />returns:  0.035<br />asset: SPY","count:  2<br />returns:  0.040<br />asset: SPY","count:  2<br />returns:  0.045<br />asset: SPY","count:  2<br />returns:  0.050<br />asset: SPY","count:  1<br />returns:  0.055<br />asset: SPY","count:  0<br />returns:  0.060<br />asset: SPY","count:  1<br />returns:  0.065<br />asset: SPY","count:  0<br />returns:  0.070<br />asset: SPY","count:  0<br />returns:  0.075<br />asset: SPY","count:  1<br />returns:  0.080<br />asset: SPY","count:  0<br />returns:  0.085<br />asset: SPY","count:  0<br />returns:  0.090<br />asset: SPY","count:  0<br />returns:  0.095<br />asset: SPY","count:  0<br />returns:  0.100<br />asset: SPY","count:  0<br />returns:  0.105<br />asset: SPY","count:  0<br />returns:  0.110<br />asset: SPY","count:  0<br />returns:  0.115<br />asset: SPY","count:  0<br />returns:  0.120<br />asset: SPY","count:  0<br />returns:  0.125<br />asset: SPY"],"type":"bar","textposition":"none","marker":{"autocolorscale":false,"color":"rgba(231,107,243,0.45)","line":{"width":1.88976377952756,"color":"transparent"}},"name":"SPY","legendgroup":"SPY","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":40.8401826484018,"r":7.30593607305936,"b":37.2602739726027,"l":37.2602739726027},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"title":{"text":"Monthly Returns Since 2013","font":{"color":"rgba(0,0,0,1)","family":"","size":17.5342465753425},"x":0,"xref":"paper"},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.10875,0.13875],"tickmode":"array","ticktext":["-0.10","-0.05","0.00","0.05","0.10"],"tickvals":[-0.1,-0.05,0,0.05,0.1],"categoryorder":"array","categoryarray":["-0.10","-0.05","0.00","0.05","0.10"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"returns","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-1.55,32.55],"tickmode":"array","ticktext":["0","10","20","30"],"tickvals":[0,10,20,30],"categoryorder":"array","categoryarray":["0","10","20","30"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"count","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"title":{"text":"asset","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}}},"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"source":"A","attrs":{"330c720b19a0":{"x":{},"fill":{},"type":"bar"}},"cur_data":"330c720b19a0","visdat":{"330c720b19a0":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>


---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
ggplot(aes(x = returns, fill = asset)) +
geom_histogram(alpha = 0.45, binwidth = .01) +
facet_wrap(~asset) +
ggtitle("Monthly Returns Since 2013") +
theme_update(plot.title = element_text(hjust = 0.5))
```
----


]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-32-1.png)&lt;!-- --&gt;



]


---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
ggplot(aes(x = returns, colour = asset)) +
geom_density(alpha = 1) +
ggtitle("Monthly Returns Density Since 2013") +
xlab("monthly returns") +
ylab("distribution") +
theme_update(plot.title = element_text(hjust = 0.5))
```
----


]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-34-1.png)&lt;!-- --&gt;



]


---




# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
ggplot(aes(x = returns)) +
geom_density(aes(color = asset), alpha = 1) +
geom_histogram(aes(fill = asset), alpha = 0.45, binwidth = .01) +
guides(fill = FALSE) +
facet_wrap(~asset) +
ggtitle("Monthly Returns Since 2013") +
xlab("monthly returns") +
ylab("distribution") +
theme_update(plot.title = element_text(hjust = 0.5))
```
----


]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-36-1.png)&lt;!-- --&gt;



]


---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Visualizing Asset Returns `tidyverse`



.pull-left[

----

```r
asset_returns_long %&gt;%
  ggplot(aes(x = date, y = returns, color=asset)) +
  geom_line()+
  ggtitle("Monthly Returns Since 2013") +
  xlab("Date") +
  ylab("Returns") +
  theme_update(plot.title = element_text(hjust = 0.5))
```
----


]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-38-1.png)&lt;!-- --&gt;



]


---


name: portafolio
class: inverse, center, middle
background-color: #00081d

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i>
# Construcción de portafolio
----

.right[
.bottom[
####  [<i class="fa fa-bell" role="presentation" aria-label="bell icon"></i>](#menu)
]
]


---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio



.pull-left[

Recopilamos rendimientos individuales en una cartera, que es un conjunto ponderado de rendimientos de activos. 

En consecuencia, lo primero que debemos hacer es asignar un peso a cada activo. Recuerde que nuestra cartera tendrá la siguiente combinación de activos:

&lt;br&gt;

* SPY (S&amp;P500 ETF) `weighted 25%`
* EFA (a non-US equities ETF) `weighted 25%`
* IJS (a small-cap value ETF) `weighted 20%`
* EEM (an emerging-markets ETF) `weighted 20%`
* AGG (a bond ETF) `weighted 10%`


&gt; Siempre es mejor asegurarse que la suma de las proporciones de los activos sea del 100%.


]

.pull-right[




```r
w &lt;- c(0.25, 0.25, 0.20, 0.20, 0.10)

tibble(w, symbols)
```

```
## # A tibble: 5 × 2
##       w symbols
##   &lt;dbl&gt; &lt;chr&gt;  
## 1  0.25 SPY    
## 2  0.25 EFA    
## 3  0.2  IJS    
## 4  0.2  EEM    
## 5  0.1  AGG
```

```r
# Corroborar la suma de las proporciones
tibble(w, symbols) %&gt;%
summarise(total_weight = sum(w))
```

```
## # A tibble: 1 × 1
##   total_weight
##          &lt;dbl&gt;
## 1            1
```


]



---




# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio



.pull-left[

* Ahora usamos esos pesos para convertir los rendimientos de 5 activos en los rendimientos de una cartera.

&lt;br&gt;

* El rendimiento de una cartera de activos múltiples es igual a la suma de los rendimientos ponderados de cada activo.

&lt;br&gt;

* Podemos implementar eso asignando pesos a las variables de acuerdo con nuestro vector de pesos w.




]

.pull-right[




```r
w_1 &lt;- w[1]
w_2 &lt;- w[2]
w_3 &lt;- w[3]
w_4 &lt;- w[4]
w_5 &lt;- w[5]



asset1 &lt;- asset_returns_xts[,1]
asset2 &lt;- asset_returns_xts[,2]
asset3 &lt;- asset_returns_xts[,3]
asset4 &lt;- asset_returns_xts[,4]
asset5 &lt;- asset_returns_xts[,5]


portfolio_returns_byhand &lt;-
                  (w_1 * asset1) +
                  (w_2 * asset2) +
                  (w_3 * asset3) +
                  (w_4 * asset4) +
                  (w_5 * asset5)

names(portfolio_returns_byhand) &lt;- "returns"
```


]



---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `xts`



.pull-left[

&gt; Usaremos `Return.portfolio()` de `PerformanceAnalytics`, para calcular los retornos de la cartera. La función requiere dos argumentos para una cartera, un objeto de rendimiento `xts` y un vector de pesos. No es necesario, pero también vamos a establecer `rebalance_on = "months"` para que podamos confirmar que coincide con nuestros cálculos manuales anteriores.

&lt;br&gt;

.center[
Recuerde, en el cálculo manual, establecemos los pesos de la cartera como fijos, lo que significa que nunca cambiaron mes a mes. Eso equivale a reequilibrar cada mes. En la práctica, no hay una temporalidad estable para rebalancear el portafolio. Esto depende de las condiciones del mercado.
]



]

.pull-right[




```r
portfolio_returns_xts_rebalanced_monthly &lt;-
                       Return.portfolio(asset_returns_xts,
                       weights = w,
                       rebalance_on = "months") %&gt;%
                       `colnames&lt;-`("returns")

head(portfolio_returns_xts_rebalanced_monthly, 10)
```

```
##                  returns
## 2013-01-31  0.0308486829
## 2013-02-28 -0.0008695222
## 2013-03-31  0.0186624141
## 2013-04-30  0.0206247821
## 2013-05-31 -0.0053528908
## 2013-06-30 -0.0229486594
## 2013-07-31  0.0411704599
## 2013-08-31 -0.0254691854
## 2013-09-30  0.0544306803
## 2013-10-31  0.0351851993
```


]



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `xts`

### Visualizando...

.pull-left[


```r
highchart(type = "stock") %&gt;%
hc_title(text = "Portfolio Monthly Returns") %&gt;%
hc_add_series(portfolio_returns_xts_rebalanced_monthly$returns,
name = "Rebalanced Monthly",
color = "cornflowerblue") %&gt;%
hc_add_theme(hc_theme_flat()) %&gt;%
hc_navigator(enabled = FALSE) %&gt;%
hc_scrollbar(enabled = FALSE) %&gt;%
hc_legend(enabled = TRUE) %&gt;%
hc_exporting(enabled = TRUE)
```



]

.pull-right[



<div id="htmlwidget-47266e770c53604e7ca7" style="width:450px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-47266e770c53604e7ca7">{"x":{"hc_opts":{"chart":{"reflow":true},"title":{"text":"Portfolio Monthly Returns"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"series":[{"data":[[1359590400000,0.0308486828968209],[1362009600000,-0.00086952218232883],[1364688000000,0.018662414082296],[1367280000000,0.0206247821088787],[1369958400000,-0.00535289076350065],[1372550400000,-0.0229486594416383],[1375228800000,0.0411704599201934],[1377907200000,-0.0254691854139629],[1380499200000,0.0544306802782508],[1383177600000,0.0351851993051671],[1385769600000,0.0162268112090351],[1388448000000,0.0129861694328961],[1391126400000,-0.0460147938649443],[1393545600000,0.0420750079636132],[1396224000000,0.0110339136785775],[1398816000000,0.00360026398439839],[1401494400000,0.0179239756231084],[1404086400000,0.019632824065043],[1406764800000,-0.017919039506662],[1409443200000,0.0255817540322538],[1412035200000,-0.0424127244319328],[1414713600000,0.0228083506076455],[1417305600000,0.00543301077881075],[1419984000000,-0.0137033046283922],[1422662400000,-0.0162358710761794],[1425081600000,0.0481443418412126],[1427760000000,-0.00816662014182945],[1430352000000,0.0206500834314993],[1433030400000,-0.0036368377690067],[1435622400000,-0.0192477143707577],[1438300800000,-0.00703916041511865],[1440979200000,-0.0633021357645861],[1443571200000,-0.0310103445822577],[1446249600000,0.061563317192175],[1448841600000,-0.0015955033975994],[1451520000000,-0.0286700491645172],[1454198400000,-0.0481123479688025],[1456704000000,-0.00532321852623663],[1459382400000,0.0754402759878647],[1461974400000,0.011756517210624],[1464652800000,-0.00262973396264377],[1467244800000,0.0072361726999628],[1469923200000,0.0396065696266612],[1472601600000,0.00542735532347471],[1475193600000,0.0100833696223015],[1477872000000,-0.020083142044961],[1480464000000,0.0179683720337824],[1483142400000,0.0177390718278405],[1485820800000,0.0231999515046444],[1488240000000,0.0193748100947118],[1490918400000,0.014139703760397],[1493510400000,0.0137551552295554],[1496188800000,0.0139302455947918],[1498780800000,0.00998443360139212],[1501459200000,0.024782132089525],[1504137600000,0.000689005184106861],[1506729600000,0.0266248705132379],[1509408000000,0.0177228362915947],[1512000000000,0.0156993841546431],[1514678400000,0.0134761972228614]],"name":"Rebalanced Monthly","color":"cornflowerblue"}],"navigator":{"enabled":false},"scrollbar":{"enabled":false},"legend":{"enabled":true}},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"stock","fonts":[],"debug":false},"evals":[],"jsHooks":[]}</script>


]



---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `xts`

### Visualizando...



```r
hc_portfolio &lt;-
hist(portfolio_returns_xts_rebalanced_monthly$returns,
breaks = 50,
plot = FALSE)
hchart(hc_portfolio,
color = "cornflowerblue",
name = "Portfolio") %&gt;%
hc_title(text = "Portfolio Returns Distribution") %&gt;%
hc_add_theme(hc_theme_flat()) %&gt;%
hc_exporting(enabled = TRUE)
```



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `xts`



<div id="htmlwidget-41854cfc45c1125772ef" style="width:900px;height:450px;" class="highchart html-widget"></div>
<script type="application/json" data-for="htmlwidget-41854cfc45c1125772ef">{"x":{"hc_opts":{"chart":{"reflow":true,"zoomType":"x"},"title":{"text":"Portfolio Returns Distribution"},"yAxis":{"title":{"text":null}},"credits":{"enabled":false},"exporting":{"enabled":true},"boost":{"enabled":false},"plotOptions":{"series":{"label":{"enabled":false},"turboThreshold":0},"treemap":{"layoutAlgorithm":"squarified"}},"tooltip":{"formatter":"function() { return  this.point.name + '<br/>' + this.y; }"},"series":[{"data":[{"x":-0.063,"y":1,"name":"(-0.064, -0.062]"},{"x":-0.061,"y":0,"name":"(-0.062, -0.06]"},{"x":-0.059,"y":0,"name":"(-0.06, -0.058]"},{"x":-0.057,"y":0,"name":"(-0.058, -0.056]"},{"x":-0.055,"y":0,"name":"(-0.056, -0.054]"},{"x":-0.053,"y":0,"name":"(-0.054, -0.052]"},{"x":-0.051,"y":0,"name":"(-0.052, -0.05]"},{"x":-0.049,"y":1,"name":"(-0.05, -0.048]"},{"x":-0.047,"y":1,"name":"(-0.048, -0.046]"},{"x":-0.045,"y":0,"name":"(-0.046, -0.044]"},{"x":-0.043,"y":1,"name":"(-0.044, -0.042]"},{"x":-0.041,"y":0,"name":"(-0.042, -0.04]"},{"x":-0.039,"y":0,"name":"(-0.04, -0.038]"},{"x":-0.037,"y":0,"name":"(-0.038, -0.036]"},{"x":-0.035,"y":0,"name":"(-0.036, -0.034]"},{"x":-0.033,"y":0,"name":"(-0.034, -0.032]"},{"x":-0.031,"y":1,"name":"(-0.032, -0.03]"},{"x":-0.029,"y":1,"name":"(-0.03, -0.028]"},{"x":-0.027,"y":0,"name":"(-0.028, -0.026]"},{"x":-0.025,"y":1,"name":"(-0.026, -0.024]"},{"x":-0.023,"y":1,"name":"(-0.024, -0.022]"},{"x":-0.021,"y":1,"name":"(-0.022, -0.02]"},{"x":-0.019,"y":1,"name":"(-0.02, -0.018]"},{"x":-0.017,"y":2,"name":"(-0.018, -0.016]"},{"x":-0.015,"y":0,"name":"(-0.016, -0.014]"},{"x":-0.013,"y":1,"name":"(-0.014, -0.012]"},{"x":-0.011,"y":0,"name":"(-0.012, -0.01]"},{"x":-0.00900000000000001,"y":1,"name":"(-0.01, -0.00800000000000001]"},{"x":-0.00700000000000001,"y":1,"name":"(-0.00800000000000001, -0.00600000000000001]"},{"x":-0.00500000000000001,"y":2,"name":"(-0.00600000000000002, -0.00400000000000001]"},{"x":-0.00300000000000002,"y":2,"name":"(-0.00400000000000002, -0.00200000000000002]"},{"x":-0.00100000000000001,"y":2,"name":"(-0.00200000000000001, -6.93889390390723e-18]"},{"x":0.000999999999999994,"y":1,"name":"(-6.93889390390723e-18, 0.00199999999999999]"},{"x":0.00299999999999999,"y":1,"name":"(0.00199999999999999, 0.00399999999999999]"},{"x":0.00499999999999999,"y":2,"name":"(0.00399999999999999, 0.00599999999999999]"},{"x":0.00699999999999999,"y":1,"name":"(0.00599999999999999, 0.00799999999999999]"},{"x":0.00899999999999999,"y":1,"name":"(0.00799999999999999, 0.00999999999999999]"},{"x":0.011,"y":3,"name":"(0.00999999999999998, 0.012]"},{"x":0.013,"y":4,"name":"(0.012, 0.014]"},{"x":0.015,"y":2,"name":"(0.014, 0.016]"},{"x":0.017,"y":5,"name":"(0.016, 0.018]"},{"x":0.019,"y":3,"name":"(0.018, 0.02]"},{"x":0.021,"y":2,"name":"(0.02, 0.022]"},{"x":0.023,"y":2,"name":"(0.022, 0.024]"},{"x":0.025,"y":2,"name":"(0.024, 0.026]"},{"x":0.027,"y":1,"name":"(0.026, 0.028]"},{"x":0.029,"y":0,"name":"(0.028, 0.03]"},{"x":0.031,"y":1,"name":"(0.03, 0.032]"},{"x":0.033,"y":0,"name":"(0.032, 0.034]"},{"x":0.035,"y":1,"name":"(0.034, 0.036]"},{"x":0.037,"y":0,"name":"(0.036, 0.038]"},{"x":0.039,"y":1,"name":"(0.038, 0.04]"},{"x":0.041,"y":1,"name":"(0.04, 0.042]"},{"x":0.043,"y":1,"name":"(0.042, 0.044]"},{"x":0.045,"y":0,"name":"(0.044, 0.046]"},{"x":0.047,"y":0,"name":"(0.046, 0.048]"},{"x":0.049,"y":1,"name":"(0.048, 0.05]"},{"x":0.051,"y":0,"name":"(0.05, 0.052]"},{"x":0.053,"y":0,"name":"(0.052, 0.054]"},{"x":0.055,"y":1,"name":"(0.054, 0.056]"},{"x":0.057,"y":0,"name":"(0.056, 0.058]"},{"x":0.059,"y":0,"name":"(0.058, 0.06]"},{"x":0.061,"y":1,"name":"(0.06, 0.062]"},{"x":0.063,"y":0,"name":"(0.062, 0.064]"},{"x":0.065,"y":0,"name":"(0.064, 0.066]"},{"x":0.067,"y":0,"name":"(0.066, 0.068]"},{"x":0.069,"y":0,"name":"(0.068, 0.07]"},{"x":0.071,"y":0,"name":"(0.07, 0.072]"},{"x":0.073,"y":0,"name":"(0.072, 0.074]"},{"x":0.075,"y":1,"name":"(0.074, 0.076]"}],"type":"column","pointRange":0.002,"groupPadding":0,"pointPadding":0,"borderWidth":0,"color":"cornflowerblue","name":"Portfolio"}]},"theme":{"colors":["#f1c40f","#2ecc71","#9b59b6","#e74c3c","#34495e","#3498db","#1abc9c","#f39c12","#d35400"],"chart":{"backgroundColor":"#ECF0F1"},"xAxis":{"gridLineDashStyle":"Dash","gridLineWidth":1,"gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"yAxis":{"gridLineDashStyle":"Dash","gridLineColor":"#BDC3C7","lineColor":"#BDC3C7","minorGridLineColor":"#BDC3C7","tickColor":"#BDC3C7","tickWidth":1},"legendBackgroundColor":"rgba(0, 0, 0, 0.5)","background2":"#505053","dataLabelsColor":"#B0B0B3","textColor":"#34495e","contrastTextColor":"#F0F0F3","maskColor":"rgba(255,255,255,0.3)"},"conf_opts":{"global":{"Date":null,"VMLRadialGradientURL":"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png","canvasToolsURL":"http =//code.highcharts.com/list(version)/modules/canvas-tools.js","getTimezoneOffset":null,"timezoneOffset":0,"useUTC":true},"lang":{"contextButtonTitle":"Chart context menu","decimalPoint":".","downloadCSV":"Download CSV","downloadJPEG":"Download JPEG image","downloadPDF":"Download PDF document","downloadPNG":"Download PNG image","downloadSVG":"Download SVG vector image","downloadXLS":"Download XLS","drillUpText":"◁ Back to {series.name}","exitFullscreen":"Exit from full screen","exportData":{"annotationHeader":"Annotations","categoryDatetimeHeader":"DateTime","categoryHeader":"Category"},"hideData":"Hide data table","invalidDate":null,"loading":"Loading...","months":["January","February","March","April","May","June","July","August","September","October","November","December"],"noData":"No data to display","numericSymbolMagnitude":1000,"numericSymbols":["k","M","G","T","P","E"],"printChart":"Print chart","resetZoom":"Reset zoom","resetZoomTitle":"Reset zoom level 1:1","shortMonths":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"shortWeekdays":["Sat","Sun","Mon","Tue","Wed","Thu","Fri"],"thousandsSep":" ","viewData":"View data table","viewFullscreen":"View in full screen","weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},"type":"chart","fonts":[],"debug":false},"evals":["hc_opts.tooltip.formatter"],"jsHooks":[]}</script>






---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyverse`



.pull-left[

&gt; Usamos `case_when()` para asignar pesos por activo, de modo que en el caso de que la columna de activos sea igual al activo 1 (SPY), asignamos un peso de 0,25, o w[1], y así sucesivamente.

&lt;br&gt;

----

```r
asset_returns_long %&gt;%
      group_by(asset) %&gt;%
      mutate(weights = case_when(asset == symbols[1] ~ w[1],
      asset == symbols[2] ~ w[2],
      asset == symbols[3] ~ w[3],
      asset == symbols[4] ~ w[4],
      asset == symbols[5] ~ w[5])) %&gt;%

  
head(20)
```
----

]

.pull-right[




```
## # A tibble: 20 × 4
## # Groups:   asset [1]
##    date       asset  returns weights
##    &lt;date&gt;     &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 2012-12-31 SPY   NA          0.25
##  2 2013-01-31 SPY    0.0499     0.25
##  3 2013-02-28 SPY    0.0127     0.25
##  4 2013-03-31 SPY    0.0373     0.25
##  5 2013-04-30 SPY    0.0190     0.25
##  6 2013-05-31 SPY    0.0233     0.25
##  7 2013-06-30 SPY   -0.0134     0.25
##  8 2013-07-31 SPY    0.0504     0.25
##  9 2013-08-31 SPY   -0.0305     0.25
## 10 2013-09-30 SPY    0.0312     0.25
## 11 2013-10-31 SPY    0.0453     0.25
## 12 2013-11-30 SPY    0.0292     0.25
## 13 2013-12-31 SPY    0.0256     0.25
## 14 2014-01-31 SPY   -0.0359     0.25
## 15 2014-02-28 SPY    0.0445     0.25
## 16 2014-03-31 SPY    0.00826    0.25
## 17 2014-04-30 SPY    0.00693    0.25
## 18 2014-05-31 SPY    0.0229     0.25
## 19 2014-06-30 SPY    0.0204     0.25
## 20 2014-07-31 SPY   -0.0135     0.25
```


]



---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyverse`



.pull-left[

&gt; A continuación, necesitamos implementar la ecuación para los rendimientos de la cartera. Esta tarea es un poco complicada pero sirve como una buena manera de usar la función `group_by()` con fechas. 

* Primero añadimos un nuevo objeto llamado `weighted_returns` que es el producto del rendimiento mensual de cada activo y su peso. 

* Luego, `group_by()` agrupa la columna de fecha porque cada uno de nuestros rendimientos ponderados debe sumarse para cada fecha. 

* Una vez que agrupamos por fecha, podemos usar `summarise(total = sum(weighted_returns))` para sumar los rendimientos ponderados mensuales.



]

.pull-right[




```r
portfolio_returns_dplyr_byhand &lt;-
      asset_returns_long %&gt;%
      group_by(asset) %&gt;%
      mutate(weights = case_when(asset == symbols[1] ~ w[1],
                                 asset == symbols[2] ~ w[2],
                                 asset == symbols[3] ~ w[3],
                                 asset == symbols[4] ~ w[4],
                                 asset == symbols[5] ~ w[5]),
                                 weighted_returns = returns * weights) %&gt;%
      group_by(date) %&gt;%
      summarise(returns = sum(weighted_returns))


head(portfolio_returns_dplyr_byhand, 10)
```


]



---


# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyquant`



.pull-left[

&gt; En tidyquant, comenzamos de nuevo con nuestro objeto `asset_returns_long` largo y con formato ordenado, pero lo convertimos en rendimientos de cartera usando `tq_portafolio()`. 

* La función `tq_portfolio` toma un `tibble` y luego solicita una columna de activos para agrupar, una columna de retornos para encontrar datos de retorno y un vector de ponderaciones.

* Es similar a `Return.portfolio()` y, por lo tanto, también acepta el argumento `rebalance_on = "months"`. Dado que estamos reequilibrando por meses, deberíamos obtener nuevamente un objeto de rendimiento de cartera que coincida con nuestros objetos existentes.





]

.pull-right[




```r
portfolio_returns_tq_rebalanced_monthly &lt;-
          asset_returns_long %&gt;%
          tq_portfolio(assets_col = asset,
                       returns_col = returns,
                       weights = w,
                       col_rename = "returns",
                       rebalance_on = "months")

head(portfolio_returns_tq_rebalanced_monthly, 10)
```


]



---






# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyquant`

### Visualizando...

.pull-left[


```r
portfolio_returns_tq_rebalanced_monthly %&gt;%
   ggplot(aes(x = date, y = returns)) +
   geom_point(colour = "cornflowerblue")+
   xlab("date") +
   ylab("monthly return") +
   theme_update(plot.title = element_text(hjust = 0.5)) +
   ggtitle("Portfolio Returns Scatter") +
   scale_x_date(breaks = pretty_breaks(n=6))
```




]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-51-1.png)&lt;!-- --&gt;


]


---





# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyquant`

### Visualizando...

.pull-left[


```r
portfolio_returns_tq_rebalanced_monthly %&gt;%
     ggplot(aes(x = returns)) +
     geom_histogram(binwidth = .005,
     fill = "cornflowerblue",
     color = "cornflowerblue") +
     ggtitle("Portfolio Returns Distribution") +
     theme_update(plot.title = element_text(hjust = 0.5))
```




]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-53-1.png)&lt;!-- --&gt;


]



---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyverse`

### Visualizando...

.pull-left[


```r
asset_returns_long %&gt;%
         ggplot(aes(x = returns,
         fill = asset)) +
         geom_histogram(alpha = 0.15,
         binwidth = .01) +
         geom_histogram(data = portfolio_returns_tq_rebalanced_monthly,
         fill = "cornflowerblue",
         binwidth = .01) +
         ggtitle("Portfolio and Asset Monthly Returns") +
         theme_update(plot.title = element_text(hjust = 0.5))
```




]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-55-1.png)&lt;!-- --&gt;


]



---






# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Building a Portfolio `tidyverse`

### Visualizando...

.pull-left[


```r
portfolio_returns_tq_rebalanced_monthly %&gt;%
             ggplot(aes(x = returns)) +
             geom_histogram(binwidth = .01,
             colour = "cornflowerblue",
             fill = "cornflowerblue") +
             geom_density(alpha = 1, color = "red") +
             xlab("monthly returns") +
             ylab("distribution") +
             theme_update(plot.title = element_text(hjust = 0.5)) +
             ggtitle("Portfolio Histogram and Density")
```




]

.pull-right[



![](6_Returns_files/figure-html/unnamed-chunk-57-1.png)&lt;!-- --&gt;


]



---


name: shiny
class: inverse, center, middle
background-color: #00081d

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i>
# Shiny App
----

.right[
.bottom[
####  [<i class="fa fa-bell" role="presentation" aria-label="bell icon"></i>](#menu)
]
]


---

# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Shiny App

.center[
&lt;img src="img/Dashboard.JPG" width="100%" /&gt;
]


---



# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Shiny App


.scroll-box-18[
````
---
title: "Returns Distribution"
runtime: shiny
output:
  flexdashboard::flex_dashboard:
    orientation: rows
---


```{r setup, message = FALSE}
library(tidyverse)
library(highcharter)
library(tidyquant)
library(timetk)
```

Sidebar {.sidebar}
=====================================
  
```{r}

fluidRow(
  column(6,
  textInput("stock1", "Stock 1", "SPY")),
  column(5,
  numericInput("w1", "Weight %", 25, min = 1, max = 100))
)  

fluidRow(
  column(6,
  textInput("stock2", "Stock 2", "EFA")),
  column(5,
  numericInput("w2", "Weight %", 25, min = 1, max = 100))
)

fluidRow(
  column(6,
  textInput("stock3", "Stock 3", "IJS")),
  column(5,
  numericInput("w3", "Weight %", 20, min = 1, max = 100))
)

fluidRow(
  column(6,
  textInput("stock4", "Stock 4", "EEM")),
  column(5,
  numericInput("w4", "Weight %", 20, min = 1, max = 100))
)

fluidRow(
  column(6,
  textInput("stock5", "Stock 5", "AGG")),
  column(5,
  numericInput("w5", "Weight %", 10, min = 1, max = 100))
)

fluidRow(
  column(7,
  dateInput("date", "Starting Date", "2013-01-01", format = "yyyy-mm-dd"))
)

fluidRow(
  column(7,
  selectInput("rebalance", "Rebalance",
              c("Yearly" = "years",
                "Monthly" = "months",
                "Weekly" = "weeks"))
  )
)

actionButton("go", "Submit")

portfolio_returns_byhand &lt;- eventReactive(input$go, {
  
  symbols &lt;- c(input$stock1, input$stock2, input$stock3, input$stock4, input$stock5)
  
  prices &lt;- getSymbols(symbols, src = 'yahoo', from = input$date, 
             auto.assign = TRUE, warnings = FALSE) %&gt;% 
  map(~Ad(get(.))) %&gt;% 
  reduce(merge) %&gt;%
    `colnames&lt;-`(symbols)

  w &lt;- c(input$w1/100, input$w2/100, 
         input$w3/100, input$w4/100, input$w5/100)
  
  asset_returns_long &lt;- 
      prices %&gt;% 
      to.monthly(indexAt = "last", OHLC = FALSE) %&gt;% 
      tk_tbl(preserve_index = TRUE, rename_index = "date") %&gt;%
      gather(asset, returns, -date) %&gt;% 
      group_by(asset) %&gt;%  
      mutate(returns = (log(returns) - log(lag(returns))))

  portfolio_returns_byhand &lt;- 
    asset_returns_long %&gt;% 
    tq_portfolio(assets_col = asset, 
               returns_col = returns, 
               weights = w,
               col_rename = "returns")
  
})

```

Returns
=====================================  


Row {.tabset .tabset-fade}
-------------------------------------


### Histogram

```{r}
renderPlot({
  portfolio_returns_byhand() %&gt;% 
    ggplot(aes(x = returns)) +
    geom_histogram(alpha = 0.25, binwidth = .01, fill = "cornflowerblue")
})
```

### Density

```{r}
renderPlot({
  portfolio_returns_byhand() %&gt;% 
    ggplot(aes(x = returns)) +
  geom_density(size = 1, color = "red") 
})
```


### Histogram + Density

```{r}
renderPlot({
  portfolio_returns_byhand() %&gt;% 
    ggplot(aes(x = returns)) +
    geom_histogram(alpha = 0.25, binwidth = .01, fill = "cornflowerblue") +
    geom_density(geom = "line", size = 1, color = "red") 
})
```
````
]


---





# <i class="fa fa-broom" role="presentation" aria-label="broom icon"></i> Shiny App


.scroll-box-18[

````
---
title: "Ejemplo 2"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
runtime: shiny
---


```{r setup, include=FALSE}
library(flexdashboard)
library(shiny)
library(tidyverse)
library(highcharter)
library(plotly)
library(timetk)
library(tidyquant)
library(scales)
library(reshape2)
library(ggplot2)
library(plotly)
library(quantmod)
library(timeSeries)
library(fPortfolio)
library(caTools)

```


Sidebar {.sidebar}
=====================================

```{r}
#checkboxGroupInput("checkGroup", label = h3("Checkbox group"), 
#    choices = list("BKNG" = "BKNG", "META" = "META", "MELI" = "MELI"),
#    selected = "BKNG")

##checkboxInput("widget66", label = "INTC", value = TRUE)


textInput("widget6", "Stock 1", "INTC")
sliderInput("peso1", label="%", value=20, min = 0, max = 100, step = 1)
textInput("widget6.1", "Stock 2", "BKNG")
sliderInput("peso2", label= "% ", value=20, min = 0, max = 100, step = 1)
textInput("widget6.2", "Stock 3", "META")
sliderInput("peso3", label= "% ", value=20, min = 0, max = 100, step = 1)
textInput("widget6.3", "Stock 4", "MELI")
sliderInput("peso4", label= "% ", value=20, min = 0, max = 100, step = 1)
textInput("widget6.4", "Stock 5", "EBAY")
sliderInput("peso5", label= "% ", value=20, min = 0, max = 100, step = 1)

dateRangeInput("dates", label = "Seleccione la fecha",
               start="2010-01-01", end ="2022-10-31")


####### Reactivos

Stock_Ind&lt;- reactive({
  
prices &lt;- getSymbols(c(input$widget6, input$widget6.1,input$widget6.2,input$widget6.3,input$widget6.4), src = "yahoo",
               from = input$dates[1],
               to = input$dates[2],
               auto.assign = TRUE,
               warnings = FALSE) %&gt;% 
  map(~Ad(get(.))) %&gt;% 
  reduce(merge) %&gt;%
    `colnames&lt;-`(c(input$widget6,input$widget6.1,input$widget6.2,input$widget6.3,input$widget6.4))

})



retornos &lt;- reactive({ 
  Return.calculate(Stock_Ind(),
                   method = "log") %&gt;%
  na.omit()
})


pesos&lt;- reactive({
c(input$peso1,input$peso2,input$peso3,input$peso4,input$peso5)/100
})



asset_returns_long&lt;- reactive({
  retornos() %&gt;%
  tk_tbl(preserve_index = TRUE, # convierte de xts a formato tibble, preservando el índice y nombrándolo como "date"
           rename_index = "date") %&gt;%
  gather(asset, returns, -date) %&gt;% #aquí lo pasa a formato long, y lo agrupa por activo
  group_by(asset)
})


portfolio_returns_xts &lt;-reactive({
  Return.portfolio(retornos(),
                   weights = pesos()) %&gt;%
  `colnames&lt;-`("returns")
  })



```





Precios de acciones
=======================================================================

### Boxplot | Precios acciones

```{r}


Stock_Ind2&lt;- reactive({

DatosPre_&lt;-as.data.frame(Stock_Ind())
VarLong &lt;- names(DatosPre_)

Datos2&lt;-DatosPre_ %&gt;%  gather(VarLong, key = variable, value = index) 

})


renderPlotly({

Stock_Ind2()  %&gt;% 
  plot_ly(y = ~index, color = ~variable, type = "box", colors = "viridis")
})
  



```


###  Serie | Precios acciones
```{r}

renderHighchart({
  library(viridisLite)
  cols &lt;- viridis(5)
##cols &lt;- substr(cols, 0, 7)

  highchart(type = "stock") %&gt;%
    hc_title(text = "") %&gt;%
    hc_add_series(Stock_Ind()[,1],
                  name = input$widget6) %&gt;%
    hc_add_series(Stock_Ind()[,2],
                  name = input$widget6.1) %&gt;%
    hc_add_series(Stock_Ind()[,3],
                  name = input$widget6.2) %&gt;%
    hc_add_series(Stock_Ind()[,4],
                  name = input$widget6.3) %&gt;%
    hc_add_series(Stock_Ind()[,5],
                  name = input$widget6.4) %&gt;%
    hc_add_theme(hc_theme_elementary()) %&gt;%
    hc_navigator(enabled = FALSE) %&gt;%
    hc_scrollbar(enabled = FALSE) %&gt;%
    hc_exporting(enabled = TRUE) %&gt;%
    hc_legend(enabled = TRUE) %&gt;%
    hc_colors(cols)
})
  
```


Retornos de acciones
=======================================================================



### Densidad | Retornos acciones


```{r}


renderPlotly({
  
library(viridis)
  
p&lt;-asset_returns_long() %&gt;%
  ggplot(aes(x = returns, colour = asset)) +
  geom_density(alpha = 1) +
  ggtitle("") +
  xlab("retornos mensuales") +
  ylab("distribución") +
  scale_color_viridis(discrete=TRUE) +
  theme_update(plot.title = element_text(hjust = 0.5))+ 
  theme_light()

ggplotly(p)
})

```


Portafolio
=====================================

row
-------------------------------------

### Retornos del Portafolio
```{r}

renderHighchart(
 highchart(type = "stock") %&gt;%
  hc_title(text = "") %&gt;%
  hc_add_series(portfolio_returns_xts()$returns,
                name = "Portfolio returns",
                color ="#3B528BFF")%&gt;% ##"cornflowerblue") %&gt;%
  hc_add_theme(hc_theme_elementary()) %&gt;%
  hc_navigator(enabled = FALSE) %&gt;%
  hc_scrollbar(enabled = FALSE) %&gt;%
  hc_legend(enabled = TRUE) %&gt;%
  hc_exporting(enabled = TRUE)
)



```



````
]




---



class: inverse, center, middle
background-color: #00081d




.pull-left[

.center[
&lt;br&gt;&lt;br&gt;

# Gracias!!!

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;



### Preguntas?
]


]


.pull-right[


.center[

&lt;br&gt;&lt;br&gt;&lt;br&gt;


.center[
&lt;img style="border-radius: 50%;" src="img/avatar.png"
width="100px" href="https://www.joaquibarandica.com"
/&gt;

<span>&lt;i class="fas  fa-envelope faa-passing animated "&gt;&lt;/i&gt;</span> orlando.joaqui@correounivalle.edu.co 
]


&lt;img src="img/qr-code.png" width="50%" style="display: block; margin: auto;" /&gt;


.center[
www.joaquibarandica.com
]



]


]


&lt;br&gt;&lt;br&gt;&lt;br&gt;
----

*The images used to set the presentation are from [pixabay](https://pixabay.com/).*




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="cols_macro.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
